import{h as v,H as b,Q as h,V as C,r as q,d as x,z as k,a as K,B as S,D as A,G as o,m as e,J as m,K as p,u,L as f,M as _,W as y}from"./vue-BwV3LOMf.js";import{_ as B}from"./PasswordField.vue_vue_type_script_setup_true_lang-tnCKkr90.js";import{H as T,I as F,d as I,J as M,e as U,f as $,a as D,V as E,h as H,j as J,c as L}from"./index-BibQzmrI.js";import"./vuetify-Dzk9Lamd.js";const G=v({__name:"Login",setup(N){const{t:s}=b(),V=h(),t=C(),d=T(),n=q({username:"",password:""}),c=x(!1),w={username:[r=>!!r||s("login.rules.username_required")],password:[r=>!!r||s("login.rules.password_required")]},i=async()=>{if(!c.value)return;const r=await d.login(n.username,n.password);if(d.isAuthenticated)y.success(s("login.success")),g();else{let a=s("login.error");r.status!==200&&(a+=`
Error code: ${r.status} (${r.data})`),y.error(a)}},g=()=>{t.query.redirect?V.push(t.query.redirect):V.push({name:"dashboard"})};return k(async()=>{t.query.username&&t.query.password&&await d.login(t.query.username,t.query.password)}),K(()=>{d.isAuthenticated&&g()}),(r,a)=>(S(),A(F,{class:"fill-height"},{default:o(()=>[e(L,{class:"mx-auto",rounded:"lg","min-width":"250"},{default:o(()=>[e(I,null,{default:o(()=>[m(p(u(s)("login.title")),1)]),_:1}),e(M,null,{default:o(()=>[m(p(u(s)("login.subtitle")),1)]),_:1}),e(U,null,{default:o(()=>[e($,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),onSubmit:f(i,["prevent"])},{default:o(()=>[e(D,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=l=>n.username=l),id:"username",name:"username",label:u(s)("login.username"),autofocus:"",rules:w.username,onKeydown:_(f(i,["prevent"]),["enter"]),variant:"outlined"},{prepend:o(()=>[e(E,{color:"accent",icon:"mdi-account"})]),_:1},8,["modelValue","label","rules","onKeydown"]),e(B,{modelValue:n.password,"onUpdate:modelValue":a[1]||(a[1]=l=>n.password=l),id:"password",label:u(s)("login.password"),rules:w.password,"prepend-icon":"mdi-lock",onKeydown:_(f(i,["prevent"]),["enter"]),variant:"outlined"},null,8,["modelValue","label","rules","onKeydown"])]),_:1},8,["modelValue"])]),_:1}),e(H,null,{default:o(()=>[e(J,{variant:"elevated",block:"",color:"accent",onClick:i},{default:o(()=>[m(p(u(s)("login.submit")),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});export{G as default};
