import{a5 as Ve,b as P,f as G,K as V,L as g,e as Q,O as a,U,V as L,R as p,P as r,n as e,x as S,u as n,T as z,v as A,W as _e,X as we,Y as ne,Q as Ee,z as Pe,F as H,_ as xe,S as Ce}from"./vue-CpUfmXXb.js";import{aL as Te,ah as T,t as f,o as W,j as Ne,h as ve,V as se,k as De,s as q,v as ie,l as oe,n as J,r as re,D as $e,R as Ue,W as Ie,S as Me,d as Re,aM as ue,A as R,z as ce,B as d,ax as Le,H as qe,C as de,E as me,aN as Be,aO as fe,am as ge,aJ as j,K as Qe,aP as ze,aB as Ae}from"./index-sDGVDpHX.js";import{d as he}from"./vuetify-BjHTe0sz.js";import{V as Oe}from"./VForm-C54njCzr.js";import{V as Y}from"./VDataTable-D3HpaD7f.js";import{V as Ke}from"./VContainer-D5rMYmoF.js";import{V as Fe,a as He}from"./VTabs-D7LwB47D.js";import"./VPagination-DEjYxMqT.js";const ye=Ve("searchEngine",()=>{const h=P([]),w=P([]);function _(){h.value.push({uniqueId:Te(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function l(i){h.value=h.value.filter(k=>k.uniqueId!==i)}async function y(i){const k=await T.startSearch(i.query,i.filters.category,[i.filters.plugin]);i.id=k.id,i.results=[],i.lastQuery=i.query}async function x(i){const k=await T.getSearchResults(i.id,i.results.length);return i.results.push(...k.results),k.status}async function E(i){i.id&&i.id!==0&&await T.stopSearch(i.id),i.id=0}async function m(){w.value=await T.getSearchPlugins()}async function v(i){await T.installSearchPlugin([i])}async function N(i){await T.uninstallSearchPlugin([i])}async function C(i){await T.enableSearchPlugin([i.name],!i.enabled)}async function D(){await T.updateSearchPlugins()}async function I(i,k){await T.downloadTorrentWithSearchPlugin(i,k)}return{searchData:h,searchPlugins:w,createNewTab:_,deleteTab:l,runNewSearch:y,refreshResults:x,stopSearch:E,fetchSearchPlugins:m,installSearchPlugin:v,uninstallSearchPlugin:N,toggleSearchPlugin:C,updatePlugins:D,downloadTorrent:I,$reset:()=>{h.value=[],w.value=[],_()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),je={key:1,"data-testid":"mixedbtn-text"},pe=G({__name:"MixedButton",props:{mobileOverride:{type:Boolean},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(h){const w=h,{mobile:_}=he(),l=Q(()=>w.mobileOverride?w.mobileValue:_.value);return(y,x)=>(g(),V(f,{icon:l.value},{default:a(()=>[l.value||h.position==="left"?(g(),V(W,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[p(r(h.icon),1)]),_:1})):U("",!0),l.value?U("",!0):(g(),L("span",je,r(h.text),1)),!l.value&&h.position==="right"?(g(),V(W,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[p(r(h.icon),1)]),_:1})):U("",!0)]),_:1},8,["icon"]))}}),We=["href","title"],Je=G({__name:"PluginManagerDialog",props:{guid:{}},setup(h){const w=h,{isOpened:_}=Ne(w.guid),{t:l}=ve(),y=ye(),x=[{title:l("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:l("dialogs.pluginManager.headers.name"),key:"fullName"},{title:l("dialogs.pluginManager.headers.version"),key:"version"},{title:l("dialogs.pluginManager.headers.url"),key:"url"},{title:l("dialogs.pluginManager.headers.actions"),key:"actions"}],E=P(!1),m=P(!1),v=P(!1),N=P(!1),C=P("");async function D(s){await y.toggleSearchPlugin(s),await y.fetchSearchPlugins()}async function I(){m.value=!0,await y.updatePlugins().then(()=>new Promise(s=>setTimeout(s,2e3))),await y.fetchSearchPlugins(),m.value=!1}async function i(){B(),E.value=!0,await y.installSearchPlugin(C.value),C.value="",setTimeout(()=>{y.fetchSearchPlugins().then(()=>E.value=!1)},1e3)}async function k(s){E.value=!0,await y.uninstallSearchPlugin(s.name),await y.fetchSearchPlugins(),E.value=!1}function O(){_.value=!1}function B(){v.value=!1}return(s,b)=>(g(),V(ie,{modelValue:n(_),"onUpdate:modelValue":b[4]||(b[4]=u=>_e(_)?_.value=u:null)},{default:a(()=>[e(se,null,{default:a(()=>[e(De,{class:"d-flex"},{default:a(()=>[S("div",null,r(s.$t("dialogs.pluginManager.title")),1),e(q),e(pe,{icon:"mdi-update",text:s.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:m.value,onClick:I},null,8,["text","loading"]),e(ie,{modelValue:v.value,"onUpdate:modelValue":b[3]||(b[3]=u=>v.value=u)},{activator:a(({props:u})=>[e(pe,A({icon:"mdi-toy-brick-plus",text:s.$t("dialogs.pluginManager.install.activator")},u,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(se,{title:s.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(oe,null,{default:a(()=>[e(n(Oe),{modelValue:N.value,"onUpdate:modelValue":b[1]||(b[1]=u=>N.value=u),onSubmit:b[2]||(b[2]=z(()=>{},["prevent"]))},{default:a(()=>[e(J,{modelValue:C.value,"onUpdate:modelValue":b[0]||(b[0]=u=>C.value=u),autofocus:"",label:s.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(re,null,{default:a(()=>[e(q),e(f,{color:"error",onClick:B},{default:a(()=>[p(r(s.$t("common.cancel")),1)]),_:1}),e(f,{color:"accent",onClick:i},{default:a(()=>[p(r(s.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(oe,null,{default:a(()=>[e(Y,{mobile:null,headers:x,"items-per-page":"-1",items:n(y).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:E.value},{"item.enabled":a(({item:u})=>[e($e,{"model-value":u.enabled,onClick:K=>D(u)},null,8,["model-value","onClick"])]),"item.url":a(({item:u})=>[S("a",{href:u.url,title:u.name},r(u.url),9,We)]),"item.actions":a(({item:u})=>[e(W,{color:"red",icon:"mdi-delete",onClick:K=>k(u)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(re,null,{default:a(()=>[e(q),e(f,{color:"accent",onClick:O},{default:a(()=>[p(r(s.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ye={class:"pa-3"},Ge={class:"d-flex align-center"},Xe={class:"text-h5 ml-2"},Ze={class:"d-flex justify-end"},ea={class:"item-header-small"},aa={class:"item-value-small"},la={class:"item-header-small"},ta={class:"item-value-small"},na={class:"item-header-small"},sa={class:"item-value-small"},ia=G({__name:"SearchEngine",setup(h){const{mobile:w}=he(),_=we(),{t:l}=ve(),y=Ue(),x=Ie(),E=Me(),m=ye(),{searchData:v}=ne(m),{useBinarySize:N,dateFormat:C}=ne(Re()),D=P(),I=P(!1),i=P(0),k=Q(()=>[{title:l("searchEngine.headers.fileName"),key:"fileName"},{title:l("searchEngine.headers.fileSize"),key:"fileSize"},{title:l("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:l("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...x.usesQbit5?[{title:l("searchEngine.headers.engineName"),key:"engineName"},{title:l("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:l("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),O=[{title:l("searchEngine.filters.category.movies"),value:"movies"},{title:l("searchEngine.filters.category.tv"),value:"tv"},{title:l("searchEngine.filters.category.music"),value:"music"},{title:l("searchEngine.filters.category.games"),value:"games"},{title:l("searchEngine.filters.category.anime"),value:"anime"},{title:l("searchEngine.filters.category.software"),value:"software"},{title:l("searchEngine.filters.category.pictures"),value:"pictures"},{title:l("searchEngine.filters.category.books"),value:"books"}].sort((o,c)=>ue.text.asc(o.title,c.title)).toSpliced(0,0,{title:l("searchEngine.filters.category.all"),value:"all"}),B=Q(()=>[{title:l("searchEngine.filters.plugins.all"),value:"all"},{title:l("searchEngine.filters.plugins.enabled"),value:"enabled"},...m.searchPlugins.filter(o=>o.enabled).map(o=>o.name).sort(ue.text.asc).map(o=>({title:o,value:o}))]),s=Q(()=>v.value[i.value]??{}),{results:b}=Be(()=>s.value.results,()=>s.value.filters?.title,o=>o.fileName);function u(){m.createNewTab(),i.value=v.value.length-1,D.value?.focus()}function K(){v.value.length!==1&&(m.deleteTab(s.value.uniqueId),i.value=Math.min(i.value,v.value.length-1))}function X(o){y.pushTorrentToQueue(o.fileUrl)}function Z(o){m.downloadTorrent(o.fileUrl,o.engineName).then(()=>o.downloaded=!0)}function ee(o){ze(o.descrLink)}async function ae(){await m.runNewSearch(s.value),s.value.timer=setInterval(()=>{be(s.value)},1e3),D.value?.saveValueToHistory()}async function F(o){await m.stopSearch(o),o.timer&&clearInterval(o.timer)}function ke(){Promise.allSettled(v.value.map(F))}async function be(o){await m.refreshResults(o)==="Stopped"&&await F(o)}function le(){_.push({name:"dashboard"})}function Se(){E.createDialog(Je)}function te(o){if(E.hasActiveDialog||I.value)return!1;o.key==="Escape"&&le()}return Ee(async()=>{document.addEventListener("keydown",te),v.value.length===0?m.createNewTab():v.value.forEach(o=>{o.id&&o.id!==0&&(o.timer=setInterval(()=>{m.refreshResults(o)},1e3))}),await m.fetchSearchPlugins()}),Pe(()=>{document.removeEventListener("keydown",te),v.value.forEach(o=>{o.timer&&clearInterval(o.timer)})}),(o,c)=>(g(),L("div",Ye,[S("div",Ge,[S("div",Xe,r(n(l)("searchEngine.title")),1),e(q),S("div",Ze,[e(f,{color:"error",icon:"mdi-stop",variant:"plain",onClick:ke}),e(f,{color:"primary",icon:"mdi-toy-brick",variant:"plain",onClick:Se}),e(f,{icon:"mdi-close",variant:"plain",onClick:le})])]),e(R,{class:"ma-0 pa-0"},{default:a(()=>[e(Ke,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e(Fe,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=t=>i.value=t),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(g(!0),L(H,null,xe(n(v),t=>(g(),V(He,{key:t.uniqueId},{default:a(()=>[S("h4",null,r(!t.lastQuery||t.lastQuery.length===0?n(l)("searchEngine.tabHeaderEmpty"):t.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(q),e(f,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:u}),e(f,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:n(v).length===1,onClick:K},null,8,["disabled"])]),_:1})]),_:1}),e(Qe,null,{default:a(()=>[e(ce,null,{default:a(()=>[e(R,{class:"mt-1"},{default:a(()=>[e(d,{cols:"12",md:"6"},{default:a(()=>[e(Le,{ref_key:"queryInput",ref:D,modelValue:s.value.query,"onUpdate:modelValue":c[1]||(c[1]=t=>s.value.query=t),"history-key":n(qe).SEARCH_ENGINE_QUERY,autofocus:"",density:"compact","hide-details":"",clearable:"",label:n(l)("searchEngine.query"),onKeydown:Ce(z(ae,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(d,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(de,{modelValue:s.value.filters.category,"onUpdate:modelValue":c[2]||(c[2]=t=>s.value.filters.category=t),height:"1",variant:"outlined",density:"compact","hide-details":"",items:n(O),label:n(l)("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(d,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(de,{modelValue:s.value.filters.plugin,"onUpdate:modelValue":c[3]||(c[3]=t=>s.value.filters.plugin=t),flat:"",density:"compact","hide-details":"",variant:"outlined",items:B.value,label:n(l)("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(d,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[s.value.id===0?(g(),V(f,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:ae},{default:a(()=>[p(r(n(l)("searchEngine.runSearch")),1)]),_:1})):(g(),V(f,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:c[4]||(c[4]=t=>F(s.value))},{default:a(()=>[p(r(n(l)("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(me,{class:"my-3"}),e(ce,{class:"text-select"},{default:a(()=>[n(w)?(g(),V(Y,{key:0,"items-per-page":s.value.itemsPerPage,"onUpdate:itemsPerPage":c[6]||(c[6]=t=>s.value.itemsPerPage=t),mobile:!0,headers:k.value,items:n(b),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{top:a(()=>[e(R,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(J,{modelValue:s.value.filters.title,"onUpdate:modelValue":c[5]||(c[5]=t=>s.value.filters.title=t),density:"compact","hide-details":"",label:n(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),item:a(({item:t,index:$})=>[$!==0?(g(),V(me,{key:0})):U("",!0),e(R,{class:"row-mobile ma-0 pa-3"},{default:a(()=>[e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[p(r(n(l)("searchEngine.headers.fileName")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[p(r(t.fileName),1)]),_:2},1024),n(x).usesQbit5?(g(),L(H,{key:0},[e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[p(r(n(l)("searchEngine.headers.engineName")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[p(r(t.engineName),1)]),_:2},1024),e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[p(r(n(l)("searchEngine.headers.pubDate")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[p(r(t.pubDate===-1?n(l)("common.NA"):n(fe)(t.pubDate,n(C))),1)]),_:2},1024)],64)):(g(),L(H,{key:1},[e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[p(r(n(l)("searchEngine.headers.siteUrl")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[p(r(t.siteUrl),1)]),_:2},1024)],64)),e(d,{cols:"3",class:"item-container"},{default:a(()=>[S("div",ea,r(n(l)("searchEngine.headers.fileSize")),1),S("div",aa,r(n(ge)(t.fileSize,n(N))),1)]),_:2},1024),e(d,{cols:"3",class:"item-container"},{default:a(()=>[S("div",la,r(n(l)("searchEngine.headers.nbSeeders")),1),S("div",ta,r(t.nbSeeders),1)]),_:2},1024),e(d,{cols:"3",class:"item-container"},{default:a(()=>[S("div",na,r(n(l)("searchEngine.headers.nbLeechers")),1),S("div",sa,r(t.nbLeechers),1)]),_:2},1024),e(d,{cols:"3",class:"item-actions"},{default:a(()=>[e(f,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:z(M=>ee(t),["stop"])},null,8,["onClick"]),e(f,{icon:"mdi-plus-box-multiple",variant:"text",density:"compact",onClick:M=>X(t)},null,8,["onClick"]),n(x).usesQbit5?(g(),V(f,{key:0,icon:t.downloaded?"mdi-check":"mdi-download",color:t.downloaded&&"accent",variant:"text",density:"compact",onClick:M=>Z(t)},null,8,["icon","color","onClick"])):U("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["items-per-page","headers","items"])):(g(),V(Y,{key:1,"items-per-page":s.value.itemsPerPage,"onUpdate:itemsPerPage":c[8]||(c[8]=t=>s.value.itemsPerPage=t),mobile:!1,headers:k.value,items:n(b),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{top:a(()=>[e(R,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(J,{modelValue:s.value.filters.title,"onUpdate:modelValue":c[7]||(c[7]=t=>s.value.filters.title=t),density:"compact","hide-details":"",label:n(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:t})=>[p(r(n(ge)(t.fileSize,n(N))),1)]),"item.pubDate":a(({value:t})=>[p(r(t===-1?n(l)("common.NA"):n(fe)(t,n(C))),1)]),"item.actions":a(({item:t})=>[e(j,{text:n(l)("searchEngine.tooltip.open_link"),location:"top"},{activator:a(({props:$})=>[e(f,A($,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:z(M=>ee(t),["stop"])}),null,16,["onClick"])]),_:2},1032,["text"]),e(j,{text:n(l)("searchEngine.tooltip.append_queue"),location:"top"},{activator:a(({props:$})=>[e(f,A($,{icon:"mdi-plus-box-multiple",variant:"text",density:"compact",onClick:M=>X(t)}),null,16,["onClick"])]),_:2},1032,["text"]),e(j,{text:n(l)("searchEngine.tooltip.download"),location:"top"},{activator:a(({props:$})=>[n(x).usesQbit5?(g(),V(f,A({key:0},$,{icon:t.downloaded?"mdi-check":"mdi-download",color:t.downloaded&&"accent",variant:"text",density:"compact",onClick:M=>Z(t)}),null,16,["icon","color","onClick"])):U("",!0)]),_:2},1032,["text"])]),_:2},1032,["items-per-page","headers","items"]))]),_:1})]),_:1})]))}}),pa=Ae(ia,[["__scopeId","data-v-02f1094a"]]);export{pa as default};
