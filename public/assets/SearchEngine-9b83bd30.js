import{d as C,m as P}from"./vue-b220ace6.js";import{b7 as I,b8 as q,a6 as M,aw as $,r as E,b9 as R,ba as N,bb as A,bc as D,Q as p,s as L,A as _,B as r,E as O,x as c,y as u,D as z,t as v,I as S,a as w,_ as T}from"./index-90e29838.js";import{_ as B}from"./VContainer-19f5802e.js";import{_ as F,a as U}from"./VTab-9d71d855.js";import{_ as j}from"./VDataTable-6e0b38a9.js";let k,b,g=0,x=0;function G(t,e,s){let a=e&&s||0;const l=e||new Array(16);t=t||{};let f=t.node||k,n=t.clockseq!==void 0?t.clockseq:b;if(f==null||n==null){const i=t.random||(t.rng||I)();f==null&&(f=k=[i[0]|1,i[1],i[2],i[3],i[4],i[5]]),n==null&&(n=b=(i[6]<<8|i[7])&16383)}let o=t.msecs!==void 0?t.msecs:Date.now(),d=t.nsecs!==void 0?t.nsecs:x+1;const y=o-g+(d-x)/1e4;if(y<0&&t.clockseq===void 0&&(n=n+1&16383),(y<0||o>g)&&t.nsecs===void 0&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=o,x=d,b=n,o+=122192928e5;const h=((o&268435455)*1e4+d)%4294967296;l[a++]=h>>>24&255,l[a++]=h>>>16&255,l[a++]=h>>>8&255,l[a++]=h&255;const m=o/4294967296*1e4&268435455;l[a++]=m>>>8&255,l[a++]=m&255,l[a++]=m>>>24&15|16,l[a++]=m>>>16&255,l[a++]=n>>>8|128,l[a++]=n&255;for(let i=0;i<6;++i)l[a+i]=f[i];return e||q(l)}const H=C({name:"SearchEngine",mixins:[M],data(){return{tabIndex:0,tabs:[],headers:[{text:"Filename",value:"fileName"},{text:"File Size",value:"fileSize"},{text:"Seeders",value:"nbSeeders"},{text:"Leechers",value:"nbLeechers"},{text:"Site URL",value:"siteUrl"},{text:"",value:"actions",sortable:!1}],mdiDownload:$,mdiClose:E,mdiToyBrick:R,mdiPlusCircleOutline:N,mdiMinusCircleOutline:A,mdiStop:D}},computed:{...P(["getModals","getSearchPlugins","shouldUseBinaryData"]),categories(){const t=[{text:"Movies",value:"movies"},{text:"TV shows",value:"tv"},{text:"Music",value:"music"},{text:"Games",value:"games"},{text:"Anime",value:"anime"},{text:"Software",value:"software"},{text:"Pictures",value:"pictures"},{text:"Books",value:"books"}];return t.sort((e,s)=>e.text.localeCompare(s.text)),[{text:"All categories",value:"all"},...t]},plugins(){const t=[{text:"All plugins",value:"all"},{text:"Only enabled",value:"enabled"}];return this.getSearchPlugins().filter(e=>e.enabled).forEach(e=>t.push({text:e.fullName,value:e.name})),t},selectedTab(){return this.tabs[this.tabIndex]},filteredResults(){return this.selectedTab.results}},async beforeMount(){if(this.tabs=this.$store.state.searchData,this.tabs.length===0)this.createNewTab();else for(const t of this.tabs)t.id&&t.id!==0&&(t.timer=setInterval(()=>this.refreshResults(t),1e3));await this.$store.dispatch("FETCH_SEARCH_PLUGINS")},mounted(){document.addEventListener("keydown",this.handleKeyboardShortcut)},async beforeDestroy(){document.removeEventListener("keydown",this.handleKeyboardShortcut);for(const t of this.tabs)t.timer&&clearInterval(t.timer)},methods:{openPluginManager(){this.createModal("SearchPluginManager")},createNewTab(){this.tabs.push({uniqueId:G(),id:0,query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null}),this.tabIndex=this.tabs.length-1;const t=this.$refs.queryInput;t&&t.focus()},async deleteTab(){await this.stopSearch(this.selectedTab),this.tabs.splice(this.tabIndex,1),this.tabIndex=Math.min(this.tabIndex,this.tabs.length-1)},downloadTorrent(t){this.createModal("AddModal",{initialMagnet:t.fileUrl})},async runNewSearch(){const t=await p.startSearch(this.selectedTab.query,this.selectedTab.filters.category,[this.selectedTab.filters.plugin]);this.selectedTab.id=t.id,this.selectedTab.results=[],this.selectedTab.timer=setInterval(()=>this.refreshResults(this.selectedTab),1e3)},async stopSearch(t){t.id&&t.id!==0&&await p.stopSearch(t.id),t.id=0,t.timer&&clearInterval(t.timer)},async stopAllSearch(){for(const t of this.tabs)await this.stopSearch(t)},customFilter(t,e){return t!=null&&e!=null&&typeof t=="string"&&e.trim().toLowerCase().split(" ").every(s=>t.toString().toLowerCase().indexOf(s)!==-1)},async refreshResults(t){const e=await p.getSearchResults(t.id,t.results.length);t.results.push(...e.results),e.status==="Stopped"&&await this.stopSearch(t)},close(){this.$router.back()},handleKeyboardShortcut(t){t.key==="Escape"&&this.getModals().length===0&&this.close()},updateTabWidth(){this.$refs.tabs&&this.$refs.tabs.onResize()}}});var K=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"px-1 px-sm-5 background noselect"},[s(_,{staticClass:"grey--text",attrs:{"no-gutters":"",align:"center",justify:"center"}},[s(r,[s("h1",{staticClass:"subtitle-1 ml-2",staticStyle:{"font-size":"1.6em !important"}},[e._v(" "+e._s(e.$t("search.title"))+" ")])]),s(r,{staticClass:"align-center justify-center"},[s(O,{staticClass:"justify-end"},[s(c,{attrs:{small:"",elevation:"0",color:"error"},on:{click:e.stopAllSearch}},[s(u,[e._v(e._s(e.mdiStop))])],1),s(c,{attrs:{small:"",elevation:"0",color:"primary"},on:{click:e.openPluginManager}},[s(u,[e._v(e._s(e.mdiToyBrick))])],1),s(c,{attrs:{small:"",elevation:"0"},on:{click:e.close}},[s(u,[e._v(e._s(e.mdiClose))])],1)],1)],1)],1),s(_,{staticClass:"ma-0 pa-0"},[s(B,{staticClass:"d-flex align-center justify-center ma-0 pa-0 primary",attrs:{fluid:""}},[s(F,{ref:"tabs",staticClass:"overflow-auto",attrs:{"align-with-title":"","show-arrows":"","background-color":"primary","slider-color":"white"},model:{value:e.tabIndex,callback:function(a){e.tabIndex=a},expression:"tabIndex"}},e._l(e.tabs,function(a){return s(U,{key:a.uniqueId,staticClass:"white--text"},[s("h4",[e._v(e._s(!a.query||a.query.length===0?e.$t("search.tabHeaderEmpty"):a.query))])])}),1),s(z),s(c,{staticClass:"mr-1",attrs:{icon:""},on:{click:e.createNewTab}},[s(u,{attrs:{color:"accent"}},[e._v(e._s(e.mdiPlusCircleOutline))])],1),s(c,{staticClass:"mx-1",attrs:{icon:"",disabled:e.tabs.length===1},on:{click:e.deleteTab}},[s(u,{attrs:{color:"error"}},[e._v(e._s(e.mdiMinusCircleOutline))])],1)],1)],1),s("div",[s(v,{attrs:{flat:""}},[s(S,{staticClass:"searchCriterias"},[s(_,{staticClass:"my-2"},[s(r,{attrs:{cols:"12",md:"6"}},[s(w,{ref:"queryInput",attrs:{autofocus:"",dense:"","hide-details":"",clearable:"",label:"Search pattern"},on:{keydown:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:(a.preventDefault(),e.runNewSearch.apply(null,arguments))},input:e.updateTabWidth},model:{value:e.selectedTab.query,callback:function(a){e.$set(e.selectedTab,"query",a)},expression:"selectedTab.query"}})],1),s(r,{attrs:{cols:"6",sm:"5",md:"2"}},[s(T,{attrs:{height:"1",flat:"",dense:"","hide-details":"",outlined:"",items:e.categories,label:"Search category"},model:{value:e.selectedTab.filters.category,callback:function(a){e.$set(e.selectedTab.filters,"category",a)},expression:"selectedTab.filters.category"}})],1),s(r,{attrs:{cols:"6",sm:"5",md:"2"}},[s(T,{attrs:{height:"1",flat:"",dense:"","hide-details":"",outlined:"",items:e.plugins,label:"Search plugins"},model:{value:e.selectedTab.filters.plugin,callback:function(a){e.$set(e.selectedTab.filters,"plugin",a)},expression:"selectedTab.filters.plugin"}})],1),s(r,{staticClass:"d-flex align-center justify-center",attrs:{cols:"12",sm:"2"}},[e.selectedTab.id===0?s(c,{staticClass:"mx-auto accent white--text elevation-0 px-4",on:{click:e.runNewSearch}},[e._v(" "+e._s(e.$t("search.runNewSearch"))+" ")]):s(c,{staticClass:"mx-auto warning white--text elevation-0 px-4",on:{click:function(a){return e.stopSearch(e.selectedTab)}}},[e._v(" "+e._s(e.$t("search.stopSearch"))+" ")])],1)],1)],1)],1),s(v,{staticClass:"mt-5",attrs:{flat:""}},[s(S,{staticClass:"searchResults"},[s(j,{staticStyle:{width:"100%"},attrs:{id:"searchResultsTable",headers:e.headers,items:e.filteredResults,"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":e.selectedTab.itemsPerPage,search:e.selectedTab.filters.title,"custom-filter":e.customFilter},on:{"update:itemsPerPage":function(a){return e.$set(e.selectedTab,"itemsPerPage",a)},"update:items-per-page":function(a){return e.$set(e.selectedTab,"itemsPerPage",a)}},scopedSlots:e._u([{key:"top",fn:function(){return[s(_,{staticClass:"mt-2"},[s(r,{attrs:{cols:"12",md:"6"}},[s(w,{attrs:{dense:"","hide-details":"",label:"Filter"},model:{value:e.selectedTab.filters.title,callback:function(a){e.$set(e.selectedTab.filters,"title",a)},expression:"selectedTab.filters.title"}})],1)],1)]},proxy:!0},{key:"item.fileSize",fn:function({item:a}){return[e._v(" "+e._s(e._f("formatData")(a.fileSize,e.shouldUseBinaryData()))+" ")]}},{key:"item.actions",fn:function({item:a}){return[s("span",{staticClass:"d-flex flex-row"},[s(u,{on:{click:function(l){return e.downloadTorrent(a)}}},[e._v(e._s(e.mdiDownload))])],1)]}}])})],1)],1)],1)],1)},Q=[],V=L(H,K,Q,!1,null,"c876f92b",null,null);const ee=V.exports;export{ee as default};
