import{b as pe,s as Q,e as V,t as Ze,k as ge,I as Pe,n as i,y as Z,F as ce,v as A,J as et,q as tt,R as Ue,f as Oe,a8 as be,a9 as Re,K,L as E,O as T,P as le,a2 as lt,u,V as ae,U as H,a1 as at,Y as re,_ as nt,W as ee}from"./vue-ByxVO3ei.js";import{v as ut}from"./index-vVaKiL2U.js";import{aQ as st,a5 as it,aR as ot,aS as rt,aE as ct,aT as vt,aU as dt,n as Ke,p as ke,at as ft,I as He,y as O,av as mt,D as _e,aV as pt,aW as gt,C as yt,aX as ht,aA as Be,N as Ct,f as bt,aY as kt,aG as Vt,aZ as Dt,h as Me,a_ as ze,aJ as St,a$ as te,b0 as $,b1 as It,aM as Ce,i as xt,v as Tt,ac as Et,b2 as Ft,b3 as Nt,ad as f,b4 as ye}from"./index-DzCewH1E.js";import{g as wt,p as $t,h as At,j as Le,w as Lt,r as Rt,u as Ut,s as Ot,t as _t,q as Mt,v as Ge,x as Pt,y as We}from"./vuetify-CRUDNqtT.js";function he(e,r){let a=0;for(;a<e.length;)e[a]===r?e.splice(a,1):++a;return e}const Kt=$t({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Vt({filterKeys:["title"]}),...kt(),...Mt(Dt({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),Xe=wt()({name:"VAutocomplete",props:Kt(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,r){let{slots:a}=r;const{t:L}=At(),m=pe(),p=Q(!1),d=Q(!0),I=Q(!1),_=pe(),x=pe(),l=Q(-1),D=Q(null),{items:b,transformIn:R,transformOut:B}=st(e),{textColorClasses:z,textColorStyles:X}=it(()=>m.value?.color),{InputIcon:ve}=ot(e),g=Le(e,"search",""),s=Le(e,"modelValue",[],t=>R(t===null?[null]:Lt(t)),t=>{const c=B(t);return e.multiple?c:c[0]??null}),Ve=V(()=>typeof e.counterValue=="function"?e.counterValue(s.value):typeof e.counterValue=="number"?e.counterValue:s.value.length),P=rt(e),{filteredItems:ne,getMatches:De}=ct(e,b,()=>D.value??(d.value?"":g.value)),U=V(()=>e.hideSelected&&D.value===null?ne.value.filter(t=>!s.value.some(c=>c.value===t.value)):ne.value),de=Ze(()=>e.closableChips&&!P.isReadonly.value&&!P.isDisabled.value),j=V(()=>!!(e.chips||a.chip)),G=V(()=>j.value||!!a.selection),fe=V(()=>s.value.map(t=>t.props.value)),W=V(()=>U.value.find(t=>t.type==="item"&&!t.props.disabled)),ue=V(()=>(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&g.value===W.value?.title)&&U.value.length>0&&!d.value&&!I.value),J=V(()=>e.hideNoData&&!U.value.length||P.isReadonly.value||P.isDisabled.value),Y=Le(e,"menu"),y=V({get:()=>Y.value,set:t=>{Y.value&&!t&&_.value?.Î¨openChildren.size||t&&J.value||(Y.value=t)}}),{menuId:Se,ariaExpanded:Ie,ariaControls:xe}=vt(e,y),se=pe(),Te=dt(se,m);function Ee(t){e.openOnClear&&(y.value=!0),g.value=""}function Fe(){J.value||(y.value=!0)}function Ne(t){J.value||(p.value&&(t.preventDefault(),t.stopPropagation()),y.value=!y.value)}function we(t){(Ge(t)||t.key==="Backspace")&&m.value?.focus()}function $e(t){if(P.isReadonly.value)return;const c=m.value?.selectionStart,k=s.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(y.value=!0),["Escape"].includes(t.key)&&(y.value=!1),ue.value&&["Enter","Tab"].includes(t.key)&&W.value&&!s.value.some(v=>{let{value:S}=v;return S===W.value.value})&&q(W.value),t.key==="ArrowDown"&&ue.value&&se.value?.focus("next"),["Backspace","Delete"].includes(t.key)){if(!e.multiple&&G.value&&s.value.length>0&&!g.value)return q(s.value[0],!1);if(~l.value){t.preventDefault();const v=l.value;q(s.value[l.value],!1),l.value=v>=k-1?k-2:v}else t.key==="Backspace"&&!g.value&&(l.value=k-1);return}if(e.multiple)if(t.key==="ArrowLeft"){if(l.value<0&&c&&c>0)return;const v=l.value>-1?l.value-1:k-1;if(s.value[v])l.value=v;else{const S=g.value?.length??null;l.value=-1,m.value?.setSelectionRange(S,S)}}else if(t.key==="ArrowRight"){if(l.value<0)return;const v=l.value+1;s.value[v]?l.value=v:(l.value=-1,m.value?.setSelectionRange(0,0))}else~l.value&&Ge(t)&&(l.value=-1)}function n(t){if(We(m.value,":autofill")||We(m.value,":-webkit-autofill")){const c=b.value.find(k=>k.title===t.target.value);c&&q(c)}}function h(){e.eager&&x.value?.calculateVisibleItems()}function w(){p.value&&(d.value=!0,m.value?.focus()),D.value=null}function F(t){p.value=!0,setTimeout(()=>{I.value=!0})}function je(t){I.value=!1}function Ye(t){(t==null||t===""&&!e.multiple&&!G.value)&&(s.value=[])}const Ae=Q(!1);function q(t){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!t||t.props.disabled))if(e.multiple){const k=s.value.findIndex(S=>(e.valueComparator||Pt)(S.value,t.value)),v=c??!~k;if(~k){const S=v?[...s.value,t]:[...s.value];S.splice(k,1),s.value=S}else v&&(s.value=[...s.value,t]);e.clearOnSelect&&(g.value="")}else{const k=c!==!1;s.value=k?[t]:[],D.value=d.value?"":g.value??"",g.value=k&&!G.value?t.title:"",Pe(()=>{y.value=!1,d.value=!0})}}return ge(p,(t,c)=>{t!==c&&(t?(Ae.value=!0,g.value=e.multiple||G.value?"":String(s.value.at(-1)?.props.title??""),d.value=!0,Pe(()=>Ae.value=!1)):(!e.multiple&&g.value==null&&(s.value=[]),y.value=!1,!d.value&&g.value&&(D.value=g.value),g.value="",l.value=-1))}),ge(g,t=>{!p.value||Ae.value||(t&&(y.value=!0),d.value=!t)}),ge(y,t=>{if(!e.hideSelected&&t&&s.value.length&&d.value){const c=U.value.findIndex(k=>s.value.some(v=>k.value===v.value));Rt&&window.requestAnimationFrame(()=>{c>=0&&x.value?.scrollToIndex(c)})}t&&(D.value=null)}),ge(b,(t,c)=>{y.value||p.value&&!c.length&&t.length&&(y.value=!0)}),Ut(()=>{const t=!!(!e.hideNoData||U.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),c=s.value.length>0,k=Ke.filterProps(e);return i(Ke,A({ref:m},k,{modelValue:g.value,"onUpdate:modelValue":[v=>g.value=v,Ye],focused:p.value,"onUpdate:focused":v=>p.value=v,validationValue:s.externalValue,counterValue:Ve.value,dirty:c,onChange:n,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":y.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!G.value,"v-autocomplete--selecting-index":l.value>-1},e.class],style:e.style,readonly:P.isReadonly.value,placeholder:c?void 0:e.placeholder,"onClick:clear":Ee,"onMousedown:control":Fe,onKeydown:$e,"aria-expanded":Ie.value,"aria-controls":xe.value}),{...a,default:v=>{let{id:S}=v;return Z(ce,null,[i(ft,A({id:Se.value,ref:_,modelValue:y.value,"onUpdate:modelValue":C=>y.value=C,activator:"parent",contentClass:"v-autocomplete__content",disabled:J.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:h,onAfterLeave:w},e.menuProps),{default:()=>[t&&i(He,A({ref:se,filterable:!0,selected:fe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:C=>C.preventDefault(),onKeydown:we,onFocusin:F,onFocusout:je,tabindex:"-1",selectable:!0,"aria-live":"polite","aria-labelledby":`${S.value}-label`,"aria-multiselectable":e.multiple,color:e.itemColor??e.color},Te,e.listProps),{default:()=>[a["prepend-item"]?.(),!U.value.length&&!e.hideNoData&&(a["no-data"]?.()??i(O,{key:"no-data",title:L(e.noDataText)},null)),i(mt,{ref:x,renderless:!0,items:U.value,itemKey:"value"},{default:C=>{let{item:o,index:M,itemRef:me}=C;const ie=A(o.props,{ref:me,key:o.value,active:ue.value&&o===W.value?!0:void 0,onClick:()=>q(o,null),"aria-posinset":M+1,"aria-setsize":U.value.length});return o.type==="divider"?a.divider?.({props:o.raw,index:M})??i(_e,A(o.props,{key:`divider-${M}`}),null):o.type==="subheader"?a.subheader?.({props:o.raw,index:M})??i(pt,A(o.props,{key:`subheader-${M}`}),null):a.item?.({item:o,index:M,props:ie})??i(O,A(ie,{role:"option"}),{prepend:oe=>{let{isSelected:N}=oe;return Z(ce,null,[e.multiple&&!e.hideSelected?i(yt,{key:o.value,modelValue:N,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Qe=>Qe.preventDefault()},null):void 0,o.props.prependAvatar&&i(ht,{image:o.props.prependAvatar},null),o.props.prependIcon&&i(ke,{icon:o.props.prependIcon},null)])},title:()=>d.value?o.title:gt("v-autocomplete",o.title,De(o)?.title)})}}),a["append-item"]?.()]})]}),s.value.map((C,o)=>{function M(N){N.stopPropagation(),N.preventDefault(),q(C,!1)}const me=A(Be.filterProps(C.props),{"onClick:close":M,onKeydown(N){N.key!=="Enter"&&N.key!==" "||(N.preventDefault(),N.stopPropagation(),M(N))},onMousedown(N){N.preventDefault(),N.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),ie=j.value?!!a.chip:!!a.selection,oe=ie?_t(j.value?a.chip({item:C,index:o,props:me}):a.selection({item:C,index:o})):void 0;if(!(ie&&!oe))return Z("div",{key:C.value,class:tt(["v-autocomplete__selection",o===l.value&&["v-autocomplete__selection--selected",z.value]]),style:et(o===l.value?X.value:{})},[j.value?a.chip?i(Ct,{key:"chip-defaults",defaults:{VChip:{closable:de.value,size:"small",text:C.title}}},{default:()=>[oe]}):i(Be,A({key:"chip",closable:de.value,size:"small",text:C.title,disabled:C.props.disabled},me),null):oe??Z("span",{class:"v-autocomplete__selection-text"},[C.title,e.multiple&&o<s.value.length-1&&Z("span",{class:"v-autocomplete__selection-comma"},[Ue(",")])])])})])},"append-inner":function(){for(var v=arguments.length,S=new Array(v),C=0;C<v;C++)S[C]=arguments[C];return Z(ce,null,[a["append-inner"]?.(...S),e.menuIcon?i(ke,{class:"v-autocomplete__menu-icon",color:m.value?.fieldIconColor,icon:e.menuIcon,onMousedown:Ne,onClick:Ot,"aria-hidden":!0,tabindex:"-1"},null):void 0,e.appendInnerIcon&&i(ve,{key:"append-icon",name:"appendInner",color:S[0].iconColor.value},null)])}})}),bt({isFocused:p,isPristine:d,menu:y,search:g,filteredItems:ne,select:q},m)}}),Bt={key:0,class:"text-accent"},Gt={key:1,class:"text-accent"},Je=Oe({__name:"FilterSelectMulti",props:be({title:{},items:{},filterType:{}},{include:{required:!0},includeModifiers:{},exclude:{required:!0},excludeModifiers:{}}),emits:be(["disable","toggleFilterType"],["update:include","update:exclude"]),setup(e){const r=Re(e,"include"),a=Re(e,"exclude"),{t:L}=Me(),m=V(()=>r.value.length+a.value.length);function p(l){return r.value.includes(l)?$.INCLUDED:a.value.includes(l)?$.EXCLUDED:$.DISABLED}function d(l){switch(p(l)){case $.INCLUDED:return"mdi-plus-box";case $.EXCLUDED:return"mdi-minus-box";case $.DISABLED:default:return"mdi-checkbox-blank-outline"}}function I(l){switch(p(l)){case $.INCLUDED:return"text-green";case $.EXCLUDED:return"text-red";default:return}}function _(l){switch(p(l)){case $.INCLUDED:he(r.value,l),a.value.push(l);break;case $.EXCLUDED:he(a.value,l);break;case $.DISABLED:default:r.value.push(l)}}function x(l){he(r.value,l),he(a.value,l)}return(l,D)=>(E(),K(O,{class:"px-0 pb-3"},{default:T(()=>[i(ze,{class:"px-0 text-uppercase ml-1 font-weight-light text-subtitle-2"},{default:T(()=>[Ue(le(e.title),1)]),_:1}),i(Xe,{"model-value":[...r.value,...a.value],items:e.items,placeholder:u(L)("navbar.side.filters.disabled"),"bg-color":"secondary",class:"text-accent pt-1",density:"compact","hide-details":"",multiple:"",variant:"solo"},{prepend:T(()=>[i(St,{location:"right",text:u(L)(e.filterType===u(te).CONJUNCTIVE?"constants.filter_type.conjunctive":"constants.filter_type.disjunctive")},{activator:T(({props:b})=>[i(ke,A(b,{icon:e.filterType===u(te).CONJUNCTIVE?"mdi-set-center":"mdi-set-all",onClick:D[0]||(D[0]=R=>l.$emit("toggleFilterType"))}),null,16,["icon"])]),_:1},8,["text"])]),"prepend-item":T(()=>[i(O,{title:u(L)("common.disable"),onClick:D[1]||(D[1]=b=>l.$emit("disable"))},null,8,["title"]),i(_e)]),selection:T(({item:b,index:R})=>[R===0&&m.value===1?(E(),ae("span",Bt,le(b.title),1)):R===0?(E(),ae("span",Gt,le(u(L)("navbar.side.filters.activeFilter",m.value)),1)):H("",!0)]),item:T(({item:b,props:R})=>[lt((E(),K(O,A(R,{"data-custom-context-menu":"",class:I(b.value),onClick:B=>_(b.value),onContextmenu:B=>x(b.value)}),{prepend:T(()=>[i(ke,{icon:d(b.value)},null,8,["icon"])]),_:2},1040,["class","onClick","onContextmenu"])),[[u(ut),()=>x(b.value)]])]),_:1},8,["model-value","items","placeholder"])]),_:1}))}}),Wt={key:0,class:"text-accent"},Jt={key:1,class:"text-accent"},qe=Oe({__name:"FilterSelectSingle",props:be({title:{},items:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:be(["disable"],["update:modelValue"]),setup(e){const r=e,a=Re(e,"modelValue"),L=It(()=>r.items,(p,d)=>Ce.text.asc(p.title,d.title)),{t:m}=Me();return(p,d)=>(E(),K(O,{class:"px-0 pb-3"},{default:T(()=>[i(ze,{class:"px-0 text-uppercase ml-1 font-weight-light text-subtitle-2"},{default:T(()=>[Ue(le(e.title),1)]),_:1}),i(Xe,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=I=>a.value=I),items:u(L),placeholder:u(m)("navbar.side.filters.disabled"),"bg-color":"secondary",class:"text-accent pt-1",density:"compact","hide-details":"",multiple:"",variant:"solo"},{"prepend-item":T(()=>[i(O,{title:u(m)("common.disable"),onClick:d[0]||(d[0]=I=>p.$emit("disable"))},null,8,["title"]),at(p.$slots,"prepend-item"),i(_e)]),selection:T(({item:I,index:_})=>[_===0&&a.value.length===1?(E(),ae("span",Wt,le(I.title),1)):_===0?(E(),ae("span",Jt,le(u(m)("navbar.side.filters.activeFilter",a.value.length)),1)):H("",!0)]),_:3},8,["modelValue","items","placeholder"])]),_:3}))}}),jt=Oe({__name:"Filters",setup(e){const{t:r,getTorrentStateString:a}=Me(),{categories:L,torrentsByCategory:m}=re(xt()),{tags:p,torrentsByTag:d}=re(Tt()),{torrents:I,torrentsByStatus:_,statusFilter:x,categoryFilter:l,tagFilterInclude:D,tagFilterExclude:b,tagFilterType:R,torrentsByTracker:B,trackerFilterInclude:z,trackerFilterExclude:X,trackerFilterType:ve}=re(Et()),{hostnameTrackers:g}=re(Ft()),{filters:s,showFilterState:Ve,showFilterCategory:P,showFilterTag:ne,showFilterTracker:De}=re(Nt()),U=V(()=>Object.values(f).filter(n=>typeof n=="number").map(n=>({title:`${a(n)} (${_.value[n]??0})`,value:n})).sort((n,h)=>Ce.text.asc(n.title,h.title))),de=V(()=>[{title:`${r("navbar.side.filters.category.empty")} (${m.value[""]??0})`,value:""},...L.value.map(n=>({title:`${n.name} (${m.value[n.name]??0})`,value:n.name}))]),j=V(()=>[{title:`${r("navbar.side.filters.tag.empty")} (${d.value[""]??0})`,value:null},...p.value.map(n=>({title:`${n} (${d.value[n]??0})`,value:n})).sort((n,h)=>Ce.text.asc(n.value,h.value))]),G=V(()=>[{title:`${r("navbar.side.filters.tracker.empty")} (${B.value[ye.UNTRACKED]??0})`,value:ye.UNTRACKED},{title:`${r("navbar.side.filters.tracker.not_working")} (${B.value[ye.NOT_WORKING]??0})`,value:ye.NOT_WORKING},...g.value.map(n=>({title:`${n} (${B.value[n]??0})`,value:n})).sort((n,h)=>Ce.text.asc(n.title,h.title))]);function fe(n){switch(n.value){case te.CONJUNCTIVE:n.value=te.DISJUNCTIVE;break;case te.DISJUNCTIVE:n.value=te.CONJUNCTIVE;break}}function W(){fe(R)}function ue(){fe(ve)}const J=[f.UPLOADING,f.CHECKING_DISK,f.UL_FORCED,f.DOWNLOADING,f.META_DOWNLOAD,f.FORCED_META_DOWNLOAD,f.CHECKING_DISK,f.DL_FORCED,f.CHECKING_RESUME_DATA,f.MOVING],Y=[f.ERROR,f.MISSING_FILES,f.UNKNOWN],y=[f.ERROR,f.MISSING_FILES,f.UNKNOWN,f.MOVING,f.DL_STOPPED,f.DL_STALLED,f.UL_STOPPED,f.CHECKING_DISK,f.CHECKING_RESUME_DATA];function Se(){x.value=[]}const Ie=V(()=>I.value.filter(n=>J.includes(n.state)).length);function xe(){x.value=J}const se=V(()=>I.value.filter(n=>Y.includes(n.state)).length);function Te(){x.value=Y}const Ee=V(()=>I.value.filter(n=>y.includes(n.state)).length);function Fe(){x.value=y}function Ne(){l.value=[]}function we(){D.value=[],b.value=[]}function $e(){z.value=[],X.value=[]}return(n,h)=>u(Ve)||u(P)||u(ne)||u(De)?(E(),K(He,{key:0,class:"pb-0 inherit-fg"},{default:T(()=>[(E(!0),ae(ce,null,nt(u(s),w=>(E(),ae(ce,{key:w.name},[w.name==="state"&&w.active?(E(),K(qe,{key:0,modelValue:u(x),"onUpdate:modelValue":h[0]||(h[0]=F=>ee(x)?x.value=F:null),title:u(r)("navbar.side.filters.state.title"),items:U.value,onDisable:Se},{"prepend-item":T(()=>[i(O,{title:`${u(r)("navbar.side.filters.state.active")} (${Ie.value})`,onClick:xe},null,8,["title"]),i(O,{title:`${u(r)("navbar.side.filters.state.error")} (${se.value})`,onClick:Te},null,8,["title"]),i(O,{title:`${u(r)("navbar.side.filters.state.offline")} (${Ee.value})`,onClick:Fe},null,8,["title"])]),_:1},8,["modelValue","title","items"])):H("",!0),w.name==="category"&&w.active?(E(),K(qe,{key:1,modelValue:u(l),"onUpdate:modelValue":h[1]||(h[1]=F=>ee(l)?l.value=F:null),title:u(r)("navbar.side.filters.category.title"),items:de.value,onDisable:Ne},null,8,["modelValue","title","items"])):H("",!0),w.name==="tag"&&w.active?(E(),K(Je,{key:2,include:u(D),"onUpdate:include":h[2]||(h[2]=F=>ee(D)?D.value=F:null),exclude:u(b),"onUpdate:exclude":h[3]||(h[3]=F=>ee(b)?b.value=F:null),title:u(r)("navbar.side.filters.tag.title"),items:j.value,"filter-type":u(R),onDisable:we,onToggleFilterType:W},null,8,["include","exclude","title","items","filter-type"])):H("",!0),w.name==="tracker"&&w.active?(E(),K(Je,{key:3,include:u(z),"onUpdate:include":h[4]||(h[4]=F=>ee(z)?z.value=F:null),exclude:u(X),"onUpdate:exclude":h[5]||(h[5]=F=>ee(X)?X.value=F:null),title:u(r)("navbar.side.filters.tracker.title"),items:G.value,"filter-type":u(ve),onDisable:$e,onToggleFilterType:ue},null,8,["include","exclude","title","items","filter-type"])):H("",!0)],64))),128))]),_:1})):H("",!0)}});export{jt as default};
