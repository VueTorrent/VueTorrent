import{n as s,v as X,y as c,a8 as De,a9 as $e,B as Ee,t as D,e as Q,s as te,f as Pe,b as N,A as Ue,r as Ge,k as He,H as Le,J as u,K as d,M as n,S as x,Q as v,u as h,q as O,V as A,W as K,N as oe,F as se,$ as Ae,X as Ke,a1 as Z}from"./vue-BP8Ys_mB.js";import{S as Me,a6 as Xe,aP as je,a4 as qe,u as ze,b as We,aQ as Oe,m as Qe,a7 as Je,a9 as Ye,aR as Ze,a as m,aS as ea,aT as aa,aU as la,aV as ta,aW as oa,q as sa,o as na,r as da,s as ra,aF as ia,aG as ua,A as ne,v as ca,G as fa,F as M,am as de,an as re,I as ma,az as ee,aX as ie,J as ue,Q as ga,H as ya,K as va,B as ha}from"./index-rLxVmJg1.js";import{u as ba}from"./TorrentDetail-C8tbREAl.js";import{V as pa}from"./VForm-DqYRZ16z.js";import{g as ge,p as ye,i as ka,b as Va,a as ve,o as Na,f as Fa,m as Ta,I as Ra,j as Ca,q as wa,e as ae}from"./vuetify-B343E58S.js";import{c as xa,a as Sa,b as _a,u as Ia,p as Ba,d as Da,e as $a,f as Ea,g as Pa,h as Ua,i as Ga,j as ce,k as fe,l as me,m as Ha,n as La,o as he}from"./VDataTable-Dfl3Zbuf.js";import"./ColoredChip.vue_vue_type_script_setup_true_lang-H-67EtRT.js";import"./index-Bga6siDy.js";import"./VSheet-Dr-XrN9Z.js";import"./VEmptyState-DEYoIG95.js";import"./VTabs-DflrH7yM.js";import"./VPagination-DuOYTpvD.js";const Aa=ye({bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:Ra,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...Ta(),...Ye({location:"top end"}),...Je(),...Qe(),...Fa(),...Oe({transition:"scale-rotate-transition"}),...We()},"VBadge"),Ka=ge()({name:"VBadge",inheritAttrs:!1,props:Aa(),setup(a,g){const{backgroundColorClasses:F,backgroundColorStyles:r}=Me(()=>a.color),{roundedClasses:p}=Xe(a),{t:k}=ka(),{textColorClasses:T,textColorStyles:S}=je(()=>a.textColor),{themeClasses:R}=Va(),{locationStyles:V}=qe(a,!0,f=>(a.floating?a.dot?2:4:a.dot?8:12)+(["top","bottom"].includes(f)?Number(a.offsetY??0):["left","right"].includes(f)?Number(a.offsetX??0):0)),{dimensionStyles:C}=ze(a);return ve(()=>{const f=Number(a.content),_=!a.max||isNaN(f)?a.content:f<=Number(a.max)?f:`${a.max}+`,[I,$]=Na(g.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return s(a.tag,X({class:["v-badge",{"v-badge--bordered":a.bordered,"v-badge--dot":a.dot,"v-badge--floating":a.floating,"v-badge--inline":a.inline},a.class]},$,{style:a.style}),{default:()=>[c("div",{class:"v-badge__wrapper"},[g.slots.default?.(),s(Ze,{transition:a.transition},{default:()=>[De(c("span",X({class:["v-badge__badge",R.value,F.value,p.value,T.value],style:[r.value,S.value,C.value,a.inline?{}:V.value],"aria-atomic":"true","aria-label":k(a.label,f),"aria-live":"polite",role:"status"},I),[a.dot?void 0:g.slots.badge?g.slots.badge?.():a.icon?s(m,{icon:a.icon},null):_]),[[$e,a.modelValue]])]})])]})}),{}}}),Ma=ye({...wa(La(),["hideDefaultFooter"]),...Ha(),...ta(),...la()},"VDataTableVirtual"),Xa=ge()({name:"VDataTableVirtual",props:Ma(),emits:{"update:modelValue":a=>!0,"update:sortBy":a=>!0,"update:options":a=>!0,"update:groupBy":a=>!0,"update:expanded":a=>!0},setup(a,g){let{attrs:F,slots:r}=g;const{groupBy:p}=xa(a),{sortBy:k,multiSort:T,mustSort:S}=Sa(a),{disableSort:R}=Ee(a),{columns:V,headers:C,filterFunctions:f,sortFunctions:_,sortRawFunctions:I}=_a(a,{groupBy:p,showSelect:D(()=>a.showSelect),showExpand:D(()=>a.showExpand)}),{items:$}=Ia(a,V),j=D(()=>a.search),{filteredItems:y}=ea(a,$,j,{transform:b=>b.columns,customKeyFilter:f}),{toggleSort:P}=Ba({sortBy:k,multiSort:T,mustSort:S}),{sortByWithGroups:q,opened:U,extractRows:G,isGroupOpen:z,toggleGroup:W}=Da({groupBy:p,sortBy:k,disableSort:R}),{sortedItems:H}=$a(a,y,q,{transform:b=>({...b.raw,...b.columns}),sortFunctions:_,sortRawFunctions:I}),{flatItems:L}=Ea(H,p,U),B=Q(()=>G(L.value)),{isSelected:t,select:o,selectAll:l,toggleSelect:e,someSelected:i,allSelected:J}=Pa(a,{allItems:B,currentPage:B}),{isExpanded:be,toggleExpand:pe}=Ua(a),{containerRef:ke,markerRef:Ve,paddingTop:Ne,paddingBottom:Fe,computedItems:Te,handleItemResize:Re,handleScroll:Ce,handleScrollend:we,calculateVisibleItems:xe,scrollToIndex:Se}=aa(a,L),_e=Q(()=>Te.value.map(b=>b.raw));Ga({sortBy:k,page:te(1),itemsPerPage:te(-1),groupBy:p,search:j}),Ca({VDataTableRows:{hideNoData:D(()=>a.hideNoData),noDataText:D(()=>a.noDataText),loading:D(()=>a.loading),loadingText:D(()=>a.loadingText)}});const w=Q(()=>({sortBy:k.value,toggleSort:P,someSelected:i.value,allSelected:J.value,isSelected:t,select:o,selectAll:l,toggleSelect:e,isExpanded:be,toggleExpand:pe,isGroupOpen:z,toggleGroup:W,items:B.value.map(b=>b.raw),internalItems:B.value,groupedItems:L.value,columns:V.value,headers:C.value}));return ve(()=>{const b=ce.filterProps(a),Ie=fe.filterProps(a),Be=me.filterProps(a);return s(me,X({class:["v-data-table",{"v-data-table--loading":a.loading},a.class],style:a.style},Be,{fixedHeader:a.fixedHeader||a.sticky}),{top:()=>r.top?.(w.value),wrapper:()=>c("div",{ref:ke,onScrollPassive:Ce,onScrollend:we,class:"v-table__wrapper",style:{height:ae(a.height)}},[c("table",null,[r.colgroup?.(w.value),!a.hideDefaultHeader&&c("thead",{key:"thead"},[s(ce,b,r)]),r.thead?.(w.value),!a.hideDefaultBody&&c("tbody",{key:"tbody"},[c("tr",{ref:Ve,style:{height:ae(Ne.value),border:0}},[c("td",{colspan:V.value.length,style:{height:0,border:0}},null)]),r["body.prepend"]?.(w.value),s(fe,X(F,Ie,{items:_e.value}),{...r,item:E=>s(oa,{key:E.internalItem.index,renderless:!0,"onUpdate:height":Y=>Re(E.internalItem.index,Y)},{default:Y=>{let{itemRef:le}=Y;return r.item?.({...E,itemRef:le})??s(he,X(E.props,{ref:le,key:E.internalItem.index,index:E.internalItem.index}),r)}})}),r["body.append"]?.(w.value),c("tr",{style:{height:ae(Fe.value),border:0}},[c("td",{colspan:V.value.length,style:{height:0,border:0}},null)])]),r.tbody?.(w.value),r.tfoot?.(w.value)])]),bottom:()=>r.bottom?.(w.value)})}),{calculateVisibleItems:xe,scrollToIndex:Se}}}),ja=["onClick"],qa={key:1},za={key:1},Wa={class:"d-flex flex-column pl-3"},dl=Pe({__name:"BulkRenameFilesDialog",props:{guid:{},node:{},hash:{}},setup(a){const g=a,{isOpened:F}=sa(g.guid),{t:r}=na(),p=ba(),k=N(),T=N(!1),S=N(!1),R=N(""),V=N(),C=N([]),f=N(""),_=N(),I=N(!1),$=[t=>!!t],j=Ue([{fixed:!0,sortable:!1,key:"selected",width:"50px"},{title:r("dialogs.bulkRenameFiles.col_origin_name"),sortable:!1,key:"name"},{title:r("dialogs.bulkRenameFiles.col_result_name"),sortable:!1,key:"targetName"}]),y=Ge([]),P=Q(()=>y.filter(t=>t.type==="file"&&t.selected&&t.targetName&&t.name!==t.targetName));function q(t,o,l=0){const e={indent:l,name:t.name,fullName:t.fullName,parentItem:o,show:!0,folded:!1,selected:!1,type:t.type,node:t};if(y.push(e),t.type==="folder")for(const i of t.children)q(i,e,l+1)}function U(t,o){t.folded=o,t.node.children.forEach(l=>{const e=y.find(i=>i.node.id===l.id);e.show=!o,e.type==="folder"&&o&&U(e,o)})}function G(t){const o=y.find(l=>l.node.id===t.id);if(t.type==="folder"){let l=0,e=0;return t.children.forEach(i=>{switch(G(i)){case 1:l++;break;case 0:e++;break}}),l===0&&e===0?(o.selected=!1,o.indeterminate=!1,-1):l===t.children.length?(o.selected=!0,o.indeterminate=!1,1):(o.indeterminate=!0,0)}else return o.indeterminate=!1,o.selected?1:-1}function z(t){function o(l){l.node.children.forEach(e=>{const i=y.find(J=>J.node.id===e.id);i&&(i.selected=l.selected,i.selected&&(i.show=!0,i.folded=!1),i.type==="folder"&&o(i))}),l.selected&&(l.show=!0,l.folded=!1)}o(t),G(g.node),H()}function W(t){G(g.node),H([t])}async function H(t){if(await k.value?.validate(),!T.value)return;let o;try{o=new RegExp(R.value,C.value.join(""))}catch{return}(t??y).forEach(e=>{e.type==="file"&&(e.selected&&o.test(e.name)?(e.targetName=e.name.replace(o,f.value),e.targetFullName=(e.parentItem.fullName===""?"":e.parentItem.fullName+"/")+e.targetName):(e.targetName=void 0,e.targetFullName=void 0),e.notChanged=e.name===e.targetName)}),S.value=!1;const l=new Map;y.filter(e=>!!e.targetFullName).forEach(e=>{l.set(e.targetFullName,(l.get(e.targetFullName)||0)+1)}),y.forEach(e=>{e.duplicated=l.get(e.targetFullName)>1,e.duplicated&&(S.value=!0)})}function L(){if(!P.value.length)return Z.warn(r("dialogs.bulkRenameFiles.nothing_to_do"));const t=[];for(const o of P.value)t.push(p.renameTorrentFile(g.hash,o.fullName,o.targetFullName));I.value=!0,Promise.all(t).then(()=>{Z.success(r("dialogs.bulkRenameFiles.success")),V.value?.saveValueToHistory(),_.value?.saveValueToHistory()}).catch(o=>{Z.error(o.toString())}).finally(()=>{I.value=!1,p.updateFileTreeTask.perform(),B()})}function B(){F.value=!1}return He([R,C,f],()=>{H()}),Le(()=>{q(g.node)}),(t,o)=>(d(),u(ha,{modelValue:h(F),"onUpdate:modelValue":o[6]||(o[6]=l=>Ke(F)?F.value=l:null),persistent:"",fullscreen:""},{default:n(()=>[s(da,{density:"compact"},{default:n(()=>[s(ra,null,{default:n(()=>[s(ia,{density:"compact",color:"transparent"},{default:n(()=>[s(ua,null,{default:n(()=>[x(v(t.$t("dialogs.bulkRenameFiles.title")),1)]),_:1}),s(ne,{icon:"mdi-close",onClick:o[0]||(o[0]=l=>B())})]),_:1})]),_:1}),s(ca,{class:"d-flex flex-column"},{default:n(()=>[s(h(pa),{ref_key:"form",ref:k,modelValue:T.value,"onUpdate:modelValue":o[5]||(o[5]=l=>T.value=l)},{default:n(()=>[s(fa,{"no-gutters":"",align:"center",justify:"center"},{default:n(()=>[s(M,{cols:t.$vuetify.display.mobile?9:void 0},{default:n(()=>[s(de,{ref_key:"regexpEl",ref:V,modelValue:R.value,"onUpdate:modelValue":o[1]||(o[1]=l=>R.value=l),"history-key":h(re).BULK_RENAME_REGEXP,"hide-details":"",density:"compact",rules:$,label:t.$t("dialogs.bulkRenameFiles.regexp")},null,8,["modelValue","history-key","label"])]),_:1},8,["cols"]),s(M,{cols:t.$vuetify.display.mobile?3:"auto"},{default:n(()=>[s(ma,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=l=>C.value=l),class:"ml-2",items:["d","g","i","m","s","u","v","y"],placeholder:h(r)("dialogs.bulkRenameFiles.select_regex_flags"),label:t.$t("dialogs.bulkRenameFiles.flags"),density:"compact",multiple:"","hide-details":""},null,8,["modelValue","placeholder","label"])]),_:1},8,["cols"]),s(M,{cols:"auto"},{default:n(()=>[s(m,{class:"mx-2",icon:`mdi-arrow-${t.$vuetify.display.mobile?"down":"right"}`},null,8,["icon"])]),_:1}),s(M,{cols:t.$vuetify.display.mobile?12:void 0},{default:n(()=>[s(de,{ref_key:"targetEl",ref:_,modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=l=>f.value=l),"history-key":h(re).BULK_RENAME_TARGET,"hide-details":"",density:"compact",rules:$,label:t.$t("dialogs.bulkRenameFiles.target")},null,8,["modelValue","history-key","label"])]),_:1},8,["cols"]),s(M,{cols:"auto"},{default:n(()=>[s(Ka,{class:O(t.$vuetify.display.mobile?"mt-2":"ml-5"),color:"success",location:"top left",content:P.value.length},{default:n(()=>[s(ne,{loading:I.value,disabled:!T.value||S.value,color:"primary",onClick:o[4]||(o[4]=l=>L())},{default:n(()=>[x(v(t.$t("dialogs.bulkRenameFiles.run")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["class","content"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t.$vuetify.display.mobile?(d(),u(ga,{key:1},{default:n(()=>[(d(!0),K(se,null,Ae(y,(l,e)=>(d(),K(se,null,[l.show?(d(),u(ya,{key:e},{default:n(()=>[e>0?(d(),u(va,{key:0,class:"my-2"})):A("",!0),c("div",{class:"d-flex align-center",style:oe({"padding-left":`${l.indent*16}px`})},[s(ue,{modelValue:l.selected,"onUpdate:modelValue":i=>l.selected=i,inline:"",color:l.targetName&&"accent",indeterminate:l.type==="folder"&&l.indeterminate,onChange:i=>l.type==="file"?W(l):z(l)},null,8,["modelValue","onUpdate:modelValue","color","indeterminate","onChange"]),l.type==="folder"?(d(),u(m,{key:0,onClick:i=>l.type==="folder"&&U(l,!l.folded)},{default:n(()=>[x(v(`mdi-chevron-${l.folded?"down":"up"}`),1)]),_:2},1032,["onClick"])):A("",!0),l.fullName===""?(d(),u(m,{key:1,icon:"mdi-file-tree"})):l.type==="file"?(d(),u(m,{key:2,icon:h(ie)(l.name)},null,8,["icon"])):l.folded?(d(),u(m,{key:4,icon:"mdi-folder",color:"#ffe476"})):(d(),u(m,{key:3,icon:"mdi-folder-open",color:"#ffe476"})),c("div",Wa,[c("span",{class:O({"text-grey strikethrough":l.targetName})},v(l.name),3),c("span",null,v(l.targetName),1)])],4)]),_:2},1024)):A("",!0)],64))),256))]),_:1})):(d(),u(Xa,{key:0,headers:h(j),items:y,density:"compact","fixed-header":""},{item:n(({internalItem:l})=>[l.raw.show?(d(),u(he,{key:0,item:l},{"item.selected":n(({item:e})=>[s(ue,{modelValue:e.selected,"onUpdate:modelValue":i=>e.selected=i,color:e.targetName&&"accent",indeterminate:e.type==="folder"&&e.indeterminate,onChange:i=>e.type==="file"?W(e):z(e)},null,8,["modelValue","onUpdate:modelValue","color","indeterminate","onChange"])]),"item.name":n(({item:e})=>[c("span",{class:O(["fold-toggle",{"cursor-pointer":e.type==="folder"}]),style:oe({"padding-left":`${e.indent*16}px`}),onClick:i=>e.type==="folder"&&U(e,!e.folded)},[e.type==="folder"?(d(),u(ee,{key:0,location:"top",activator:"parent"},{default:n(()=>[x(v(h(r)(`dialogs.bulkRenameFiles.${e.folded?"unfold":"fold"}`)),1)]),_:2},1024)):A("",!0),e.type==="folder"?(d(),u(m,{key:1},{default:n(()=>[x(v(`mdi-chevron-${e.folded?"down":"up"}`),1)]),_:2},1024)):(d(),u(m,{key:2})),e.fullName===""?(d(),u(m,{key:3,icon:"mdi-file-tree"})):e.type==="file"?(d(),u(m,{key:4,icon:h(ie)(e.name)},null,8,["icon"])):e.folded?(d(),u(m,{key:6,icon:"mdi-folder",color:"#ffe476"})):(d(),u(m,{key:5,icon:"mdi-folder-open",color:"#ffe476"})),x(" "+v(e.name),1)],14,ja)]),"item.targetName":n(({item:e})=>[e.type==="file"?(d(),K("span",{key:0,class:O(["target-name",{duplicated:e.duplicated,"not-changed":e.notChanged}])},[e.duplicated||e.notChanged?(d(),u(ee,{key:0,activator:"parent"},{default:n(()=>[x(v(h(r)(`dialogs.bulkRenameFiles.${e.duplicated?"duplicated":"not_changed"}`)),1)]),_:2},1024)):(d(),K("span",qa,v(e.targetName),1))],2)):(d(),K("span",za,[s(m,{icon:"mdi-cancel",color:"grey-lighten-1"}),s(ee,{activator:"parent"},{default:n(()=>[x(v(h(r)("dialogs.bulkRenameFiles.notForFolder")),1)]),_:1})]))]),_:2},1032,["item"])):A("",!0)]),_:1},8,["headers","items"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});export{dl as default};
