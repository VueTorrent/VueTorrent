import{b as pe,s as Y,e as V,t as Ze,k as ge,I as Pe,n as i,y as Z,F as ce,v as $,J as et,q as tt,R as Ue,f as Oe,a7 as Ce,a8 as Re,K,L as F,O as T,P as le,a2 as lt,u,V as ae,U as q,a1 as at,Y as re,_ as nt,W as ee}from"./vue-BlUxyxf-.js";import{v as ut}from"./index-_IlcebMU.js";import{aX as st,ac as it,aY as ot,aZ as rt,aL as ct,a_ as vt,a$ as dt,s as Ke,x as ke,aA as ft,Q as qe,H as O,aC as mt,K as _e,b0 as pt,b1 as gt,J as yt,b2 as bt,aH as Be,W as ht,f as Ct,b3 as kt,aN as Vt,b4 as Dt,n as Me,b5 as ze,aQ as St,b6 as te,b7 as L,b8 as xt,aT as he,o as It,C as Tt,aj as Ft,b9 as Et,ba as Nt,ak as f,bb as ye}from"./index-Cs9ZfM61.js";import{g as wt,p as Lt,h as $t,j as Ae,w as At,r as Rt,u as Ut,s as Ot,t as _t,q as Mt,v as Ge,x as Pt,y as We}from"./vuetify-Cnll-KcT.js";function be(e,r){let a=0;for(;a<e.length;)e[a]===r?e.splice(a,1):++a;return e}const Kt=Lt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Vt({filterKeys:["title"]}),...kt(),...Mt(Dt({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),je=wt()({name:"VAutocomplete",props:Kt(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,r){let{slots:a}=r;const{t:A}=$t(),m=pe(),p=Y(!1),d=Y(!0),x=Y(!1),_=pe(),I=pe(),l=Y(-1),D=Y(null),{items:C,transformIn:R,transformOut:B}=st(e),{textColorClasses:z,textColorStyles:j}=it(()=>m.value?.color),{InputIcon:ve}=ot(e),g=Ae(e,"search",""),s=Ae(e,"modelValue",[],t=>R(t===null?[null]:At(t)),t=>{const c=B(t);return e.multiple?c:c[0]??null}),Ve=V(()=>typeof e.counterValue=="function"?e.counterValue(s.value):typeof e.counterValue=="number"?e.counterValue:s.value.length),P=rt(e),{filteredItems:ne,getMatches:De}=ct(e,C,()=>D.value??(d.value?"":g.value)),U=V(()=>e.hideSelected&&D.value===null?ne.value.filter(t=>!s.value.some(c=>c.value===t.value)):ne.value),de=Ze(()=>e.closableChips&&!P.isReadonly.value&&!P.isDisabled.value),X=V(()=>!!(e.chips||a.chip)),G=V(()=>X.value||!!a.selection),fe=V(()=>s.value.map(t=>t.props.value)),W=V(()=>U.value.find(t=>t.type==="item"&&!t.props.disabled)),ue=V(()=>(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&g.value===W.value?.title)&&U.value.length>0&&!d.value&&!x.value),H=V(()=>e.hideNoData&&!U.value.length||P.isReadonly.value||P.isDisabled.value),Q=Ae(e,"menu"),y=V({get:()=>Q.value,set:t=>{Q.value&&!t&&_.value?.Î¨openChildren.size||t&&H.value||(Q.value=t)}}),{menuId:Se,ariaExpanded:xe,ariaControls:Ie}=vt(e,y),se=pe(),Te=dt(se,m);function Fe(t){e.openOnClear&&(y.value=!0),g.value=""}function Ee(){H.value||(y.value=!0)}function Ne(t){H.value||(p.value&&(t.preventDefault(),t.stopPropagation()),y.value=!y.value)}function we(t){(Ge(t)||t.key==="Backspace")&&m.value?.focus()}function Le(t){if(P.isReadonly.value)return;const c=m.value?.selectionStart,k=s.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(t.key)&&t.preventDefault(),["Enter","ArrowDown"].includes(t.key)&&(y.value=!0),["Escape"].includes(t.key)&&(y.value=!1),ue.value&&["Enter","Tab"].includes(t.key)&&W.value&&!s.value.some(v=>{let{value:S}=v;return S===W.value.value})&&J(W.value),t.key==="ArrowDown"&&ue.value&&se.value?.focus("next"),["Backspace","Delete"].includes(t.key)){if(!e.multiple&&G.value&&s.value.length>0&&!g.value)return J(s.value[0],!1);if(~l.value){t.preventDefault();const v=l.value;J(s.value[l.value],!1),l.value=v>=k-1?k-2:v}else t.key==="Backspace"&&!g.value&&(l.value=k-1);return}if(e.multiple)if(t.key==="ArrowLeft"){if(l.value<0&&c&&c>0)return;const v=l.value>-1?l.value-1:k-1;if(s.value[v])l.value=v;else{const S=g.value?.length??null;l.value=-1,m.value?.setSelectionRange(S,S)}}else if(t.key==="ArrowRight"){if(l.value<0)return;const v=l.value+1;s.value[v]?l.value=v:(l.value=-1,m.value?.setSelectionRange(0,0))}else~l.value&&Ge(t)&&(l.value=-1)}function n(t){if(We(m.value,":autofill")||We(m.value,":-webkit-autofill")){const c=C.value.find(k=>k.title===t.target.value);c&&J(c)}}function b(){e.eager&&I.value?.calculateVisibleItems()}function w(){p.value&&(d.value=!0,m.value?.focus()),D.value=null}function E(t){p.value=!0,setTimeout(()=>{x.value=!0})}function Xe(t){x.value=!1}function Qe(t){(t==null||t===""&&!e.multiple&&!G.value)&&(s.value=[])}const $e=Y(!1);function J(t){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!t||t.props.disabled))if(e.multiple){const k=s.value.findIndex(S=>(e.valueComparator||Pt)(S.value,t.value)),v=c??!~k;if(~k){const S=v?[...s.value,t]:[...s.value];S.splice(k,1),s.value=S}else v&&(s.value=[...s.value,t]);e.clearOnSelect&&(g.value="")}else{const k=c!==!1;s.value=k?[t]:[],D.value=d.value?"":g.value??"",g.value=k&&!G.value?t.title:"",Pe(()=>{y.value=!1,d.value=!0})}}return ge(p,(t,c)=>{t!==c&&(t?($e.value=!0,g.value=e.multiple||G.value?"":String(s.value.at(-1)?.props.title??""),d.value=!0,Pe(()=>$e.value=!1)):(!e.multiple&&g.value==null&&(s.value=[]),y.value=!1,!d.value&&g.value&&(D.value=g.value),g.value="",l.value=-1))}),ge(g,t=>{!p.value||$e.value||(t&&(y.value=!0),d.value=!t)}),ge(y,t=>{if(!e.hideSelected&&t&&s.value.length&&d.value){const c=U.value.findIndex(k=>s.value.some(v=>k.value===v.value));Rt&&window.requestAnimationFrame(()=>{c>=0&&I.value?.scrollToIndex(c)})}t&&(D.value=null)}),ge(C,(t,c)=>{y.value||p.value&&!c.length&&t.length&&(y.value=!0)}),Ut(()=>{const t=!!(!e.hideNoData||U.value.length||a["prepend-item"]||a["append-item"]||a["no-data"]),c=s.value.length>0,k=Ke.filterProps(e);return i(Ke,$({ref:m},k,{modelValue:g.value,"onUpdate:modelValue":[v=>g.value=v,Qe],focused:p.value,"onUpdate:focused":v=>p.value=v,validationValue:s.externalValue,counterValue:Ve.value,dirty:c,onChange:n,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":y.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!G.value,"v-autocomplete--selecting-index":l.value>-1},e.class],style:e.style,readonly:P.isReadonly.value,placeholder:c?void 0:e.placeholder,"onClick:clear":Fe,"onMousedown:control":Ee,onKeydown:Le,"aria-expanded":xe.value,"aria-controls":Ie.value}),{...a,default:v=>{let{id:S}=v;return Z(ce,null,[i(ft,$({id:Se.value,ref:_,modelValue:y.value,"onUpdate:modelValue":h=>y.value=h,activator:"parent",contentClass:"v-autocomplete__content",disabled:H.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:b,onAfterLeave:w},e.menuProps),{default:()=>[t&&i(qe,$({ref:se,filterable:!0,selected:fe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:h=>h.preventDefault(),onKeydown:we,onFocusin:E,onFocusout:Xe,tabindex:"-1",selectable:!0,"aria-live":"polite","aria-labelledby":`${S.value}-label`,"aria-multiselectable":e.multiple,color:e.itemColor??e.color},Te,e.listProps),{default:()=>[a["prepend-item"]?.(),!U.value.length&&!e.hideNoData&&(a["no-data"]?.()??i(O,{key:"no-data",title:A(e.noDataText)},null)),i(mt,{ref:I,renderless:!0,items:U.value,itemKey:"value"},{default:h=>{let{item:o,index:M,itemRef:me}=h;const ie=$(o.props,{ref:me,key:o.value,active:ue.value&&o===W.value?!0:void 0,onClick:()=>J(o,null),"aria-posinset":M+1,"aria-setsize":U.value.length});return o.type==="divider"?a.divider?.({props:o.raw,index:M})??i(_e,$(o.props,{key:`divider-${M}`}),null):o.type==="subheader"?a.subheader?.({props:o.raw,index:M})??i(pt,$(o.props,{key:`subheader-${M}`}),null):a.item?.({item:o,index:M,props:ie})??i(O,$(ie,{role:"option"}),{prepend:oe=>{let{isSelected:N}=oe;return Z(ce,null,[e.multiple&&!e.hideSelected?i(yt,{key:o.value,modelValue:N,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Ye=>Ye.preventDefault()},null):void 0,o.props.prependAvatar&&i(bt,{image:o.props.prependAvatar},null),o.props.prependIcon&&i(ke,{icon:o.props.prependIcon},null)])},title:()=>d.value?o.title:gt("v-autocomplete",o.title,De(o)?.title)})}}),a["append-item"]?.()]})]}),s.value.map((h,o)=>{function M(N){N.stopPropagation(),N.preventDefault(),J(h,!1)}const me=$(Be.filterProps(h.props),{"onClick:close":M,onKeydown(N){N.key!=="Enter"&&N.key!==" "||(N.preventDefault(),N.stopPropagation(),M(N))},onMousedown(N){N.preventDefault(),N.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),ie=X.value?!!a.chip:!!a.selection,oe=ie?_t(X.value?a.chip({item:h,index:o,props:me}):a.selection({item:h,index:o})):void 0;if(!(ie&&!oe))return Z("div",{key:h.value,class:tt(["v-autocomplete__selection",o===l.value&&["v-autocomplete__selection--selected",z.value]]),style:et(o===l.value?j.value:{})},[X.value?a.chip?i(ht,{key:"chip-defaults",defaults:{VChip:{closable:de.value,size:"small",text:h.title}}},{default:()=>[oe]}):i(Be,$({key:"chip",closable:de.value,size:"small",text:h.title,disabled:h.props.disabled},me),null):oe??Z("span",{class:"v-autocomplete__selection-text"},[h.title,e.multiple&&o<s.value.length-1&&Z("span",{class:"v-autocomplete__selection-comma"},[Ue(",")])])])})])},"append-inner":function(){for(var v=arguments.length,S=new Array(v),h=0;h<v;h++)S[h]=arguments[h];return Z(ce,null,[a["append-inner"]?.(...S),e.menuIcon?i(ke,{class:"v-autocomplete__menu-icon",color:m.value?.fieldIconColor,icon:e.menuIcon,onMousedown:Ne,onClick:Ot,"aria-hidden":!0,tabindex:"-1"},null):void 0,e.appendInnerIcon&&i(ve,{key:"append-icon",name:"appendInner",color:S[0].iconColor.value},null)])}})}),Ct({isFocused:p,isPristine:d,menu:y,search:g,filteredItems:ne,select:J},m)}}),Bt={key:0,class:"text-accent"},Gt={key:1,class:"text-accent"},He=Oe({__name:"FilterSelectMulti",props:Ce({title:{},items:{},filterType:{}},{include:{required:!0},includeModifiers:{},exclude:{required:!0},excludeModifiers:{}}),emits:Ce(["disable","toggleFilterType"],["update:include","update:exclude"]),setup(e){const r=Re(e,"include"),a=Re(e,"exclude"),{t:A}=Me(),m=V(()=>r.value.length+a.value.length);function p(l){return r.value.includes(l)?L.INCLUDED:a.value.includes(l)?L.EXCLUDED:L.DISABLED}function d(l){switch(p(l)){case L.INCLUDED:return"mdi-plus-box";case L.EXCLUDED:return"mdi-minus-box";case L.DISABLED:default:return"mdi-checkbox-blank-outline"}}function x(l){switch(p(l)){case L.INCLUDED:return"text-green";case L.EXCLUDED:return"text-red";default:return}}function _(l){switch(p(l)){case L.INCLUDED:be(r.value,l),a.value.push(l);break;case L.EXCLUDED:be(a.value,l);break;case L.DISABLED:default:r.value.push(l)}}function I(l){be(r.value,l),be(a.value,l)}return(l,D)=>(F(),K(O,{class:"px-0 pb-3"},{default:T(()=>[i(ze,{class:"px-0 text-uppercase ml-1 font-weight-light text-subtitle-2"},{default:T(()=>[Ue(le(e.title),1)]),_:1}),i(je,{"model-value":[...r.value,...a.value],items:e.items,placeholder:u(A)("navbar.side.filters.disabled"),"bg-color":"secondary",class:"text-accent pt-1",density:"compact","hide-details":"",multiple:"",variant:"solo"},{prepend:T(()=>[i(St,{location:"right",text:u(A)(e.filterType===u(te).CONJUNCTIVE?"constants.filter_type.conjunctive":"constants.filter_type.disjunctive")},{activator:T(({props:C})=>[i(ke,$(C,{icon:e.filterType===u(te).CONJUNCTIVE?"mdi-set-center":"mdi-set-all",onClick:D[0]||(D[0]=R=>l.$emit("toggleFilterType"))}),null,16,["icon"])]),_:1},8,["text"])]),"prepend-item":T(()=>[i(O,{title:u(A)("common.disable"),onClick:D[1]||(D[1]=C=>l.$emit("disable"))},null,8,["title"]),i(_e)]),selection:T(({item:C,index:R})=>[R===0&&m.value===1?(F(),ae("span",Bt,le(C.title),1)):R===0?(F(),ae("span",Gt,le(u(A)("navbar.side.filters.activeFilter",m.value)),1)):q("",!0)]),item:T(({item:C,props:R})=>[lt((F(),K(O,$(R,{"data-custom-context-menu":"",class:x(C.value),onClick:B=>_(C.value),onContextmenu:B=>I(C.value)}),{prepend:T(()=>[i(ke,{icon:d(C.value)},null,8,["icon"])]),_:2},1040,["class","onClick","onContextmenu"])),[[u(ut),()=>I(C.value)]])]),_:1},8,["model-value","items","placeholder"])]),_:1}))}}),Wt={key:0,class:"text-accent"},Ht={key:1,class:"text-accent"},Je=Oe({__name:"FilterSelectSingle",props:Ce({title:{},items:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:Ce(["disable"],["update:modelValue"]),setup(e){const r=e,a=Re(e,"modelValue"),A=xt(()=>r.items,(p,d)=>he.text.asc(p.title,d.title)),{t:m}=Me();return(p,d)=>(F(),K(O,{class:"px-0 pb-3"},{default:T(()=>[i(ze,{class:"px-0 text-uppercase ml-1 font-weight-light text-subtitle-2"},{default:T(()=>[Ue(le(e.title),1)]),_:1}),i(je,{modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=x=>a.value=x),items:u(A),placeholder:u(m)("navbar.side.filters.disabled"),"bg-color":"secondary",class:"text-accent pt-1",density:"compact","hide-details":"",multiple:"",variant:"solo"},{"prepend-item":T(()=>[i(O,{title:u(m)("common.disable"),onClick:d[0]||(d[0]=x=>p.$emit("disable"))},null,8,["title"]),at(p.$slots,"prepend-item"),i(_e)]),selection:T(({item:x,index:_})=>[_===0&&a.value.length===1?(F(),ae("span",Wt,le(x.title),1)):_===0?(F(),ae("span",Ht,le(u(m)("navbar.side.filters.activeFilter",a.value.length)),1)):q("",!0)]),_:3},8,["modelValue","items","placeholder"])]),_:3}))}}),Xt=Oe({__name:"Filters",setup(e){const{t:r,getTorrentStateString:a}=Me(),{categories:A,torrentsByCategory:m}=re(It()),{tags:p,torrentsByTag:d}=re(Tt()),{torrents:x,torrentsByStatus:_,statusFilter:I,categoryFilter:l,tagFilterInclude:D,tagFilterExclude:C,tagFilterType:R,torrentsByTracker:B,trackerFilterInclude:z,trackerFilterExclude:j,trackerFilterType:ve}=re(Ft()),{hostnameTrackers:g}=re(Et()),{filters:s,showFilterState:Ve,showFilterCategory:P,showFilterTag:ne,showFilterTracker:De}=re(Nt()),U=V(()=>Object.values(f).filter(n=>typeof n=="number").map(n=>({title:`${a(n)} (${_.value[n]??0})`,value:n})).sort((n,b)=>he.text.asc(n.title,b.title))),de=V(()=>[{title:`${r("navbar.side.filters.category.empty")} (${m.value[""]??0})`,value:""},...A.value.map(n=>({title:`${n.name} (${m.value[n.name]??0})`,value:n.name}))]),X=V(()=>[{title:`${r("navbar.side.filters.tag.empty")} (${d.value[""]??0})`,value:null},...p.value.map(n=>({title:`${n} (${d.value[n]??0})`,value:n})).sort((n,b)=>he.text.asc(n.value,b.value))]),G=V(()=>[{title:`${r("navbar.side.filters.tracker.empty")} (${B.value[ye.UNTRACKED]??0})`,value:ye.UNTRACKED},{title:`${r("navbar.side.filters.tracker.not_working")} (${B.value[ye.NOT_WORKING]??0})`,value:ye.NOT_WORKING},...g.value.map(n=>({title:`${n} (${B.value[n]??0})`,value:n})).sort((n,b)=>he.text.asc(n.title,b.title))]);function fe(n){switch(n.value){case te.CONJUNCTIVE:n.value=te.DISJUNCTIVE;break;case te.DISJUNCTIVE:n.value=te.CONJUNCTIVE;break}}function W(){fe(R)}function ue(){fe(ve)}const H=[f.UPLOADING,f.CHECKING_DISK,f.UL_FORCED,f.DOWNLOADING,f.META_DOWNLOAD,f.FORCED_META_DOWNLOAD,f.CHECKING_DISK,f.DL_FORCED,f.CHECKING_RESUME_DATA,f.MOVING],Q=[f.ERROR,f.MISSING_FILES,f.UNKNOWN],y=[f.ERROR,f.MISSING_FILES,f.UNKNOWN,f.MOVING,f.DL_STOPPED,f.DL_STALLED,f.UL_STOPPED,f.CHECKING_DISK,f.CHECKING_RESUME_DATA];function Se(){I.value=[]}const xe=V(()=>x.value.filter(n=>H.includes(n.state)).length);function Ie(){I.value=H}const se=V(()=>x.value.filter(n=>Q.includes(n.state)).length);function Te(){I.value=Q}const Fe=V(()=>x.value.filter(n=>y.includes(n.state)).length);function Ee(){I.value=y}function Ne(){l.value=[]}function we(){D.value=[],C.value=[]}function Le(){z.value=[],j.value=[]}return(n,b)=>u(Ve)||u(P)||u(ne)||u(De)?(F(),K(qe,{key:0,class:"pb-0 inherit-fg"},{default:T(()=>[(F(!0),ae(ce,null,nt(u(s),w=>(F(),ae(ce,{key:w.name},[w.name==="state"&&w.active?(F(),K(Je,{key:0,modelValue:u(I),"onUpdate:modelValue":b[0]||(b[0]=E=>ee(I)?I.value=E:null),title:u(r)("navbar.side.filters.state.title"),items:U.value,onDisable:Se},{"prepend-item":T(()=>[i(O,{title:`${u(r)("navbar.side.filters.state.active")} (${xe.value})`,onClick:Ie},null,8,["title"]),i(O,{title:`${u(r)("navbar.side.filters.state.error")} (${se.value})`,onClick:Te},null,8,["title"]),i(O,{title:`${u(r)("navbar.side.filters.state.offline")} (${Fe.value})`,onClick:Ee},null,8,["title"])]),_:1},8,["modelValue","title","items"])):q("",!0),w.name==="category"&&w.active?(F(),K(Je,{key:1,modelValue:u(l),"onUpdate:modelValue":b[1]||(b[1]=E=>ee(l)?l.value=E:null),title:u(r)("navbar.side.filters.category.title"),items:de.value,onDisable:Ne},null,8,["modelValue","title","items"])):q("",!0),w.name==="tag"&&w.active?(F(),K(He,{key:2,include:u(D),"onUpdate:include":b[2]||(b[2]=E=>ee(D)?D.value=E:null),exclude:u(C),"onUpdate:exclude":b[3]||(b[3]=E=>ee(C)?C.value=E:null),title:u(r)("navbar.side.filters.tag.title"),items:X.value,"filter-type":u(R),onDisable:we,onToggleFilterType:W},null,8,["include","exclude","title","items","filter-type"])):q("",!0),w.name==="tracker"&&w.active?(F(),K(He,{key:3,include:u(z),"onUpdate:include":b[4]||(b[4]=E=>ee(z)?z.value=E:null),exclude:u(j),"onUpdate:exclude":b[5]||(b[5]=E=>ee(j)?j.value=E:null),title:u(r)("navbar.side.filters.tracker.title"),items:G.value,"filter-type":u(ve),onDisable:Le,onToggleFilterType:ue},null,8,["include","exclude","title","items","filter-type"])):q("",!0)],64))),128))]),_:1})):q("",!0)}});export{Xt as default};
