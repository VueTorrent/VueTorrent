import{B as Se,t as w,e as J,n as s,x as m,v as M,s as te,f as Ee,A as $e,k as Be,b as k,H as Pe,K as i,L as r,O as n,R as b,P as g,u as y,q,r as Ue,U as P,V as U,J as oe,F as se,_ as He,W as Ge,a0 as Z}from"./vue-l9nRghEe.js";import{aE as Le,aF as Ae,aG as Ke,aH as je,aI as Oe,j as ze,h as Me,V as qe,k as Je,ag as We,ah as Xe,s as ne,l as Qe,z as Ye,A as H,ax as re,aj as de,B as Ze,p as f,aJ as ee,aK as ue,C as ie,I as ea,y as aa,D as la,t as ta}from"./index-DrIGO-PP.js";import{u as oa}from"./TorrentDetail-D6KOjloY.js";import{V as sa}from"./VForm-Mgmf40Tb.js";import{V as na}from"./VBadge-8wRCsVcp.js";import{c as ra,a as da,b as ua,u as ia,p as ca,d as fa,e as ma,f as pa,g as ga,h as ya,i as ha,j as ce,k as fe,l as me,m as pe,n as va,o as ka}from"./VDataTable-BzcAu1i5.js";import{g as Va,p as ba,k as Fa,u as Ra,q as ge,e as ae}from"./vuetify-BcsyVDB4.js";import"./ColoredChip.vue_vue_type_script_setup_true_lang-D-LQJCOp.js";import"./index-CZTbTkUd.js";import"./VSheet-Cmmk9uC5.js";import"./VEmptyState-J0PdLjay.js";import"./VTabs-DB26jBtT.js";import"./VPagination-Bx5zZ2Ks.js";const wa=ba({...ge(ka(),["hideDefaultFooter"]),...va(),...Oe(),...je()},"VDataTableVirtual"),xa=Va()({name:"VDataTableVirtual",props:wa(),emits:{"update:modelValue":o=>!0,"update:sortBy":o=>!0,"update:options":o=>!0,"update:groupBy":o=>!0,"update:expanded":o=>!0},setup(o,F){let{attrs:x,slots:u}=F;const{groupBy:R}=ra(o),{initialSortOrder:G,sortBy:h,multiSort:C,mustSort:N}=da(o),{disableSort:L}=Se(o),{columns:v,headers:T,filterFunctions:A,sortFunctions:D,sortRawFunctions:K}=ua(o,{groupBy:R,showSelect:w(()=>o.showSelect),showExpand:w(()=>o.showExpand)}),{items:W}=ia(o,v),c=w(()=>o.search),{filteredItems:S}=Le(o,W,c,{transform:p=>p.columns,customKeyFilter:A}),{toggleSort:j}=ca({initialSortOrder:G,sortBy:h,multiSort:C,mustSort:N}),{sortByWithGroups:E,opened:$,extractRows:O,isGroupOpen:z,toggleGroup:B}=fa({groupBy:R,sortBy:h,disableSort:L}),{sortedItems:X}=ma(o,S,E,{transform:p=>({...p.raw,...p.columns}),sortFunctions:D,sortRawFunctions:K}),{flatItems:_}=ya(X,R,$,()=>!!u["group-summary"]),l=J(()=>O(_.value)),{isSelected:t,select:a,selectAll:e,toggleSelect:d,someSelected:Q,allSelected:ye}=pa(o,{allItems:l,currentPage:l}),{isExpanded:he,toggleExpand:ve}=ga(o),{containerRef:ke,markerRef:Ve,paddingTop:be,paddingBottom:Fe,computedItems:Re,handleItemResize:we,handleScroll:xe,handleScrollend:Ne,calculateVisibleItems:Te,scrollToIndex:_e}=Ae(o,_),Ie=J(()=>Re.value.map(p=>({...p.raw,virtualIndex:p.index})));ha({sortBy:h,page:te(1),itemsPerPage:te(-1),groupBy:R,search:c}),Fa({VDataTableRows:{hideNoData:w(()=>o.hideNoData),noDataText:w(()=>o.noDataText),loading:w(()=>o.loading),loadingText:w(()=>o.loadingText)}});const V=J(()=>({sortBy:h.value,toggleSort:j,someSelected:Q.value,allSelected:ye.value,isSelected:t,select:a,selectAll:e,toggleSelect:d,isExpanded:he,toggleExpand:ve,isGroupOpen:z,toggleGroup:B,items:l.value.map(p=>p.raw),internalItems:l.value,groupedItems:_.value,columns:v.value,headers:T.value}));return Ra(()=>{const p=ce.filterProps(ge(o,["multiSort"])),Ce=fe.filterProps(o),De=me.filterProps(o);return s(me,M({class:["v-data-table",{"v-data-table--loading":o.loading},o.class],style:o.style},De,{fixedHeader:o.fixedHeader||o.sticky}),{top:()=>u.top?.(V.value),wrapper:()=>m("div",{ref:ke,onScrollPassive:xe,onScrollend:Ne,class:"v-table__wrapper",style:{height:ae(o.height)}},[m("table",null,[u.colgroup?.(V.value),!o.hideDefaultHeader&&m("thead",{key:"thead"},[s(ce,M(p,{multiSort:!!o.multiSort}),u)]),u.thead?.(V.value),!o.hideDefaultBody&&m("tbody",{key:"tbody"},[m("tr",{ref:Ve,style:{height:ae(be.value),border:0}},[m("td",{colspan:v.value.length,style:{height:0,border:0}},null)]),u["body.prepend"]?.(V.value),s(fe,M(x,Ce,{items:Ie.value}),{...u,item:I=>s(Ke,{key:I.internalItem.index,renderless:!0,"onUpdate:height":Y=>we(I.internalItem.index,Y)},{default:Y=>{let{itemRef:le}=Y;return u.item?.({...I,itemRef:le})??s(pe,M(I.props,{ref:le,key:I.internalItem.index,index:I.index}),u)}})}),u["body.append"]?.(V.value),m("tr",{style:{height:ae(Fe.value),border:0}},[m("td",{colspan:v.value.length,style:{height:0,border:0}},null)])]),u.tbody?.(V.value),u.tfoot?.(V.value)])]),bottom:()=>u.bottom?.(V.value)})}),{calculateVisibleItems:Te,scrollToIndex:_e}}}),Na=["onClick"],Ta={key:1},_a={key:1},Ia={class:"d-flex flex-column pl-3"},ja=Ee({__name:"BulkRenameFilesDialog",props:{guid:{},node:{},hash:{}},setup(o){const F=o,{isOpened:x}=ze(F.guid),{t:u}=Me(),R=oa(),G=k(),h=k(!1),C=k(!1),N=k(""),L=k(),v=k([]),T=k(""),A=k(),D=k(!1),K=[l=>!!l],W=$e([{fixed:!0,sortable:!1,key:"selected",width:"50px"},{title:u("dialogs.bulkRenameFiles.col_origin_name"),sortable:!1,key:"name"},{title:u("dialogs.bulkRenameFiles.col_result_name"),sortable:!1,key:"targetName"}]),c=Ue([]),S=J(()=>c.filter(l=>l.type==="file"&&l.selected&&l.targetName&&l.name!==l.targetName));function j(l,t,a=0){const e={indent:a,name:l.name,fullName:l.fullName,parentItem:t,show:!0,folded:!1,selected:!1,type:l.type,node:l};if(c.push(e),l.type==="folder")for(const d of l.children)j(d,e,a+1)}function E(l,t){l.folded=t,l.node.children.forEach(a=>{const e=c.find(d=>d.node.id===a.id);e.show=!t,e.type==="folder"&&t&&E(e,t)})}function $(l){const t=c.find(a=>a.node.id===l.id);if(l.type==="folder"){let a=0,e=0;return l.children.forEach(d=>{switch($(d)){case 1:a++;break;case 0:e++;break}}),a===0&&e===0?(t.selected=!1,t.indeterminate=!1,-1):a===l.children.length?(t.selected=!0,t.indeterminate=!1,1):(t.indeterminate=!0,0)}else return t.indeterminate=!1,t.selected?1:-1}function O(l){function t(a){a.node.children.forEach(e=>{const d=c.find(Q=>Q.node.id===e.id);d&&(d.selected=a.selected,d.selected&&(d.show=!0,d.folded=!1),d.type==="folder"&&t(d))}),a.selected&&(a.show=!0,a.folded=!1)}t(l),$(F.node),B()}function z(l){$(F.node),B([l])}async function B(l){if(await G.value?.validate(),!h.value)return;let t;try{t=new RegExp(N.value,v.value.join(""))}catch{return}(l??c).forEach(e=>{e.type==="file"&&(e.selected&&t.test(e.name)?(e.targetName=e.name.replace(t,T.value),e.targetFullName=(e.parentItem.fullName===""?"":e.parentItem.fullName+"/")+e.targetName):(e.targetName=void 0,e.targetFullName=void 0),e.notChanged=e.name===e.targetName)}),C.value=!1;const a=new Map;c.filter(e=>!!e.targetFullName).forEach(e=>{a.set(e.targetFullName,(a.get(e.targetFullName)||0)+1)}),c.forEach(e=>{e.duplicated=a.get(e.targetFullName)>1,e.duplicated&&(C.value=!0)})}function X(){if(!S.value.length)return Z.warn(u("dialogs.bulkRenameFiles.nothing_to_do"));const l=[];for(const t of S.value)l.push(R.renameTorrentFile(F.hash,t.fullName,t.targetFullName));D.value=!0,Promise.all(l).then(()=>{Z.success(u("dialogs.bulkRenameFiles.success")),L.value?.saveValueToHistory(),A.value?.saveValueToHistory()}).catch(t=>{Z.error(t.toString())}).finally(()=>{D.value=!1,R.updateFileTreeTask.perform(),_()})}function _(){x.value=!1}return Be([N,v,T],()=>{B()}),Pe(()=>{j(F.node)}),(l,t)=>(r(),i(ta,{modelValue:y(x),"onUpdate:modelValue":t[6]||(t[6]=a=>Ge(x)?x.value=a:null),persistent:"",fullscreen:""},{default:n(()=>[s(qe,{density:"compact"},{default:n(()=>[s(Je,null,{default:n(()=>[s(We,{density:"compact",color:"transparent"},{default:n(()=>[s(Xe,null,{default:n(()=>[b(g(l.$t("dialogs.bulkRenameFiles.title")),1)]),_:1}),s(ne,{icon:"mdi-close",onClick:t[0]||(t[0]=a=>_())})]),_:1})]),_:1}),s(Qe,{class:"d-flex flex-column"},{default:n(()=>[s(y(sa),{ref_key:"form",ref:G,modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=a=>h.value=a)},{default:n(()=>[s(Ye,{"no-gutters":"",align:"center",justify:"center"},{default:n(()=>[s(H,{cols:l.$vuetify.display.mobile?9:void 0},{default:n(()=>[s(re,{ref_key:"regexpEl",ref:L,modelValue:N.value,"onUpdate:modelValue":t[1]||(t[1]=a=>N.value=a),"history-key":y(de).BULK_RENAME_REGEXP,"hide-details":"",density:"compact",rules:K,label:l.$t("dialogs.bulkRenameFiles.regexp")},null,8,["modelValue","history-key","label"])]),_:1},8,["cols"]),s(H,{cols:l.$vuetify.display.mobile?3:"auto"},{default:n(()=>[s(Ze,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=a=>v.value=a),class:"ml-2",items:["d","g","i","m","s","u","v","y"],placeholder:y(u)("dialogs.bulkRenameFiles.select_regex_flags"),label:l.$t("dialogs.bulkRenameFiles.flags"),density:"compact",multiple:"","hide-details":""},null,8,["modelValue","placeholder","label"])]),_:1},8,["cols"]),s(H,{cols:"auto"},{default:n(()=>[s(f,{class:"mx-2",icon:`mdi-arrow-${l.$vuetify.display.mobile?"down":"right"}`},null,8,["icon"])]),_:1}),s(H,{cols:l.$vuetify.display.mobile?12:void 0},{default:n(()=>[s(re,{ref_key:"targetEl",ref:A,modelValue:T.value,"onUpdate:modelValue":t[3]||(t[3]=a=>T.value=a),"history-key":y(de).BULK_RENAME_TARGET,"hide-details":"",density:"compact",rules:K,label:l.$t("dialogs.bulkRenameFiles.target")},null,8,["modelValue","history-key","label"])]),_:1},8,["cols"]),s(H,{cols:"auto"},{default:n(()=>[s(na,{class:q(l.$vuetify.display.mobile?"mt-2":"ml-5"),color:"success",location:"top left",content:S.value.length},{default:n(()=>[s(ne,{loading:D.value,disabled:!h.value||C.value,color:"primary",onClick:t[4]||(t[4]=a=>X())},{default:n(()=>[b(g(l.$t("dialogs.bulkRenameFiles.run")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["class","content"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l.$vuetify.display.mobile?(r(),i(ea,{key:1},{default:n(()=>[(r(!0),U(se,null,He(c,(a,e)=>(r(),U(se,null,[a.show?(r(),i(aa,{key:e},{default:n(()=>[e>0?(r(),i(la,{key:0,class:"my-2"})):P("",!0),m("div",{class:"d-flex align-center",style:oe({"padding-left":`${a.indent*16}px`})},[s(ie,{modelValue:a.selected,"onUpdate:modelValue":d=>a.selected=d,inline:"",color:a.targetName&&"accent",indeterminate:a.type==="folder"&&a.indeterminate,onChange:d=>a.type==="file"?z(a):O(a)},null,8,["modelValue","onUpdate:modelValue","color","indeterminate","onChange"]),a.type==="folder"?(r(),i(f,{key:0,onClick:d=>a.type==="folder"&&E(a,!a.folded)},{default:n(()=>[b(g(`mdi-chevron-${a.folded?"down":"up"}`),1)]),_:2},1032,["onClick"])):P("",!0),a.fullName===""?(r(),i(f,{key:1,icon:"mdi-file-tree"})):a.type==="file"?(r(),i(f,{key:2,icon:y(ue)(a.name)},null,8,["icon"])):a.folded?(r(),i(f,{key:4,icon:"mdi-folder",color:"#ffe476"})):(r(),i(f,{key:3,icon:"mdi-folder-open",color:"#ffe476"})),m("div",Ia,[m("span",{class:q({"text-grey strikethrough":a.targetName})},g(a.name),3),m("span",null,g(a.targetName),1)])],4)]),_:2},1024)):P("",!0)],64))),256))]),_:1})):(r(),i(xa,{key:0,headers:y(W),items:c,density:"compact","fixed-header":""},{item:n(({internalItem:a})=>[a.raw.show?(r(),i(pe,{key:0,item:a},{"item.selected":n(({item:e})=>[s(ie,{modelValue:e.selected,"onUpdate:modelValue":d=>e.selected=d,color:e.targetName&&"accent",indeterminate:e.type==="folder"&&e.indeterminate,onChange:d=>e.type==="file"?z(e):O(e)},null,8,["modelValue","onUpdate:modelValue","color","indeterminate","onChange"])]),"item.name":n(({item:e})=>[m("span",{class:q(["fold-toggle",{"cursor-pointer":e.type==="folder"}]),style:oe({"padding-left":`${e.indent*16}px`}),onClick:d=>e.type==="folder"&&E(e,!e.folded)},[e.type==="folder"?(r(),i(ee,{key:0,location:"top",activator:"parent"},{default:n(()=>[b(g(y(u)(`dialogs.bulkRenameFiles.${e.folded?"unfold":"fold"}`)),1)]),_:2},1024)):P("",!0),e.type==="folder"?(r(),i(f,{key:1},{default:n(()=>[b(g(`mdi-chevron-${e.folded?"down":"up"}`),1)]),_:2},1024)):(r(),i(f,{key:2})),e.fullName===""?(r(),i(f,{key:3,icon:"mdi-file-tree"})):e.type==="file"?(r(),i(f,{key:4,icon:y(ue)(e.name)},null,8,["icon"])):e.folded?(r(),i(f,{key:6,icon:"mdi-folder",color:"#ffe476"})):(r(),i(f,{key:5,icon:"mdi-folder-open",color:"#ffe476"})),b(" "+g(e.name),1)],14,Na)]),"item.targetName":n(({item:e})=>[e.type==="file"?(r(),U("span",{key:0,class:q(["target-name",{duplicated:e.duplicated,"not-changed":e.notChanged}])},[e.duplicated||e.notChanged?(r(),i(ee,{key:0,activator:"parent"},{default:n(()=>[b(g(y(u)(`dialogs.bulkRenameFiles.${e.duplicated?"duplicated":"not_changed"}`)),1)]),_:2},1024)):(r(),U("span",Ta,g(e.targetName),1))],2)):(r(),U("span",_a,[s(f,{icon:"mdi-cancel",color:"grey-lighten-1"}),s(ee,{activator:"parent"},{default:n(()=>[b(g(y(u)("dialogs.bulkRenameFiles.notForFolder")),1)]),_:1})]))]),_:2},1032,["item"])):P("",!0)]),_:1},8,["headers","items"]))]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});export{ja as default};
