import{X as de,d as w,h as O,c as U,B as E,D as I,G as a,I as _,J as p,M as Q,N as z,m as e,R as x,n as fe,u as s,K as A,O as ge,P as me,Y as G,H as pe,q as he,F as ve,S as ye,L as Se}from"./vue-B4gRozdF.js";import{W as ke,X as P,V as H,k as h,c as Ve,u as le,d as J,e as be,j as q,l as Y,f as W,g as we,a as te,i as X,Y as ne,y as Ee,G as Pe,I as _e,H as Ce,o as Te,p as Ne,s as M,t as Ie,v as N,J as De,Z as $e,$ as xe,w as Z,O as Me,P as Ue,x as ee,z as qe,a0 as Re,a1 as Be}from"./index-CJMqBwbX.js";import{a as Le}from"./vuetify-C069gF9m.js";const ie=de("searchEngine",()=>{const S=w([]),k=w([]);function l(){S.value.push({uniqueId:ke(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function m(t){S.value=S.value.filter(v=>v.uniqueId!==t)}async function o(t){const v=await P.startSearch(t.query,t.filters.category,[t.filters.plugin]);t.id=v.id,t.results=[],t.lastQuery=t.query}async function C(t){const v=await P.getSearchResults(t.id,t.results.length);return t.results.push(...v.results),v.status}async function c(t){t.id&&t.id!==0&&await P.stopSearch(t.id),t.id=0}async function f(){k.value=await P.getSearchPlugins()}async function T(t){await P.installSearchPlugin([t])}async function D(t){await P.uninstallSearchPlugin([t])}async function V(t){await P.enableSearchPlugin([t.name],!t.enabled)}async function $(){await P.updateSearchPlugins()}async function b(t,v){await P.downloadTorrentWithSearchPlugin(t,v)}return{searchData:S,searchPlugins:k,createNewTab:l,deleteTab:m,runNewSearch:o,refreshResults:C,stopSearch:c,fetchSearchPlugins:f,installSearchPlugin:T,uninstallSearchPlugin:D,toggleSearchPlugin:V,updatePlugins:$,downloadTorrent:b,$reset:()=>{S.value=[],k.value=[],l()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),Qe={key:1,"data-testid":"mixedbtn-text"},ae=O({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(S){const k=S,{mobile:l}=Le(),m=U(()=>k.mobileOverride?k.mobileValue:l.value);return(o,C)=>(E(),I(h,{icon:m.value},{default:a(()=>[m.value||o.position==="left"?(E(),I(H,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[_(p(o.icon),1)]),_:1})):Q("",!0),m.value?Q("",!0):(E(),z("span",Qe,p(o.text),1)),!m.value&&o.position==="right"?(E(),I(H,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[_(p(o.icon),1)]),_:1})):Q("",!0)]),_:1},8,["icon"]))}}),ze=["href","title"],Ae=O({__name:"PluginManagerDialog",props:{guid:{}},setup(S){const k=S,{isOpened:l}=Ve(k.guid),{t:m}=le(),o=ie(),C=[{title:m("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:m("dialogs.pluginManager.headers.name"),key:"fullName"},{title:m("dialogs.pluginManager.headers.version"),key:"version"},{title:m("dialogs.pluginManager.headers.url"),key:"url"},{title:m("dialogs.pluginManager.headers.actions"),key:"actions"}],c=w(!1),f=w(!1),T=w(!1),D=w(!1),V=w("");async function $(g){await o.toggleSearchPlugin(g),await o.fetchSearchPlugins()}async function b(){f.value=!0,await o.updatePlugins().then(()=>new Promise(g=>setTimeout(g,2e3))),await o.fetchSearchPlugins(),f.value=!1}async function t(){r(),c.value=!0,await o.installSearchPlugin(V.value),V.value="",setTimeout(()=>{o.fetchSearchPlugins().then(()=>{c.value=!1})},1e3)}async function v(g){c.value=!0,await o.uninstallSearchPlugin(g.name),await o.fetchSearchPlugins(),c.value=!1}const R=()=>{l.value=!1};function r(){T.value=!1}return(g,y)=>(E(),I(Y,{modelValue:s(l),"onUpdate:modelValue":y[4]||(y[4]=u=>ge(l)?l.value=u:null)},{default:a(()=>[e(J,null,{default:a(()=>[e(be,{class:"d-flex"},{default:a(()=>[x("div",null,p(g.$t("dialogs.pluginManager.title")),1),e(q),e(ae,{icon:"mdi-update",text:g.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:f.value,onClick:b},null,8,["text","loading"]),e(Y,{modelValue:T.value,"onUpdate:modelValue":y[3]||(y[3]=u=>T.value=u)},{activator:a(({props:u})=>[e(ae,fe({icon:"mdi-toy-brick-plus",text:g.$t("dialogs.pluginManager.install.activator")},u,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(J,{title:g.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(W,null,{default:a(()=>[e(s(we),{modelValue:D.value,"onUpdate:modelValue":y[1]||(y[1]=u=>D.value=u),onSubmit:y[2]||(y[2]=A(()=>{},["prevent"]))},{default:a(()=>[e(te,{modelValue:V.value,"onUpdate:modelValue":y[0]||(y[0]=u=>V.value=u),autofocus:"",label:g.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(X,null,{default:a(()=>[e(q),e(h,{color:"error",onClick:r},{default:a(()=>[_(p(g.$t("common.cancel")),1)]),_:1}),e(h,{color:"accent",onClick:t},{default:a(()=>[_(p(g.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(W,null,{default:a(()=>[e(ne,{mobile:null,headers:C,"items-per-page":"-1",items:s(o).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:c.value},{"item.enabled":a(({item:u})=>[e(Ee,{"model-value":u.enabled,onClick:B=>$(u)},null,8,["model-value","onClick"])]),"item.url":a(({item:u})=>[x("a",{href:u.url,title:u.name},p(u.url),9,ze)]),"item.actions":a(({item:u})=>[e(H,{color:"red",icon:"mdi-delete",onClick:B=>v(u)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(X,null,{default:a(()=>[e(q),e(h,{color:"accent",onClick:R},{default:a(()=>[_(p(g.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),He={class:"pa-3"},Oe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Fe={class:"d-flex justify-end"},Je=O({__name:"SearchEngine",setup(S){const k=me(),{t:l}=le(),m=Pe(),o=_e(),C=Ce(),c=ie(),{searchData:f}=G(c),{useBinarySize:T,dateFormat:D}=G(Te()),V=w(),$=w(!1),b=w(0),t=U(()=>[{title:l("searchEngine.headers.fileName"),key:"fileName"},{title:l("searchEngine.headers.fileSize"),key:"fileSize"},{title:l("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:l("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...o.version>="5.0.0"?[{title:l("searchEngine.headers.engineName"),key:"engineName"},{title:l("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:l("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),v=[{title:l("searchEngine.filters.category.movies"),value:"movies"},{title:l("searchEngine.filters.category.tv"),value:"tv"},{title:l("searchEngine.filters.category.music"),value:"music"},{title:l("searchEngine.filters.category.games"),value:"games"},{title:l("searchEngine.filters.category.anime"),value:"anime"},{title:l("searchEngine.filters.category.software"),value:"software"},{title:l("searchEngine.filters.category.pictures"),value:"pictures"},{title:l("searchEngine.filters.category.books"),value:"books"}].sort((n,d)=>n.title.localeCompare(d.title)).splice(0,0,{title:l("searchEngine.filters.category.all"),value:"all"}),R=U(()=>{const n=[{title:l("searchEngine.filters.plugins.all"),value:"all"},{title:l("searchEngine.filters.plugins.enabled"),value:"enabled"}];return c.searchPlugins.filter(d=>d.enabled).forEach(d=>{n.push({title:d.name,value:d.name})}),n}),r=U(()=>f.value[b.value]??{}),{results:g}=Ne(()=>r.value.results,()=>r.value.filters?.title,n=>n.fileName);function y(){c.createNewTab(),b.value=f.value.length-1,V.value?.focus()}function u(){f.value.length!==1&&(c.deleteTab(r.value.uniqueId),b.value=Math.min(b.value,f.value.length-1))}function B(n){o.version>="5.0.0"?c.downloadTorrent(n.fileUrl,n.engineName):m.pushTorrentToQueue(n.fileUrl),n.downloaded=!0}function se(n){window.open(n.descrLink,"_blank","noreferrer")}async function F(){await c.runNewSearch(r.value),r.value.timer=setInterval(()=>re(r.value),1e3),V.value?.saveValueToHistory()}async function L(n){await c.stopSearch(n),n.timer&&clearInterval(n.timer)}function oe(){f.value.forEach(L)}async function re(n){await c.refreshResults(n)==="Stopped"&&await L(n)}const K=()=>{k.push({name:"dashboard"})};function ue(){C.createDialog(Ae)}function j(n){if(C.hasActiveDialog||$.value)return!1;n.key==="Escape"&&K()}return pe(async()=>{document.addEventListener("keydown",j),f.value.length===0?c.createNewTab():f.value.forEach(n=>{n.id&&n.id!==0&&(n.timer=setInterval(()=>c.refreshResults(n),1e3))}),await c.fetchSearchPlugins()}),he(()=>{document.removeEventListener("keydown",j),f.value.forEach(n=>{n.timer&&clearInterval(n.timer)})}),(n,d)=>(E(),z("div",He,[e(M,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(N,null,{default:a(()=>[x("h1",Oe,p(s(l)("searchEngine.title")),1)]),_:1}),e(N,null,{default:a(()=>[x("div",Fe,[e(h,{icon:"mdi-stop",variant:"plain",color:"error",onClick:oe}),e(h,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:ue}),e(h,{icon:"mdi-close",variant:"plain",onClick:K})])]),_:1})]),_:1}),e(M,{class:"ma-0 pa-0"},{default:a(()=>[e(De,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e($e,{modelValue:b.value,"onUpdate:modelValue":d[0]||(d[0]=i=>b.value=i),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(E(!0),z(ve,null,ye(s(f),i=>(E(),I(xe,{key:i.uniqueId},{default:a(()=>[x("h4",null,p(!i.lastQuery||i.lastQuery.length===0?s(l)("searchEngine.tabHeaderEmpty"):i.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(q),e(h,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:y}),e(h,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:s(f).length===1,onClick:u},null,8,["disabled"])]),_:1})]),_:1}),e(Ie,null,{default:a(()=>[e(Z,null,{default:a(()=>[e(M,{class:"mt-1"},{default:a(()=>[e(N,{cols:"12",md:"6"},{default:a(()=>[e(Me,{modelValue:r.value.query,"onUpdate:modelValue":d[1]||(d[1]=i=>r.value.query=i),"history-key":s(Ue).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:V,autofocus:"",density:"compact","hide-details":"",clearable:"",label:s(l)("searchEngine.query"),onKeydown:Se(A(F,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ee,{modelValue:r.value.filters.category,"onUpdate:modelValue":d[2]||(d[2]=i=>r.value.filters.category=i),height:"1",variant:"outlined",density:"compact","hide-details":"",items:s(v),label:s(l)("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ee,{modelValue:r.value.filters.plugin,"onUpdate:modelValue":d[3]||(d[3]=i=>r.value.filters.plugin=i),flat:"",density:"compact","hide-details":"",variant:"outlined",items:R.value,label:s(l)("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[r.value.id===0?(E(),I(h,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:F},{default:a(()=>[_(p(s(l)("searchEngine.runSearch")),1)]),_:1})):(E(),I(h,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:d[4]||(d[4]=i=>L(r.value))},{default:a(()=>[_(p(s(l)("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(qe,{class:"my-3"}),e(Z,{class:"text-select"},{default:a(()=>[e(ne,{mobile:null,headers:t.value,items:s(g),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":r.value.itemsPerPage},{top:a(()=>[e(M,null,{default:a(()=>[e(N,{cols:"12"},{default:a(()=>[e(te,{modelValue:r.value.filters.title,"onUpdate:modelValue":d[5]||(d[5]=i=>r.value.filters.title=i),density:"compact","hide-details":"",label:s(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:i})=>[_(p(s(Re)(i.fileSize,s(T))),1)]),"item.pubDate":a(({value:i})=>[_(p(i===-1?s(l)("common.NA"):s(Be)(i,s(D))),1)]),"item.actions":a(({item:i})=>[e(h,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:A(ce=>se(i),["stop"])},null,8,["onClick"]),e(h,{icon:i.downloaded?"mdi-check":"mdi-download",color:i.downloaded&&"accent",variant:"text",density:"compact",onClick:ce=>B(i)},null,8,["icon","color","onClick"])]),_:2},1032,["headers","items","items-per-page"])]),_:1})]),_:1})]))}});export{Je as default};
