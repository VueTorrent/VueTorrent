import{a3 as be,b as U,f as fe,r as ve,e as X,K as f,L as d,O as e,n as t,R as c,P as u,u as r,T as Z,U as M,V as _,F as A,W as _e,X as he,Y as Se,Q as Te,z as Fe,y as k,_ as ne,v as ie,q as xe}from"./vue-CbNcDebW.js";import{p as we}from"./purify.es-DxJI3Wx7.js";import{ai as E,p as ze,n as pe,$ as ke,aj as x,ak as ye,V as $,q as J,al as ee,am as te,A as V,r as re,G as Ve,F as p,an as de,ao as ue,K as O,I as me,ap as Y,s as Le,aq as N,y as Pe,B as oe,Z as De,d as Ue,ar as Ae,E as He,as as z,H as B,z as G,Q,x as L,R as W,at as ce,au as Ie,av as Re,aw as Ee}from"./index-8KtbAbyR.js";import{V as Ne}from"./VForm-C9YRRK7n.js";import{V as Be}from"./VEmptyState-Bc05ioZj.js";import{V as Me}from"./VDataTable-1X1aorzk.js";import{d as $e}from"./vuetify-CnSZir_0.js";import"./VPagination-CFBnkQpL.js";const ge=be("torrentCreator",()=>{const P=U([]);async function D(){P.value=await E.getTorrentCreatorStatus()}async function C(g){return await E.addTorrentCreatorTask(g)}async function o(g){return await E.deleteTorrentCreatorTask(g)}async function b(g){return await E.getTorrentCreatorOutput(g)}return{tasks:P,fetchTasks:D,createTask:C,deleteTask:o,downloadTorrent:b}}),Oe=fe({__name:"TorrentCreatorFormDialog",props:{guid:{}},setup(P){const D=P,{isOpened:C}=ze(D.guid),{t:o}=pe(),b=ke(),g=ge(),h=U(),S=U(!1),n=ve({sourcePath:"",format:x.HYBRID,pieceSize:0,optimizeAlignment:!1,paddedFileSizeLimit:0,private:!1,startSeeding:!1,torrentFilePath:"",trackers:"",urlSeeds:"",source:"",comment:""}),H=[{title:o("constants.torrentFormat.v1"),value:x.V1},{title:o("constants.torrentFormat.v2"),value:x.V2},{title:o("constants.torrentFormat.hybrid"),value:x.HYBRID}],w=U(),I=U(),R=X(()=>{const v=[{title:o("common.auto"),value:0}];for(let l=16*1024;l<5e8;l*=2)v.push({title:ye(l,!0,0),value:l});return v}),q=[v=>!v||v<-1||o("dialogs.torrentCreator.paddedFileSizeLimitRule")];function j(){w.value?.saveValueToHistory(),I.value?.saveValueToHistory()}async function K(){S.value&&(await g.createTask(n),j(),T())}function T(){C.value=!1}return(v,l)=>(d(),f(oe,{modelValue:r(C),"onUpdate:modelValue":l[14]||(l[14]=s=>_e(C)?C.value=s:null),"max-width":"1250"},{default:e(()=>[t($,null,{default:e(()=>[t(J,{class:"ios-margin"},{default:e(()=>[t(ee,{color:"transparent"},{default:e(()=>[t(te,null,{default:e(()=>[c(u(r(o)("dialogs.torrentCreator.title")),1)]),_:1}),t(V,{icon:"mdi-close",onClick:T})]),_:1})]),_:1}),t(re,null,{default:e(()=>[t(r(Ne),{ref_key:"form",ref:h,modelValue:S.value,"onUpdate:modelValue":l[12]||(l[12]=s=>S.value=s),onSubmit:l[13]||(l[13]=Z(()=>{},["prevent"]))},{default:e(()=>[t(Ve,null,{default:e(()=>[t(p,{cols:"12"},{default:e(()=>[t(de,{ref_key:"sourcePath",ref:w,modelValue:n.sourcePath,"onUpdate:modelValue":l[0]||(l[0]=s=>n.sourcePath=s),title:r(o)("dialogs.torrentCreator.sourcePath"),"history-key":r(ue).TORRENT_PATH,rules:[s=>!!s||r(o)("dialogs.torrentCreator.rules.sourcePathRequired")]},null,8,["modelValue","title","history-key","rules"])]),_:1}),t(p,{cols:"12"},{default:e(()=>[t(de,{ref_key:"torrentFilePath",ref:I,modelValue:n.torrentFilePath,"onUpdate:modelValue":l[1]||(l[1]=s=>n.torrentFilePath=s),title:r(o)("dialogs.torrentCreator.torrentFilePath"),"history-key":r(ue).TORRENT_PATH,rules:[s=>!s||s.endsWith(".torrent")||r(o)("dialogs.torrentCreator.rules.outputFileExtension")]},null,8,["modelValue","title","history-key","rules"])]),_:1}),t(O),r(b).usesLibtorrent2?(d(),f(p,{key:0,cols:"12",sm:"6",class:"pb-0"},{default:e(()=>[t(me,{modelValue:n.format,"onUpdate:modelValue":l[2]||(l[2]=s=>n.format=s),"hide-details":"",items:H,label:r(o)("dialogs.torrentCreator.format")},null,8,["modelValue","label"])]),_:1})):M("",!0),t(p,{cols:"12",sm:r(b).usesLibtorrent2?6:void 0,class:"pb-0"},{default:e(()=>[t(me,{modelValue:n.pieceSize,"onUpdate:modelValue":l[3]||(l[3]=s=>n.pieceSize=s),"hide-details":"",items:R.value,label:r(o)("dialogs.torrentCreator.pieceSize")},null,8,["modelValue","items","label"])]),_:1},8,["sm"]),r(b).usesLibtorrent1?(d(),_(A,{key:1},[t(p,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Y,{modelValue:n.optimizeAlignment,"onUpdate:modelValue":l[4]||(l[4]=s=>n.optimizeAlignment=s),"hide-details":"",label:r(o)("dialogs.torrentCreator.optimizeAlignment")},null,8,["modelValue","label"])]),_:1}),t(p,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Le,{modelValue:n.paddedFileSizeLimit,"onUpdate:modelValue":l[5]||(l[5]=s=>n.paddedFileSizeLimit=s),modelModifiers:{number:!0},min:"-1",rules:q,label:r(o)("dialogs.torrentCreator.paddedFileSizeLimit"),hint:r(o)("dialogs.torrentCreator.paddedFileSizeLimitHint"),suffix:"kiB"},null,8,["modelValue","label","hint"])]),_:1})],64)):M("",!0),t(p,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Y,{modelValue:n.private,"onUpdate:modelValue":l[6]||(l[6]=s=>n.private=s),"hide-details":"",label:r(o)("dialogs.torrentCreator.private")},null,8,["modelValue","label"])]),_:1}),t(p,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Y,{modelValue:n.startSeeding,"onUpdate:modelValue":l[7]||(l[7]=s=>n.startSeeding=s),"hide-details":"",label:r(o)("dialogs.torrentCreator.startSeeding")},null,8,["modelValue","label"])]),_:1}),t(O),t(p,{cols:"12"},{default:e(()=>[t(N,{modelValue:n.trackers,"onUpdate:modelValue":l[8]||(l[8]=s=>n.trackers=s),label:r(o)("dialogs.torrentCreator.trackers"),hint:r(o)("dialogs.torrentCreator.trackersHint")},null,8,["modelValue","label","hint"])]),_:1}),t(p,{cols:"12"},{default:e(()=>[t(N,{modelValue:n.urlSeeds,"onUpdate:modelValue":l[9]||(l[9]=s=>n.urlSeeds=s),"hide-details":"",label:r(o)("dialogs.torrentCreator.urlSeeds")},null,8,["modelValue","label"])]),_:1}),r(b).isFeatureAvailable("5.1.0")?(d(),f(p,{key:2,cols:"12"},{default:e(()=>[t(N,{modelValue:n.source,"onUpdate:modelValue":l[10]||(l[10]=s=>n.source=s),"hide-details":"",label:r(o)("dialogs.torrentCreator.source")},null,8,["modelValue","label"])]),_:1})):M("",!0),t(p,{cols:"12"},{default:e(()=>[t(N,{modelValue:n.comment,"onUpdate:modelValue":l[11]||(l[11]=s=>n.comment=s),"hide-details":"",label:r(o)("dialogs.torrentCreator.comment")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Pe,null,{default:e(()=>[t(V,{disabled:!S.value,color:"accent",onClick:K},{default:e(()=>[c(u(r(o)("dialogs.torrentCreator.actions.submit")),1)]),_:1},8,["disabled"]),t(V,{color:"error",onClick:T},{default:e(()=>[c(u(r(o)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),qe={class:"pa-3"},je={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Ke={class:"d-flex justify-end"},Ye={class:"d-flex align-center flex-gap"},Ge={class:"text-no-wrap"},Qe={class:"text-no-wrap"},We={class:"text-no-wrap"},Xe={class:"text-no-wrap"},Ze={key:1},Je={class:"text-no-wrap"},et={key:1},tt=["innerHTML"],rt=["innerHTML"],mt=fe({__name:"TorrentCreator",setup(P){const{height:D}=$e(),C=he(),{t:o}=pe(),b=ke(),g=De(),h=ge(),{tasks:S}=Se(h),n=Ue(),H=Ae(function*(){yield h.fetchTasks()}).drop(),{isActive:w,pause:I,resume:R}=He(()=>void H.perform(),1e3,{immediate:!0,immediateCallback:!0}),q=R,j=X(()=>D.value-64-12*2-48),K=X(()=>[{key:"actions",sortable:!1},{title:o("torrentCreator.table.sourcePath"),key:"sourcePath"},{title:o("torrentCreator.table.status"),key:"status"},{title:o("torrentCreator.table.progress"),key:"progress"},b.usesLibtorrent2?{title:o("torrentCreator.table.format"),key:"format"}:{title:o("torrentCreator.table.optimizeAlignment"),key:"optimizeAlignment"},{title:o("torrentCreator.table.pieceSize"),key:"pieceSize"},{title:o("torrentCreator.table.private"),key:"private"},{title:o("torrentCreator.table.timeAdded"),key:"timeAdded"},{title:o("torrentCreator.table.timeStarted"),key:"timeStarted"},{title:o("torrentCreator.table.timeFinished"),key:"timeFinished"},{title:o("torrentCreator.table.trackers.header"),key:"trackers",sortable:!1},{title:o("torrentCreator.table.urlSeeds.header"),key:"urlSeeds",sortable:!1},{title:o("torrentCreator.table.source"),key:"source"},{title:o("torrentCreator.table.comment"),key:"comment"},{title:o("torrentCreator.table.errorMessage"),key:"errorMessage"}]),T={[z.FAILED]:"error",[z.RUNNING]:"torrent-ul_stalled",[z.QUEUED]:"warning",[z.FINISHED]:"success"},v={[x.V1]:"V1",[x.V2]:"V2",[x.HYBRID]:"Hybrid"};function l(){g.createDialog(Oe,{},()=>void h.fetchTasks())}async function s(y){const m=await h.downloadTorrent(y.taskID),a=Re(y.torrentFilePath);let i;a&&a.endsWith(".torrent")?i=a.slice(0,-8):a?i=a:i=y.taskID,Ee(`${i}.torrent`,m)}async function Ce(y){await h.deleteTask(y.taskID),q()}function ae(y){return y?.length?we.sanitize(y,{USE_PROFILES:{html:!0}}).replaceAll(`
`,"<br>"):""}function le(){C.push({name:"dashboard"})}function se(y){if(g.hasActiveDialog)return!1;y.key==="Escape"&&(y.preventDefault(),le())}return Te(()=>{document.addEventListener("keydown",se),H.perform()}),Fe(()=>{document.removeEventListener("keydown",se)}),(y,m)=>(d(),_("div",qe,[t(Ve,{"no-gutters":"",align:"center",justify:"center"},{default:e(()=>[t(p,null,{default:e(()=>[k("h1",je,u(r(o)("torrentCreator.title")),1)]),_:1}),t(p,null,{default:e(()=>[k("div",Ke,[t(V,{icon:"mdi-close",variant:"plain",onClick:le})])]),_:1})]),_:1}),r(S).length?(d(),f(Q,{key:1},{default:e(()=>[t(B,null,{default:e(()=>[k("div",Ye,[t(G),t(V,{color:"accent","prepend-icon":r(w)?"mdi-timer-pause":"mdi-timer-play",text:r(w)?r(o)("common.pause"):r(o)("common.resume"),onClick:m[1]||(m[1]=a=>r(w)?r(I)():r(R)())},null,8,["prepend-icon","text"]),t(V,{color:"accent","prepend-icon":"mdi-plus",text:r(o)("torrentCreator.table.create"),onClick:l},null,8,["text"])])]),_:1}),t(O,{class:"my-3"}),t(B,{class:"text-select"},{default:e(()=>[t(Me,{"header-props":{class:"text-no-wrap"},mobile:null,headers:K.value,items:r(S),"multi-sort":"","footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{"item.status":e(({item:a,value:i})=>[k("span",{class:xe(`text-${T[a.status]}`)},u(r(o)(`constants.torrentCreatorTaskStatus.${i.toLowerCase()}`)),3)]),"item.progress":e(({item:a,value:i})=>[a.status===r(z).RUNNING?(d(),f(ce,{key:0,"model-value":i,color:T[a.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[c(u(i)+" % ",1)]),_:2},1032,["model-value","color"])):(d(),f(ce,{key:1,"model-value":100,color:T[a.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[c(u(r(Ie)(1)),1)]),_:1},8,["color"]))]),"item.format":e(({value:a})=>[c(u(v[a]),1)]),"item.pieceSize":e(({value:a})=>[c(u(r(ye)(a,r(n).useBinarySize,0)),1)]),"item.private":e(({value:a})=>[a?(d(),f(L,{key:0,color:"accent"},{default:e(()=>[...m[2]||(m[2]=[c(" mdi-check-bold ",-1)])]),_:1})):(d(),f(L,{key:1,color:"error"},{default:e(()=>[...m[3]||(m[3]=[c(" mdi-close-thick ",-1)])]),_:1}))]),"item.optimizeAlignment":e(({value:a})=>[a?(d(),f(L,{key:0,color:"accent"},{default:e(()=>[...m[4]||(m[4]=[c(" mdi-check-bold ",-1)])]),_:1})):(d(),f(L,{key:1,color:"error"},{default:e(()=>[...m[5]||(m[5]=[c(" mdi-close-thick ",-1)])]),_:1}))]),"item.timeAdded":e(({value:a})=>[k("div",Ge,u(r(W)(a).format(r(n).dateFormat)),1)]),"item.timeFinished":e(({value:a})=>[k("div",Qe,u(r(W)(a).format(r(n).dateFormat)),1)]),"item.timeStarted":e(({value:a})=>[k("div",We,u(r(W)(a).format(r(n).dateFormat)),1)]),"item.trackers":e(({value:a})=>[a&&a.length&&!a.every(i=>!i.length)?(d(),f(oe,{key:0},{activator:e(({props:i})=>[k("div",Xe,[k("span",null,u(r(o)("torrentCreator.table.trackers.activator",a.filter(F=>F.length).length)),1),t(L,ie({class:"ml-1"},i),{default:e(()=>[...m[6]||(m[6]=[c(" mdi-information ",-1)])]),_:1},16)])]),default:e(()=>[t($,null,{default:e(()=>[t(J,{class:"ios-margin"},{default:e(()=>[t(ee,{color:"transparent"},{default:e(()=>[t(te,null,{default:e(()=>[c(u(r(o)("torrentCreator.table.trackers.title")),1)]),_:1}),t(G),t(V,{icon:"mdi-close"})]),_:1})]),_:1}),t(re,null,{default:e(()=>[t(Q,null,{default:e(()=>[(d(!0),_(A,null,ne(a,(i,F)=>(d(),_(A,{key:F},[i?(d(),f(B,{key:0},{default:e(()=>[c(u(i),1)]),_:2},1024)):(d(),f(O,{key:1}))],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),_("span",Ze,u(r(o)("common.none")),1))]),"item.urlSeeds":e(({value:a})=>[a&&a.length&&!a.every(i=>!i.length)?(d(),f(oe,{key:0},{activator:e(({props:i})=>[k("div",Je,[k("span",null,u(r(o)("torrentCreator.table.urlSeeds.activator",a.filter(F=>F.length).length)),1),t(L,ie({class:"ml-1"},i),{default:e(()=>[...m[7]||(m[7]=[c(" mdi-information ",-1)])]),_:1},16)])]),default:e(()=>[t($,null,{default:e(()=>[t(J,{class:"ios-margin"},{default:e(()=>[t(ee,{color:"transparent"},{default:e(()=>[t(te,null,{default:e(()=>[c(u(r(o)("torrentCreator.table.urlSeeds.title")),1)]),_:1}),t(G),t(V,{icon:"mdi-close"})]),_:1})]),_:1}),t(re,null,{default:e(()=>[t(Q,null,{default:e(()=>[(d(!0),_(A,null,ne(a.filter(i=>i.length),(i,F)=>(d(),_(A,null,[i?(d(),f(B,{key:F},{default:e(()=>[c(u(i),1)]),_:2},1024)):M("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),_("span",et,u(r(o)("common.none")),1))]),"item.comment":e(({value:a})=>[k("div",{class:"text-no-wrap",innerHTML:ae(a)},null,8,tt)]),"item.errorMessage":e(({value:a})=>[k("div",{class:"text-no-wrap",innerHTML:ae(a)},null,8,rt)]),"item.actions":e(({item:a})=>[t(V,{disabled:a.status!==r(z).FINISHED,color:"accent",icon:"mdi-download",variant:"text",density:"compact",onClick:Z(i=>s(a),["stop"])},null,8,["disabled","onClick"]),t(V,{color:"red",icon:"mdi-delete",variant:"text",density:"compact",onClick:Z(i=>Ce(a),["stop"])},null,8,["onClick"])]),_:2},1032,["headers","items"])]),_:1})]),_:1})):(d(),f($,{key:0,height:j.value},{default:e(()=>[t(Be,{title:r(o)("torrentCreator.empty.value"),color:"accent",icon:"mdi-cog-off"},{actions:e(()=>[t(V,{text:r(o)("torrentCreator.empty.action"),color:"accent",onClick:m[0]||(m[0]=a=>l())},null,8,["text"])]),_:1},8,["title"])]),_:1},8,["height"]))]))}});export{mt as default};
