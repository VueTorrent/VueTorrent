import{a3 as ye,b as M,f as te,a0 as _e,a1 as ve,I as c,u as a,J as d,r as Se,e as Q,L as e,m as t,N as p,O as u,Q as J,R as E,S as F,F as U,T as he,U as Te,V as Fe,M as xe,y as we,x as b,X as se,q as ne,n as Le}from"./vue-DYe3GjIu.js";import{a2 as A,G as ae,ac as De,ad as ze,V as me,c as Ue,u as ce,ae as x,a9 as pe,d as H,e as K,J as W,K as X,k as _,f as Z,g as Ae,r as fe,q as V,w as B,t as ie,af as j,ag as N,i as Ie,l as ee,F as Pe,o as Ne,ah as Re,p as Ee,ai as w,aj as He,s as R,j as Y,a3 as Me,C as q,a as L,D as G,ak as de,al as Be,am as Oe,an as $e}from"./index-BQJBRxbR.js";import{a as je}from"./vuetify-tIkuDxYg.js";var ke=(g=>(g.ALL="all",g.ONLY_FILES="files",g.ONLY_DIRECTORIES="dirs",g))(ke||{});const Ve=ye("torrentCreator",()=>{const g=M([]);async function v(){g.value=await A.getTorrentCreatorStatus()}async function C(f){return await A.addTorrentCreatorTask(f)}async function l(f){return await A.deleteTorrentCreatorTask(f)}async function S(f){return await A.getTorrentCreatorOutput(f)}return{tasks:g,fetchTasks:v,createTask:C,deleteTask:l,downloadTorrent:S}}),ue=te({__name:"ServerPathField",props:_e({title:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const v=ve(g,"modelValue"),C=M([]),l=ae(),S=ze(async f=>{if(!f)return;const k=await A.getDirectoryContent(f,ke.ALL);k&&(C.value=k)},500);return(f,k)=>a(l).usesQbit5?(d(),c(De,{key:0,modelValue:v.value,"onUpdate:modelValue":k[0]||(k[0]=y=>v.value=y),items:C.value,label:f.title,"onUpdate:search":a(S)},null,8,["modelValue","items","label","onUpdate:search"])):(d(),c(me,{key:1,modelValue:v.value,"onUpdate:modelValue":k[1]||(k[1]=y=>v.value=y),label:f.title},null,8,["modelValue","label"]))}}),Ye=te({__name:"TorrentCreatorFormDialog",props:{guid:{}},setup(g){const v=g,{isOpened:C}=Ue(v.guid),{t:l}=ce(),S=ae(),f=Ve(),k=M(),y=M(!1),n=Se({sourcePath:"",format:x.HYBRID,pieceSize:0,optimizeAlignment:!1,paddedFileSizeLimit:0,private:!1,startSeeding:!1,torrentFilePath:"",trackers:"",urlSeeds:"",source:"",comment:""}),I=[{title:l("constants.torrentFormat.v1"),value:x.V1},{title:l("constants.torrentFormat.v2"),value:x.V2},{title:l("constants.torrentFormat.hybrid"),value:x.HYBRID}],D=Q(()=>{const T=[{title:l("common.auto"),value:0}];for(let r=16*1024;r<5e8;r*=2)T.push({title:pe(r,!0,0),value:r});return T}),O=[T=>!T||T<-1||l("dialogs.torrentCreator.paddedFileSizeLimitRule")];async function P(){y.value&&(await f.createTask(n),z())}const z=()=>{C.value=!1};return(T,r)=>(d(),c(ee,{modelValue:a(C),"onUpdate:modelValue":r[14]||(r[14]=s=>he(C)?C.value=s:null),"max-width":"1250"},{default:e(()=>[t(H,null,{default:e(()=>[t(K,{class:"ios-margin"},{default:e(()=>[t(W,{color:"transparent"},{default:e(()=>[t(X,null,{default:e(()=>[p(u(a(l)("dialogs.torrentCreator.title")),1)]),_:1}),t(_,{icon:"mdi-close",onClick:z})]),_:1})]),_:1}),t(Z,null,{default:e(()=>[t(a(Ae),{modelValue:y.value,"onUpdate:modelValue":r[12]||(r[12]=s=>y.value=s),ref_key:"form",ref:k,onSubmit:r[13]||(r[13]=J(()=>{},["prevent"]))},{default:e(()=>[t(fe,null,{default:e(()=>[t(V,{cols:"12"},{default:e(()=>[t(ue,{modelValue:n.sourcePath,"onUpdate:modelValue":r[0]||(r[0]=s=>n.sourcePath=s),title:a(l)("dialogs.torrentCreator.sourcePath"),rules:[s=>!!s||a(l)("dialogs.torrentCreator.rules.sourcePathRequired")]},null,8,["modelValue","title","rules"])]),_:1}),t(V,{cols:"12"},{default:e(()=>[t(ue,{modelValue:n.torrentFilePath,"onUpdate:modelValue":r[1]||(r[1]=s=>n.torrentFilePath=s),title:a(l)("dialogs.torrentCreator.torrentFilePath"),rules:[s=>!s||s.endsWith(".torrent")||a(l)("dialogs.torrentCreator.rules.outputFileExtension")]},null,8,["modelValue","title","rules"])]),_:1}),t(B),a(S).usesLibtorrent2?(d(),c(V,{key:0,cols:"12",sm:"6",class:"pb-0"},{default:e(()=>[t(ie,{modelValue:n.format,"onUpdate:modelValue":r[2]||(r[2]=s=>n.format=s),"hide-details":"",items:I,label:a(l)("dialogs.torrentCreator.format")},null,8,["modelValue","label"])]),_:1})):E("",!0),t(V,{cols:"12",sm:a(S).usesLibtorrent2?6:void 0,class:"pb-0"},{default:e(()=>[t(ie,{modelValue:n.pieceSize,"onUpdate:modelValue":r[3]||(r[3]=s=>n.pieceSize=s),"hide-details":"",items:D.value,label:a(l)("dialogs.torrentCreator.pieceSize")},null,8,["modelValue","items","label"])]),_:1},8,["sm"]),a(S).usesLibtorrent1?(d(),F(U,{key:1},[t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.optimizeAlignment,"onUpdate:modelValue":r[4]||(r[4]=s=>n.optimizeAlignment=s),"hide-details":"",label:a(l)("dialogs.torrentCreator.optimizeAlignment")},null,8,["modelValue","label"])]),_:1}),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(me,{modelValue:n.paddedFileSizeLimit,"onUpdate:modelValue":r[5]||(r[5]=s=>n.paddedFileSizeLimit=s),modelModifiers:{number:!0},min:"-1",rules:O,label:a(l)("dialogs.torrentCreator.paddedFileSizeLimit"),hint:a(l)("dialogs.torrentCreator.paddedFileSizeLimitHint"),suffix:"kiB"},null,8,["modelValue","label","hint"])]),_:1})],64)):E("",!0),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.private,"onUpdate:modelValue":r[6]||(r[6]=s=>n.private=s),"hide-details":"",label:a(l)("dialogs.torrentCreator.private")},null,8,["modelValue","label"])]),_:1}),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.startSeeding,"onUpdate:modelValue":r[7]||(r[7]=s=>n.startSeeding=s),"hide-details":"",label:a(l)("dialogs.torrentCreator.startSeeding")},null,8,["modelValue","label"])]),_:1}),t(B),t(V,{cols:"12"},{default:e(()=>[t(N,{modelValue:n.trackers,"onUpdate:modelValue":r[8]||(r[8]=s=>n.trackers=s),label:a(l)("dialogs.torrentCreator.trackers"),hint:a(l)("dialogs.torrentCreator.trackersHint")},null,8,["modelValue","label","hint"])]),_:1}),t(V,{cols:"12"},{default:e(()=>[t(N,{modelValue:n.urlSeeds,"onUpdate:modelValue":r[9]||(r[9]=s=>n.urlSeeds=s),"hide-details":"",label:a(l)("dialogs.torrentCreator.urlSeeds")},null,8,["modelValue","label"])]),_:1}),a(S).isFeatureAvailable("5.1.0")?(d(),c(V,{key:2,cols:"12"},{default:e(()=>[t(N,{modelValue:n.source,"onUpdate:modelValue":r[10]||(r[10]=s=>n.source=s),"hide-details":"",label:a(l)("dialogs.torrentCreator.source")},null,8,["modelValue","label"])]),_:1})):E("",!0),t(V,{cols:"12"},{default:e(()=>[t(N,{modelValue:n.comment,"onUpdate:modelValue":r[11]||(r[11]=s=>n.comment=s),"hide-details":"",label:a(l)("dialogs.torrentCreator.comment")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Ie,null,{default:e(()=>[t(_,{disabled:!y.value,color:"accent",onClick:P},{default:e(()=>[p(u(a(l)("dialogs.torrentCreator.actions.submit")),1)]),_:1},8,["disabled"]),t(_,{color:"error",onClick:z},{default:e(()=>[p(u(a(l)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),qe={class:"pa-3"},Ge={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Qe={class:"d-flex justify-end"},Je={class:"d-flex align-center flex-gap"},Ke={class:"text-no-wrap"},We={class:"text-no-wrap"},Xe={class:"text-no-wrap"},Ze={class:"text-no-wrap"},et={key:1},tt={class:"text-no-wrap"},at={key:1},lt=["innerHTML"],ot=["innerHTML"],it=te({__name:"TorrentCreator",setup(g){const{height:v}=je(),C=Te(),{t:l}=ce(),S=ae(),f=Pe(),k=Ve(),{tasks:y}=Fe(k),n=Ne(),I=Re(function*(){yield k.fetchTasks()}).drop(),{isActive:D,pause:O,resume:P}=Ee(I.perform,1e3,{immediate:!0,immediateCallback:!0}),z=P,T=Q(()=>v.value-64-12*2-48),r=Q(()=>[{key:"actions",sortable:!1},{title:l("torrentCreator.table.sourcePath"),key:"sourcePath"},{title:l("torrentCreator.table.status"),key:"status"},{title:l("torrentCreator.table.progress"),key:"progress"},S.usesLibtorrent2?{title:l("torrentCreator.table.format"),key:"format"}:{title:l("torrentCreator.table.optimizeAlignment"),key:"optimizeAlignment"},{title:l("torrentCreator.table.pieceSize"),key:"pieceSize"},{title:l("torrentCreator.table.private"),key:"private"},{title:l("torrentCreator.table.timeAdded"),key:"timeAdded"},{title:l("torrentCreator.table.timeStarted"),key:"timeStarted"},{title:l("torrentCreator.table.timeFinished"),key:"timeFinished"},{title:l("torrentCreator.table.trackers.header"),key:"trackers",sortable:!1},{title:l("torrentCreator.table.urlSeeds.header"),key:"urlSeeds",sortable:!1},{title:l("torrentCreator.table.source"),key:"source"},{title:l("torrentCreator.table.comment"),key:"comment"},{title:l("torrentCreator.table.errorMessage"),key:"errorMessage"}]),s={[w.FAILED]:"error",[w.RUNNING]:"torrent-ul_stalled",[w.QUEUED]:"warning",[w.FINISHED]:"success"},be={[x.V1]:"V1",[x.V2]:"V2",[x.HYBRID]:"Hybrid"};function le(){f.createDialog(Ye,{},k.fetchTasks)}async function ge(h){const m=await k.downloadTorrent(h.taskID),o=Oe(h.torrentFilePath);let i;o&&o.endsWith(".torrent")?i=o.slice(0,-8):o?i=o:i=h.taskID,$e(`${i}.torrent`,m)}async function Ce(h){await k.deleteTask(h.taskID),z()}const oe=()=>{C.push({name:"dashboard"})};function re(h){if(f.hasActiveDialog)return!1;h.key==="Escape"&&(h.preventDefault(),oe())}return xe(async()=>{document.addEventListener("keydown",re),I.perform()}),we(()=>{document.removeEventListener("keydown",re)}),(h,m)=>(d(),F("div",qe,[t(fe,{"no-gutters":"",align:"center",justify:"center"},{default:e(()=>[t(V,null,{default:e(()=>[b("h1",Ge,u(a(l)("torrentCreator.title")),1)]),_:1}),t(V,null,{default:e(()=>[b("div",Qe,[t(_,{icon:"mdi-close",variant:"plain",onClick:oe})])]),_:1})]),_:1}),a(y).length?(d(),c(q,{key:1},{default:e(()=>[t(R,null,{default:e(()=>[b("div",Je,[t(Y),t(_,{color:"accent","prepend-icon":a(D)?"mdi-timer-pause":"mdi-timer-play",text:a(D)?a(l)("common.pause"):a(l)("common.resume"),onClick:m[1]||(m[1]=o=>a(D)?a(O)():a(P)())},null,8,["prepend-icon","text"]),t(_,{color:"accent","prepend-icon":"mdi-plus",text:a(l)("torrentCreator.table.create"),onClick:le},null,8,["text"])])]),_:1}),t(B,{class:"my-3"}),t(R,{class:"text-select"},{default:e(()=>[t(Me,{"header-props":{class:"text-no-wrap"},mobile:null,headers:r.value,items:a(y),"multi-sort":"","footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{"item.status":e(({item:o,value:i})=>[b("span",{class:Le(`text-${s[o.status]}`)},u(a(l)(`constants.torrentCreatorTaskStatus.${i.toLowerCase()}`)),3)]),"item.progress":e(({item:o,value:i})=>[o.status===a(w).RUNNING?(d(),c(de,{key:0,"model-value":i,color:s[o.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(i)+" % ",1)]),_:2},1032,["model-value","color"])):(d(),c(de,{key:1,"model-value":100,color:s[o.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(a(Be)(1)),1)]),_:2},1032,["color"]))]),"item.format":e(({value:o})=>[p(u(be[o]),1)]),"item.pieceSize":e(({value:o})=>[p(u(a(pe)(o,a(n).useBinarySize,0)),1)]),"item.private":e(({value:o})=>[o?(d(),c(L,{key:0,color:"accent"},{default:e(()=>m[2]||(m[2]=[p("mdi-check-bold")])),_:1,__:[2]})):(d(),c(L,{key:1,color:"error"},{default:e(()=>m[3]||(m[3]=[p("mdi-close-thick")])),_:1,__:[3]}))]),"item.optimizeAlignment":e(({value:o})=>[o?(d(),c(L,{key:0,color:"accent"},{default:e(()=>m[4]||(m[4]=[p("mdi-check-bold")])),_:1,__:[4]})):(d(),c(L,{key:1,color:"error"},{default:e(()=>m[5]||(m[5]=[p("mdi-close-thick")])),_:1,__:[5]}))]),"item.timeAdded":e(({value:o})=>[b("div",Ke,u(a(G)(o).format(a(n).dateFormat)),1)]),"item.timeFinished":e(({value:o})=>[b("div",We,u(a(G)(o).format(a(n).dateFormat)),1)]),"item.timeStarted":e(({value:o})=>[b("div",Xe,u(a(G)(o).format(a(n).dateFormat)),1)]),"item.trackers":e(({value:o})=>[o&&o.length&&!o.every(i=>!i.length)?(d(),c(ee,{key:0},{activator:e(({props:i})=>[b("div",Ze,[b("span",null,u(a(l)("torrentCreator.table.trackers.activator",o.filter($=>$.length).length)),1),t(L,ne({class:"ml-1"},i),{default:e(()=>m[6]||(m[6]=[p("mdi-information")])),_:2,__:[6]},1040)])]),default:e(()=>[t(H,null,{default:e(()=>[t(K,{class:"ios-margin"},{default:e(()=>[t(W,{color:"transparent"},{default:e(()=>[t(X,null,{default:e(()=>[p(u(a(l)("torrentCreator.table.trackers.title")),1)]),_:1}),t(Y),t(_,{icon:"mdi-close"})]),_:1})]),_:1}),t(Z,null,{default:e(()=>[t(q,null,{default:e(()=>[(d(!0),F(U,null,se(o,i=>(d(),F(U,null,[i?(d(),c(R,{key:0},{default:e(()=>[p(u(i),1)]),_:2},1024)):(d(),c(B,{key:1}))],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",et,u(a(l)("common.none")),1))]),"item.urlSeeds":e(({value:o})=>[o&&o.length&&!o.every(i=>!i.length)?(d(),c(ee,{key:0},{activator:e(({props:i})=>[b("div",tt,[b("span",null,u(a(l)("torrentCreator.table.urlSeeds.activator",o.filter($=>$.length).length)),1),t(L,ne({class:"ml-1"},i),{default:e(()=>m[7]||(m[7]=[p("mdi-information")])),_:2,__:[7]},1040)])]),default:e(()=>[t(H,null,{default:e(()=>[t(K,{class:"ios-margin"},{default:e(()=>[t(W,{color:"transparent"},{default:e(()=>[t(X,null,{default:e(()=>[p(u(a(l)("torrentCreator.table.urlSeeds.title")),1)]),_:1}),t(Y),t(_,{icon:"mdi-close"})]),_:1})]),_:1}),t(Z,null,{default:e(()=>[t(q,null,{default:e(()=>[(d(!0),F(U,null,se(o.filter(i=>i.length),i=>(d(),F(U,null,[i?(d(),c(R,{key:0},{default:e(()=>[p(u(i),1)]),_:2},1024)):E("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",at,u(a(l)("common.none")),1))]),"item.comment":e(({value:o})=>[b("div",{class:"text-no-wrap",innerHTML:o?.length?o.replaceAll(`
`,"<br>"):""},null,8,lt)]),"item.errorMessage":e(({value:o})=>[b("div",{class:"text-no-wrap",innerHTML:o?.length?o.replaceAll(`
`,"<br>"):""},null,8,ot)]),"item.actions":e(({item:o})=>[t(_,{disabled:o.status!==a(w).FINISHED,color:"accent",icon:"mdi-download",variant:"text",density:"compact",onClick:J(i=>ge(o),["stop"])},null,8,["disabled","onClick"]),t(_,{color:"red",icon:"mdi-delete",variant:"text",density:"compact",onClick:J(i=>Ce(o),["stop"])},null,8,["onClick"])]),_:2},1032,["headers","items"])]),_:1})]),_:1})):(d(),c(H,{key:0,height:T.value},{default:e(()=>[t(He,{title:a(l)("torrentCreator.empty.value"),color:"accent",icon:"mdi-cog-off"},{actions:e(()=>[t(_,{text:a(l)("torrentCreator.empty.action"),color:"accent",onClick:m[0]||(m[0]=o=>le())},null,8,["text"])]),_:1},8,["title"])]),_:1},8,["height"]))]))}});export{it as default};
