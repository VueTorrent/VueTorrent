import{a8 as Ve,b as P,f as W,e as B,J as k,K as p,M as a,V as U,W as Q,S as v,Q as r,n as e,y as V,u as s,U as L,v as z,X as _e,Y as we,Z as ne,R as Ee,z as Pe,F as O,$ as Ce,T as Te}from"./vue-RBz4_81T.js";import{aC as xe,aD as x,A as g,a as G,q as Ne,o as ve,r as se,s as $e,z as A,B as ie,v as oe,V as J,y as re,J as De,Y as Ie,$ as Ue,Z as Me,e as qe,au as ue,aE as Qe,F as d,G as I,H as ce,am as Re,an as Be,I as de,K as me,aF as fe,aG as ge,aw as j,Q as Le,aH as ze,aI as Ae}from"./index-YdYC6EeX.js";import{d as he}from"./vuetify-CqJhlpxZ.js";import{V as Fe}from"./VForm-t5rK6lnq.js";import{V as Y}from"./VDataTable-DPaZ8r4B.js";import{V as He}from"./VContainer-BoFCCt77.js";import{V as Ke,a as Oe}from"./VTabs-ci7K_hJF.js";import"./VPagination-k_hGA33X.js";const ye=Ve("searchEngine",()=>{const _=P([]),w=P([]);function S(){_.value.push({uniqueId:xe(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function l(o){_.value=_.value.filter(y=>y.uniqueId!==o)}async function m(o){const y=await x.startSearch(o.query,o.filters.category,[o.filters.plugin]);o.id=y.id,o.results=[],o.lastQuery=o.query}async function C(o){const y=await x.getSearchResults(o.id,o.results.length);return o.results.push(...y.results),y.status}async function E(o){o.id&&o.id!==0&&await x.stopSearch(o.id),o.id=0}async function f(){w.value=await x.getSearchPlugins()}async function h(o){await x.installSearchPlugin([o])}async function N(o){await x.uninstallSearchPlugin([o])}async function T(o){await x.enableSearchPlugin([o.name],!o.enabled)}async function $(){await x.updateSearchPlugins()}async function M(o,y){await x.downloadTorrentWithSearchPlugin(o,y)}return{searchData:_,searchPlugins:w,createNewTab:S,deleteTab:l,runNewSearch:m,refreshResults:C,stopSearch:E,fetchSearchPlugins:f,installSearchPlugin:h,uninstallSearchPlugin:N,toggleSearchPlugin:T,updatePlugins:$,downloadTorrent:M,$reset:()=>{_.value=[],w.value=[],S()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),je={key:1,"data-testid":"mixedbtn-text"},pe=W({__name:"MixedButton",props:{mobileOverride:{type:Boolean},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(_){const w=_,{mobile:S}=he(),l=B(()=>w.mobileOverride?w.mobileValue:S.value);return(m,C)=>(p(),k(g,{icon:l.value},{default:a(()=>[l.value||m.position==="left"?(p(),k(G,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[v(r(m.icon),1)]),_:1})):U("",!0),l.value?U("",!0):(p(),Q("span",je,r(m.text),1)),!l.value&&m.position==="right"?(p(),k(G,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[v(r(m.icon),1)]),_:1})):U("",!0)]),_:1},8,["icon"]))}}),Ge=["href","title"],Je=W({__name:"PluginManagerDialog",props:{guid:{}},setup(_){const w=_,{isOpened:S}=Ne(w.guid),{t:l}=ve(),m=ye(),C=[{title:l("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:l("dialogs.pluginManager.headers.name"),key:"fullName"},{title:l("dialogs.pluginManager.headers.version"),key:"version"},{title:l("dialogs.pluginManager.headers.url"),key:"url"},{title:l("dialogs.pluginManager.headers.actions"),key:"actions"}],E=P(!1),f=P(!1),h=P(!1),N=P(!1),T=P("");async function $(i){await m.toggleSearchPlugin(i),await m.fetchSearchPlugins()}async function M(){f.value=!0,await m.updatePlugins().then(()=>new Promise(i=>setTimeout(i,2e3))),await m.fetchSearchPlugins(),f.value=!1}async function o(){R(),E.value=!0,await m.installSearchPlugin(T.value),T.value="",setTimeout(()=>void m.fetchSearchPlugins().then(()=>E.value=!1),1e3)}async function y(i){E.value=!0,await m.uninstallSearchPlugin(i.name),await m.fetchSearchPlugins(),E.value=!1}function F(){S.value=!1}function R(){h.value=!1}return(i,b)=>(p(),k(ie,{modelValue:s(S),"onUpdate:modelValue":b[4]||(b[4]=u=>_e(S)?S.value=u:null)},{default:a(()=>[e(se,null,{default:a(()=>[e($e,{class:"d-flex"},{default:a(()=>[V("div",null,r(i.$t("dialogs.pluginManager.title")),1),e(A),e(pe,{icon:"mdi-update",text:i.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:f.value,onClick:M},null,8,["text","loading"]),e(ie,{modelValue:h.value,"onUpdate:modelValue":b[3]||(b[3]=u=>h.value=u)},{activator:a(({props:u})=>[e(pe,z({icon:"mdi-toy-brick-plus",text:i.$t("dialogs.pluginManager.install.activator")},u,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(se,{title:i.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(oe,null,{default:a(()=>[e(s(Fe),{modelValue:N.value,"onUpdate:modelValue":b[1]||(b[1]=u=>N.value=u),onSubmit:b[2]||(b[2]=L(()=>{},["prevent"]))},{default:a(()=>[e(J,{modelValue:T.value,"onUpdate:modelValue":b[0]||(b[0]=u=>T.value=u),autofocus:"",label:i.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(re,null,{default:a(()=>[e(A),e(g,{color:"error",onClick:R},{default:a(()=>[v(r(i.$t("common.cancel")),1)]),_:1}),e(g,{color:"accent",onClick:o},{default:a(()=>[v(r(i.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(oe,null,{default:a(()=>[e(Y,{mobile:null,headers:C,"items-per-page":"-1",items:s(m).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:E.value},{"item.enabled":a(({item:u})=>[e(De,{"model-value":u.enabled,onClick:H=>$(u)},null,8,["model-value","onClick"])]),"item.url":a(({item:u})=>[V("a",{href:u.url,title:u.name},r(u.url),9,Ge)]),"item.actions":a(({item:u})=>[e(G,{color:"red",icon:"mdi-delete",onClick:H=>y(u)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(re,null,{default:a(()=>[e(A),e(g,{color:"accent",onClick:F},{default:a(()=>[v(r(i.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ye={class:"pa-3"},We={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Ze={class:"d-flex justify-end"},Xe={class:"item-header-small"},ea={class:"item-value-small"},aa={class:"item-header-small"},la={class:"item-value-small"},ta={class:"item-header-small"},na={class:"item-value-small"},sa=W({__name:"SearchEngine",setup(_){const{mobile:w}=he(),S=we(),{t:l}=ve(),m=Ie(),C=Ue(),E=Me(),f=ye(),{searchData:h}=ne(f),{useBinarySize:N,dateFormat:T}=ne(qe()),$=P(),M=P(!1),o=P(0),y=B(()=>[{title:l("searchEngine.headers.fileName"),key:"fileName"},{title:l("searchEngine.headers.fileSize"),key:"fileSize"},{title:l("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:l("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...C.usesQbit5?[{title:l("searchEngine.headers.engineName"),key:"engineName"},{title:l("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:l("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),F=[{title:l("searchEngine.filters.category.movies"),value:"movies"},{title:l("searchEngine.filters.category.tv"),value:"tv"},{title:l("searchEngine.filters.category.music"),value:"music"},{title:l("searchEngine.filters.category.games"),value:"games"},{title:l("searchEngine.filters.category.anime"),value:"anime"},{title:l("searchEngine.filters.category.software"),value:"software"},{title:l("searchEngine.filters.category.pictures"),value:"pictures"},{title:l("searchEngine.filters.category.books"),value:"books"}].sort((n,c)=>ue.text.asc(n.title,c.title)).toSpliced(0,0,{title:l("searchEngine.filters.category.all"),value:"all"}),R=B(()=>[{title:l("searchEngine.filters.plugins.all"),value:"all"},{title:l("searchEngine.filters.plugins.enabled"),value:"enabled"},...f.searchPlugins.filter(n=>n.enabled).map(n=>n.name).sort(ue.text.asc).map(n=>({title:n,value:n}))]),i=B(()=>h.value[o.value]??{}),{results:b}=Qe(()=>i.value.results,()=>i.value.filters?.title,n=>n.fileName);function u(){f.createNewTab(),o.value=h.value.length-1,$.value?.focus()}function H(){h.value.length!==1&&(f.deleteTab(i.value.uniqueId),o.value=Math.min(o.value,h.value.length-1))}function Z(n){m.pushTorrentToQueue(n.fileUrl)}function X(n){f.downloadTorrent(n.fileUrl,n.engineName).then(()=>n.downloaded=!0)}function ee(n){ze(n.descrLink)}async function ae(){await f.runNewSearch(i.value),i.value.timer=setInterval(()=>void ke(i.value),1e3),$.value?.saveValueToHistory()}async function K(n){await f.stopSearch(n),n.timer&&clearInterval(n.timer)}function be(){Promise.allSettled(h.value.map(K))}async function ke(n){await f.refreshResults(n)==="Stopped"&&await K(n)}function le(){S.push({name:"dashboard"})}function Se(){E.createDialog(Je)}function te(n){if(E.hasActiveDialog||M.value)return!1;n.key==="Escape"&&le()}return Ee(async()=>{document.addEventListener("keydown",te),h.value.length===0?f.createNewTab():h.value.forEach(n=>{n.id&&n.id!==0&&(n.timer=setInterval(()=>void f.refreshResults(n),1e3))}),await f.fetchSearchPlugins()}),Pe(()=>{document.removeEventListener("keydown",te),h.value.forEach(n=>{n.timer&&clearInterval(n.timer)})}),(n,c)=>(p(),Q("div",Ye,[e(I,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(d,null,{default:a(()=>[V("h1",We,r(s(l)("searchEngine.title")),1)]),_:1}),e(d,null,{default:a(()=>[V("div",Ze,[e(g,{icon:"mdi-stop",variant:"plain",color:"error",onClick:be}),e(g,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:Se}),e(g,{icon:"mdi-close",variant:"plain",onClick:le})])]),_:1})]),_:1}),e(I,{class:"ma-0 pa-0"},{default:a(()=>[e(He,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e(Ke,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=t=>o.value=t),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(p(!0),Q(O,null,Ce(s(h),t=>(p(),k(Oe,{key:t.uniqueId},{default:a(()=>[V("h4",null,r(!t.lastQuery||t.lastQuery.length===0?s(l)("searchEngine.tabHeaderEmpty"):t.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(A),e(g,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:u}),e(g,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:s(h).length===1,onClick:H},null,8,["disabled"])]),_:1})]),_:1}),e(Le,null,{default:a(()=>[e(ce,null,{default:a(()=>[e(I,{class:"mt-1"},{default:a(()=>[e(d,{cols:"12",md:"6"},{default:a(()=>[e(Re,{ref_key:"queryInput",ref:$,modelValue:i.value.query,"onUpdate:modelValue":c[1]||(c[1]=t=>i.value.query=t),"history-key":s(Be).SEARCH_ENGINE_QUERY,autofocus:"",density:"compact","hide-details":"",clearable:"",label:s(l)("searchEngine.query"),onKeydown:Te(L(ae,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(d,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(de,{modelValue:i.value.filters.category,"onUpdate:modelValue":c[2]||(c[2]=t=>i.value.filters.category=t),height:"1",variant:"outlined",density:"compact","hide-details":"",items:s(F),label:s(l)("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(d,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(de,{modelValue:i.value.filters.plugin,"onUpdate:modelValue":c[3]||(c[3]=t=>i.value.filters.plugin=t),flat:"",density:"compact","hide-details":"",variant:"outlined",items:R.value,label:s(l)("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(d,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[i.value.id===0?(p(),k(g,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:ae},{default:a(()=>[v(r(s(l)("searchEngine.runSearch")),1)]),_:1})):(p(),k(g,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:c[4]||(c[4]=t=>K(i.value))},{default:a(()=>[v(r(s(l)("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(me,{class:"my-3"}),e(ce,{class:"text-select"},{default:a(()=>[s(w)?(p(),k(Y,{key:0,"items-per-page":i.value.itemsPerPage,"onUpdate:itemsPerPage":c[6]||(c[6]=t=>i.value.itemsPerPage=t),mobile:!0,headers:y.value,items:s(b),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{top:a(()=>[e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(J,{modelValue:i.value.filters.title,"onUpdate:modelValue":c[5]||(c[5]=t=>i.value.filters.title=t),density:"compact","hide-details":"",label:s(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),item:a(({item:t,index:D})=>[D!==0?(p(),k(me,{key:0})):U("",!0),e(I,{class:"row-mobile ma-0 pa-3"},{default:a(()=>[e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[v(r(s(l)("searchEngine.headers.fileName")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[v(r(t.fileName),1)]),_:2},1024),s(C).usesQbit5?(p(),Q(O,{key:0},[e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[v(r(s(l)("searchEngine.headers.engineName")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[v(r(t.engineName),1)]),_:2},1024),e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[v(r(s(l)("searchEngine.headers.pubDate")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[v(r(t.pubDate===-1?s(l)("common.NA"):s(fe)(t.pubDate,s(T))),1)]),_:2},1024)],64)):(p(),Q(O,{key:1},[e(d,{cols:"6",class:"item-header-large"},{default:a(()=>[v(r(s(l)("searchEngine.headers.siteUrl")),1)]),_:1}),e(d,{cols:"6",class:"item-value-large"},{default:a(()=>[v(r(t.siteUrl),1)]),_:2},1024)],64)),e(d,{cols:"3",class:"item-container"},{default:a(()=>[V("div",Xe,r(s(l)("searchEngine.headers.fileSize")),1),V("div",ea,r(s(ge)(t.fileSize,s(N))),1)]),_:2},1024),e(d,{cols:"3",class:"item-container"},{default:a(()=>[V("div",aa,r(s(l)("searchEngine.headers.nbSeeders")),1),V("div",la,r(t.nbSeeders),1)]),_:2},1024),e(d,{cols:"3",class:"item-container"},{default:a(()=>[V("div",ta,r(s(l)("searchEngine.headers.nbLeechers")),1),V("div",na,r(t.nbLeechers),1)]),_:2},1024),e(d,{cols:"3",class:"item-actions"},{default:a(()=>[e(g,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:L(q=>ee(t),["stop"])},null,8,["onClick"]),e(g,{icon:"mdi-plus-box-multiple",variant:"text",density:"compact",onClick:q=>Z(t)},null,8,["onClick"]),s(C).usesQbit5?(p(),k(g,{key:0,icon:t.downloaded?"mdi-check":"mdi-download",color:t.downloaded&&"accent",variant:"text",density:"compact",onClick:q=>X(t)},null,8,["icon","color","onClick"])):U("",!0)]),_:2},1024)]),_:2},1024)]),_:1},8,["items-per-page","headers","items"])):(p(),k(Y,{key:1,"items-per-page":i.value.itemsPerPage,"onUpdate:itemsPerPage":c[8]||(c[8]=t=>i.value.itemsPerPage=t),mobile:!1,headers:y.value,items:s(b),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{top:a(()=>[e(I,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(J,{modelValue:i.value.filters.title,"onUpdate:modelValue":c[7]||(c[7]=t=>i.value.filters.title=t),density:"compact","hide-details":"",label:s(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:t})=>[v(r(s(ge)(t.fileSize,s(N))),1)]),"item.pubDate":a(({value:t})=>[v(r(t===-1?s(l)("common.NA"):s(fe)(t,s(T))),1)]),"item.actions":a(({item:t})=>[e(j,{text:n.$t("searchEngine.tooltip.open_link"),location:"top"},{activator:a(({props:D})=>[e(g,z(D,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:L(q=>ee(t),["stop"])}),null,16,["onClick"])]),_:2},1032,["text"]),e(j,{text:n.$t("searchEngine.tooltip.append_queue"),location:"top"},{activator:a(({props:D})=>[e(g,z(D,{icon:"mdi-plus-box-multiple",variant:"text",density:"compact",onClick:q=>Z(t)}),null,16,["onClick"])]),_:2},1032,["text"]),e(j,{text:n.$t("searchEngine.tooltip.download"),location:"top"},{activator:a(({props:D})=>[s(C).usesQbit5?(p(),k(g,z({key:0},D,{icon:t.downloaded?"mdi-check":"mdi-download",color:t.downloaded&&"accent",variant:"text",density:"compact",onClick:q=>X(t)}),null,16,["icon","color","onClick"])):U("",!0)]),_:2},1032,["text"])]),_:2},1032,["items-per-page","headers","items"]))]),_:1})]),_:1})]))}}),ga=Ae(sa,[["__scopeId","data-v-afa3d01f"]]);export{ga as default};
