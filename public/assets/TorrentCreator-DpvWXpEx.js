import{a8 as ve,b as B,f as te,a5 as Se,a6 as _e,J as c,u as a,K as d,r as he,e as K,M as e,n as t,S as p,Q as u,U as j,V as M,W as F,F as I,X as Te,Y as Fe,Z as xe,R as Le,z as we,y as b,$ as ne,v as ie,q as ze}from"./vue-RBz4_81T.js";import{p as De}from"./purify.es-CEVJ7K31.js";import{aD as A,$ as ae,aJ as Ue,aK as Ie,V as ce,q as Ae,o as pe,aL as L,aG as fe,r as N,s as W,aM as J,aN as Z,A as S,v as X,G as Ve,F as k,K as $,I as de,aO as Y,aP as E,y as Pe,B as ee,Z as Re,e as Ee,aQ as He,E as Me,aR as w,H,z as Q,Q as q,a as z,R as G,aS as ue,aT as Ne,aU as Be,aV as $e}from"./index-DzGSonu0.js";import{V as Oe}from"./VForm-D96fiU_S.js";import{V as Ye}from"./VEmptyState-katFmrV2.js";import{V as Qe}from"./VDataTable-DbRcLuMm.js";import{d as qe}from"./vuetify-CqJhlpxZ.js";import"./VPagination-DBZ8s5xm.js";var ke=(g=>(g.ALL="all",g.ONLY_FILES="files",g.ONLY_DIRECTORIES="dirs",g))(ke||{});const be=ve("torrentCreator",()=>{const g=B([]);async function _(){g.value=await A.getTorrentCreatorStatus()}async function y(f){return await A.addTorrentCreatorTask(f)}async function o(f){return await A.deleteTorrentCreatorTask(f)}async function h(f){return await A.getTorrentCreatorOutput(f)}return{tasks:g,fetchTasks:_,createTask:y,deleteTask:o,downloadTorrent:h}}),me=te({__name:"ServerPathField",props:Se({title:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const _=_e(g,"modelValue"),y=B([]),o=ae(),h=Ie(async f=>{if(!f)return;const V=await A.getDirectoryContent(f,ke.ALL);V&&(y.value=V)},500);return(f,V)=>a(o).usesQbit5?(d(),c(Ue,{key:0,modelValue:_.value,"onUpdate:modelValue":V[0]||(V[0]=v=>_.value=v),items:y.value,label:f.title,"onUpdate:search":a(h)},null,8,["modelValue","items","label","onUpdate:search"])):(d(),c(ce,{key:1,modelValue:_.value,"onUpdate:modelValue":V[1]||(V[1]=v=>_.value=v),label:f.title},null,8,["modelValue","label"]))}}),Ge=te({__name:"TorrentCreatorFormDialog",props:{guid:{}},setup(g){const _=g,{isOpened:y}=Ae(_.guid),{t:o}=pe(),h=ae(),f=be(),V=B(),v=B(!1),n=he({sourcePath:"",format:L.HYBRID,pieceSize:0,optimizeAlignment:!1,paddedFileSizeLimit:0,private:!1,startSeeding:!1,torrentFilePath:"",trackers:"",urlSeeds:"",source:"",comment:""}),P=[{title:o("constants.torrentFormat.v1"),value:L.V1},{title:o("constants.torrentFormat.v2"),value:L.V2},{title:o("constants.torrentFormat.hybrid"),value:L.HYBRID}],D=K(()=>{const T=[{title:o("common.auto"),value:0}];for(let l=16*1024;l<5e8;l*=2)T.push({title:fe(l,!0,0),value:l});return T}),O=[T=>!T||T<-1||o("dialogs.torrentCreator.paddedFileSizeLimitRule")];async function R(){v.value&&(await f.createTask(n),U())}function U(){y.value=!1}return(T,l)=>(d(),c(ee,{modelValue:a(y),"onUpdate:modelValue":l[14]||(l[14]=s=>Te(y)?y.value=s:null),"max-width":"1250"},{default:e(()=>[t(N,null,{default:e(()=>[t(W,{class:"ios-margin"},{default:e(()=>[t(J,{color:"transparent"},{default:e(()=>[t(Z,null,{default:e(()=>[p(u(a(o)("dialogs.torrentCreator.title")),1)]),_:1}),t(S,{icon:"mdi-close",onClick:U})]),_:1})]),_:1}),t(X,null,{default:e(()=>[t(a(Oe),{ref_key:"form",ref:V,modelValue:v.value,"onUpdate:modelValue":l[12]||(l[12]=s=>v.value=s),onSubmit:l[13]||(l[13]=j(()=>{},["prevent"]))},{default:e(()=>[t(Ve,null,{default:e(()=>[t(k,{cols:"12"},{default:e(()=>[t(me,{modelValue:n.sourcePath,"onUpdate:modelValue":l[0]||(l[0]=s=>n.sourcePath=s),title:a(o)("dialogs.torrentCreator.sourcePath"),rules:[s=>!!s||a(o)("dialogs.torrentCreator.rules.sourcePathRequired")]},null,8,["modelValue","title","rules"])]),_:1}),t(k,{cols:"12"},{default:e(()=>[t(me,{modelValue:n.torrentFilePath,"onUpdate:modelValue":l[1]||(l[1]=s=>n.torrentFilePath=s),title:a(o)("dialogs.torrentCreator.torrentFilePath"),rules:[s=>!s||s.endsWith(".torrent")||a(o)("dialogs.torrentCreator.rules.outputFileExtension")]},null,8,["modelValue","title","rules"])]),_:1}),t($),a(h).usesLibtorrent2?(d(),c(k,{key:0,cols:"12",sm:"6",class:"pb-0"},{default:e(()=>[t(de,{modelValue:n.format,"onUpdate:modelValue":l[2]||(l[2]=s=>n.format=s),"hide-details":"",items:P,label:a(o)("dialogs.torrentCreator.format")},null,8,["modelValue","label"])]),_:1})):M("",!0),t(k,{cols:"12",sm:a(h).usesLibtorrent2?6:void 0,class:"pb-0"},{default:e(()=>[t(de,{modelValue:n.pieceSize,"onUpdate:modelValue":l[3]||(l[3]=s=>n.pieceSize=s),"hide-details":"",items:D.value,label:a(o)("dialogs.torrentCreator.pieceSize")},null,8,["modelValue","items","label"])]),_:1},8,["sm"]),a(h).usesLibtorrent1?(d(),F(I,{key:1},[t(k,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Y,{modelValue:n.optimizeAlignment,"onUpdate:modelValue":l[4]||(l[4]=s=>n.optimizeAlignment=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.optimizeAlignment")},null,8,["modelValue","label"])]),_:1}),t(k,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(ce,{modelValue:n.paddedFileSizeLimit,"onUpdate:modelValue":l[5]||(l[5]=s=>n.paddedFileSizeLimit=s),modelModifiers:{number:!0},min:"-1",rules:O,label:a(o)("dialogs.torrentCreator.paddedFileSizeLimit"),hint:a(o)("dialogs.torrentCreator.paddedFileSizeLimitHint"),suffix:"kiB"},null,8,["modelValue","label","hint"])]),_:1})],64)):M("",!0),t(k,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Y,{modelValue:n.private,"onUpdate:modelValue":l[6]||(l[6]=s=>n.private=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.private")},null,8,["modelValue","label"])]),_:1}),t(k,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(Y,{modelValue:n.startSeeding,"onUpdate:modelValue":l[7]||(l[7]=s=>n.startSeeding=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.startSeeding")},null,8,["modelValue","label"])]),_:1}),t($),t(k,{cols:"12"},{default:e(()=>[t(E,{modelValue:n.trackers,"onUpdate:modelValue":l[8]||(l[8]=s=>n.trackers=s),label:a(o)("dialogs.torrentCreator.trackers"),hint:a(o)("dialogs.torrentCreator.trackersHint")},null,8,["modelValue","label","hint"])]),_:1}),t(k,{cols:"12"},{default:e(()=>[t(E,{modelValue:n.urlSeeds,"onUpdate:modelValue":l[9]||(l[9]=s=>n.urlSeeds=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.urlSeeds")},null,8,["modelValue","label"])]),_:1}),a(h).isFeatureAvailable("5.1.0")?(d(),c(k,{key:2,cols:"12"},{default:e(()=>[t(E,{modelValue:n.source,"onUpdate:modelValue":l[10]||(l[10]=s=>n.source=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.source")},null,8,["modelValue","label"])]),_:1})):M("",!0),t(k,{cols:"12"},{default:e(()=>[t(E,{modelValue:n.comment,"onUpdate:modelValue":l[11]||(l[11]=s=>n.comment=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.comment")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Pe,null,{default:e(()=>[t(S,{disabled:!v.value,color:"accent",onClick:R},{default:e(()=>[p(u(a(o)("dialogs.torrentCreator.actions.submit")),1)]),_:1},8,["disabled"]),t(S,{color:"error",onClick:U},{default:e(()=>[p(u(a(o)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ke={class:"pa-3"},je={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},We={class:"d-flex justify-end"},Je={class:"d-flex align-center flex-gap"},Ze={class:"text-no-wrap"},Xe={class:"text-no-wrap"},et={class:"text-no-wrap"},tt={class:"text-no-wrap"},at={key:1},ot={class:"text-no-wrap"},rt={key:1},lt=["innerHTML"],st=["innerHTML"],Vt=te({__name:"TorrentCreator",setup(g){const{height:_}=qe(),y=Fe(),{t:o}=pe(),h=ae(),f=Re(),V=be(),{tasks:v}=xe(V),n=Ee(),P=He(function*(){yield V.fetchTasks()}).drop(),{isActive:D,pause:O,resume:R}=Me(()=>void P.perform(),1e3,{immediate:!0,immediateCallback:!0}),U=R,T=K(()=>_.value-64-12*2-48),l=K(()=>[{key:"actions",sortable:!1},{title:o("torrentCreator.table.sourcePath"),key:"sourcePath"},{title:o("torrentCreator.table.status"),key:"status"},{title:o("torrentCreator.table.progress"),key:"progress"},h.usesLibtorrent2?{title:o("torrentCreator.table.format"),key:"format"}:{title:o("torrentCreator.table.optimizeAlignment"),key:"optimizeAlignment"},{title:o("torrentCreator.table.pieceSize"),key:"pieceSize"},{title:o("torrentCreator.table.private"),key:"private"},{title:o("torrentCreator.table.timeAdded"),key:"timeAdded"},{title:o("torrentCreator.table.timeStarted"),key:"timeStarted"},{title:o("torrentCreator.table.timeFinished"),key:"timeFinished"},{title:o("torrentCreator.table.trackers.header"),key:"trackers",sortable:!1},{title:o("torrentCreator.table.urlSeeds.header"),key:"urlSeeds",sortable:!1},{title:o("torrentCreator.table.source"),key:"source"},{title:o("torrentCreator.table.comment"),key:"comment"},{title:o("torrentCreator.table.errorMessage"),key:"errorMessage"}]),s={[w.FAILED]:"error",[w.RUNNING]:"torrent-ul_stalled",[w.QUEUED]:"warning",[w.FINISHED]:"success"},ge={[L.V1]:"V1",[L.V2]:"V2",[L.HYBRID]:"Hybrid"};function oe(){f.createDialog(Ge,{},()=>void V.fetchTasks())}async function Ce(C){const m=await V.downloadTorrent(C.taskID),r=Be(C.torrentFilePath);let i;r&&r.endsWith(".torrent")?i=r.slice(0,-8):r?i=r:i=C.taskID,$e(`${i}.torrent`,m)}async function ye(C){await V.deleteTask(C.taskID),U()}function re(C){return C?.length?De.sanitize(C,{USE_PROFILES:{html:!0}}).replaceAll(`
`,"<br>"):""}function le(){y.push({name:"dashboard"})}function se(C){if(f.hasActiveDialog)return!1;C.key==="Escape"&&(C.preventDefault(),le())}return Le(()=>{document.addEventListener("keydown",se),P.perform()}),we(()=>{document.removeEventListener("keydown",se)}),(C,m)=>(d(),F("div",Ke,[t(Ve,{"no-gutters":"",align:"center",justify:"center"},{default:e(()=>[t(k,null,{default:e(()=>[b("h1",je,u(a(o)("torrentCreator.title")),1)]),_:1}),t(k,null,{default:e(()=>[b("div",We,[t(S,{icon:"mdi-close",variant:"plain",onClick:le})])]),_:1})]),_:1}),a(v).length?(d(),c(q,{key:1},{default:e(()=>[t(H,null,{default:e(()=>[b("div",Je,[t(Q),t(S,{color:"accent","prepend-icon":a(D)?"mdi-timer-pause":"mdi-timer-play",text:a(D)?a(o)("common.pause"):a(o)("common.resume"),onClick:m[1]||(m[1]=r=>a(D)?a(O)():a(R)())},null,8,["prepend-icon","text"]),t(S,{color:"accent","prepend-icon":"mdi-plus",text:a(o)("torrentCreator.table.create"),onClick:oe},null,8,["text"])])]),_:1}),t($,{class:"my-3"}),t(H,{class:"text-select"},{default:e(()=>[t(Qe,{"header-props":{class:"text-no-wrap"},mobile:null,headers:l.value,items:a(v),"multi-sort":"","footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{"item.status":e(({item:r,value:i})=>[b("span",{class:ze(`text-${s[r.status]}`)},u(a(o)(`constants.torrentCreatorTaskStatus.${i.toLowerCase()}`)),3)]),"item.progress":e(({item:r,value:i})=>[r.status===a(w).RUNNING?(d(),c(ue,{key:0,"model-value":i,color:s[r.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(i)+" % ",1)]),_:2},1032,["model-value","color"])):(d(),c(ue,{key:1,"model-value":100,color:s[r.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(a(Ne)(1)),1)]),_:1},8,["color"]))]),"item.format":e(({value:r})=>[p(u(ge[r]),1)]),"item.pieceSize":e(({value:r})=>[p(u(a(fe)(r,a(n).useBinarySize,0)),1)]),"item.private":e(({value:r})=>[r?(d(),c(z,{key:0,color:"accent"},{default:e(()=>[...m[2]||(m[2]=[p(" mdi-check-bold ",-1)])]),_:1})):(d(),c(z,{key:1,color:"error"},{default:e(()=>[...m[3]||(m[3]=[p(" mdi-close-thick ",-1)])]),_:1}))]),"item.optimizeAlignment":e(({value:r})=>[r?(d(),c(z,{key:0,color:"accent"},{default:e(()=>[...m[4]||(m[4]=[p(" mdi-check-bold ",-1)])]),_:1})):(d(),c(z,{key:1,color:"error"},{default:e(()=>[...m[5]||(m[5]=[p(" mdi-close-thick ",-1)])]),_:1}))]),"item.timeAdded":e(({value:r})=>[b("div",Ze,u(a(G)(r).format(a(n).dateFormat)),1)]),"item.timeFinished":e(({value:r})=>[b("div",Xe,u(a(G)(r).format(a(n).dateFormat)),1)]),"item.timeStarted":e(({value:r})=>[b("div",et,u(a(G)(r).format(a(n).dateFormat)),1)]),"item.trackers":e(({value:r})=>[r&&r.length&&!r.every(i=>!i.length)?(d(),c(ee,{key:0},{activator:e(({props:i})=>[b("div",tt,[b("span",null,u(a(o)("torrentCreator.table.trackers.activator",r.filter(x=>x.length).length)),1),t(z,ie({class:"ml-1"},i),{default:e(()=>[...m[6]||(m[6]=[p(" mdi-information ",-1)])]),_:1},16)])]),default:e(()=>[t(N,null,{default:e(()=>[t(W,{class:"ios-margin"},{default:e(()=>[t(J,{color:"transparent"},{default:e(()=>[t(Z,null,{default:e(()=>[p(u(a(o)("torrentCreator.table.trackers.title")),1)]),_:1}),t(Q),t(S,{icon:"mdi-close"})]),_:1})]),_:1}),t(X,null,{default:e(()=>[t(q,null,{default:e(()=>[(d(!0),F(I,null,ne(r,(i,x)=>(d(),F(I,{key:x},[i?(d(),c(H,{key:0},{default:e(()=>[p(u(i),1)]),_:2},1024)):(d(),c($,{key:1}))],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",at,u(a(o)("common.none")),1))]),"item.urlSeeds":e(({value:r})=>[r&&r.length&&!r.every(i=>!i.length)?(d(),c(ee,{key:0},{activator:e(({props:i})=>[b("div",ot,[b("span",null,u(a(o)("torrentCreator.table.urlSeeds.activator",r.filter(x=>x.length).length)),1),t(z,ie({class:"ml-1"},i),{default:e(()=>[...m[7]||(m[7]=[p(" mdi-information ",-1)])]),_:1},16)])]),default:e(()=>[t(N,null,{default:e(()=>[t(W,{class:"ios-margin"},{default:e(()=>[t(J,{color:"transparent"},{default:e(()=>[t(Z,null,{default:e(()=>[p(u(a(o)("torrentCreator.table.urlSeeds.title")),1)]),_:1}),t(Q),t(S,{icon:"mdi-close"})]),_:1})]),_:1}),t(X,null,{default:e(()=>[t(q,null,{default:e(()=>[(d(!0),F(I,null,ne(r.filter(i=>i.length),(i,x)=>(d(),F(I,null,[i?(d(),c(H,{key:x},{default:e(()=>[p(u(i),1)]),_:2},1024)):M("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",rt,u(a(o)("common.none")),1))]),"item.comment":e(({value:r})=>[b("div",{class:"text-no-wrap",innerHTML:re(r)},null,8,lt)]),"item.errorMessage":e(({value:r})=>[b("div",{class:"text-no-wrap",innerHTML:re(r)},null,8,st)]),"item.actions":e(({item:r})=>[t(S,{disabled:r.status!==a(w).FINISHED,color:"accent",icon:"mdi-download",variant:"text",density:"compact",onClick:j(i=>Ce(r),["stop"])},null,8,["disabled","onClick"]),t(S,{color:"red",icon:"mdi-delete",variant:"text",density:"compact",onClick:j(i=>ye(r),["stop"])},null,8,["onClick"])]),_:2},1032,["headers","items"])]),_:1})]),_:1})):(d(),c(N,{key:0,height:T.value},{default:e(()=>[t(Ye,{title:a(o)("torrentCreator.empty.value"),color:"accent",icon:"mdi-cog-off"},{actions:e(()=>[t(S,{text:a(o)("torrentCreator.empty.action"),color:"accent",onClick:m[0]||(m[0]=r=>oe())},null,8,["text"])]),_:1},8,["title"])]),_:1},8,["height"]))]))}});export{Vt as default};
