import{Y as ue,d as k,h as z,c as B,B as w,D as I,G as a,J as P,K as m,N as Q,O as F,H as ae,m as e,S as M,n as ce,u as p,L as H,P as de,Q as fe,Z as ge,I as me,q as pe,F as he,T as ve,M as ye}from"./vue-D2m1R9Aj.js";import{U as Se,W as E,V as O,j as h,b as Ve,c as G,d as be,i as R,k as Y,e as J,f as ke,a as le,h as W,X as te,x as we,F as Ee,H as Pe,G as Ce,n as Te,o as _e,r as q,s as $e,t as N,I as Ne,Y as Ie,Z as De,v as Z,N as Me,O as Ue,w as X,y as qe,$ as Be,a0 as Re}from"./index-BvPJOlmt.js";import{a as xe}from"./vuetify-CEiwRrJY.js";const ne=ue("searchEngine",()=>{const S=k([]),V=k([]);function n(){S.value.push({uniqueId:Se(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function g(t){S.value=S.value.filter(v=>v.uniqueId!==t)}async function s(t){const v=await E.startSearch(t.query,t.filters.category,[t.filters.plugin]);t.id=v.id,t.results=[],t.lastQuery=t.query}async function $(t){const v=await E.getSearchResults(t.id,t.results.length);return t.results.push(...v.results),v.status}async function r(t){t.id&&t.id!==0&&await E.stopSearch(t.id),t.id=0}async function d(){V.value=await E.getSearchPlugins()}async function C(t){await E.installSearchPlugin([t])}async function T(t){await E.uninstallSearchPlugin([t])}async function _(t){await E.enableSearchPlugin([t.name],!t.enabled)}async function b(){await E.updateSearchPlugins()}async function D(t,v){await E.downloadTorrentWithSearchPlugin(t,v)}return{searchData:S,searchPlugins:V,createNewTab:n,deleteTab:g,runNewSearch:s,refreshResults:$,stopSearch:r,fetchSearchPlugins:d,installSearchPlugin:C,uninstallSearchPlugin:T,toggleSearchPlugin:_,updatePlugins:b,downloadTorrent:D,$reset:()=>{S.value=[],V.value=[],n()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),Le={key:1,"data-testid":"mixedbtn-text"},ee=z({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(S){const V=S,{mobile:n}=xe(),g=B(()=>V.mobileOverride?V.mobileValue:n.value);return(s,$)=>(w(),I(h,{icon:g.value},{default:a(()=>[g.value||s.position==="left"?(w(),I(O,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[P(m(s.icon),1)]),_:1})):Q("",!0),g.value?Q("",!0):(w(),F("span",Le,m(s.text),1)),!g.value&&s.position==="right"?(w(),I(O,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[P(m(s.icon),1)]),_:1})):Q("",!0)]),_:1},8,["icon"]))}}),Qe=["href","title"],Fe=z({__name:"PluginManagerDialog",props:{guid:{}},setup(S){const V=S,{isOpened:n}=Ve(V.guid),{t:g}=ae(),s=ne(),$=[{title:g("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:g("dialogs.pluginManager.headers.name"),key:"fullName"},{title:g("dialogs.pluginManager.headers.version"),key:"version"},{title:g("dialogs.pluginManager.headers.url"),key:"url"},{title:g("dialogs.pluginManager.headers.actions"),key:"actions"}],r=k(!1),d=k(!1),C=k(!1),T=k(!1),_=k("");async function b(f){await s.toggleSearchPlugin(f),await s.fetchSearchPlugins()}async function D(){d.value=!0,await s.updatePlugins().then(()=>new Promise(f=>setTimeout(f,2e3))),await s.fetchSearchPlugins(),d.value=!1}async function t(){U(),r.value=!0,await s.installSearchPlugin(_.value),_.value="",setTimeout(()=>{s.fetchSearchPlugins().then(()=>{r.value=!1})},1e3)}async function v(f){r.value=!0,await s.uninstallSearchPlugin(f.name),await s.fetchSearchPlugins(),r.value=!1}const u=()=>{n.value=!1};function U(){C.value=!1}return(f,y)=>(w(),I(Y,{modelValue:p(n),"onUpdate:modelValue":y[4]||(y[4]=o=>de(n)?n.value=o:null)},{default:a(()=>[e(G,null,{default:a(()=>[e(be,{class:"d-flex"},{default:a(()=>[M("div",null,m(f.$t("dialogs.pluginManager.title")),1),e(R),e(ee,{icon:"mdi-update",text:f.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:d.value,onClick:D},null,8,["text","loading"]),e(Y,{modelValue:C.value,"onUpdate:modelValue":y[3]||(y[3]=o=>C.value=o)},{activator:a(({props:o})=>[e(ee,ce({icon:"mdi-toy-brick-plus",text:f.$t("dialogs.pluginManager.install.activator")},o,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(G,{title:f.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(J,null,{default:a(()=>[e(p(ke),{modelValue:T.value,"onUpdate:modelValue":y[1]||(y[1]=o=>T.value=o),onSubmit:y[2]||(y[2]=H(()=>{},["prevent"]))},{default:a(()=>[e(le,{modelValue:_.value,"onUpdate:modelValue":y[0]||(y[0]=o=>_.value=o),autofocus:"",label:f.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(W,null,{default:a(()=>[e(R),e(h,{color:"error",onClick:U},{default:a(()=>[P(m(f.$t("common.cancel")),1)]),_:1}),e(h,{color:"accent",onClick:t},{default:a(()=>[P(m(f.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(J,null,{default:a(()=>[e(te,{mobile:null,headers:$,"items-per-page":"-1",items:p(s).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:r.value},{"item.enabled":a(({item:o})=>[e(we,{"model-value":o.enabled,onClick:x=>b(o)},null,8,["model-value","onClick"])]),"item.url":a(({item:o})=>[M("a",{href:o.url,title:o.name},m(o.url),9,Qe)]),"item.actions":a(({item:o})=>[e(O,{color:"red",icon:"mdi-delete",onClick:x=>v(o)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(W,null,{default:a(()=>[e(R),e(h,{color:"accent",onClick:u},{default:a(()=>[P(m(f.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),He={class:"pa-3"},Oe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},ze={class:"d-flex justify-end"},Ge=z({__name:"SearchEngine",setup(S){const V=fe(),{t:n}=ae(),g=Ee(),s=Pe(),$=Ce(),r=ne(),{searchData:d}=ge(r),C=Te(),T=k(),_=k(!1),b=k(0),D=B(()=>[{title:n("searchEngine.headers.fileName"),key:"fileName"},{title:n("searchEngine.headers.fileSize"),key:"fileSize"},{title:n("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:n("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...s.version>="5.0.0"?[{title:n("searchEngine.headers.engineName"),key:"engineName"},{title:n("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:n("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),t=[{title:n("searchEngine.filters.category.movies"),value:"movies"},{title:n("searchEngine.filters.category.tv"),value:"tv"},{title:n("searchEngine.filters.category.music"),value:"music"},{title:n("searchEngine.filters.category.games"),value:"games"},{title:n("searchEngine.filters.category.anime"),value:"anime"},{title:n("searchEngine.filters.category.software"),value:"software"},{title:n("searchEngine.filters.category.pictures"),value:"pictures"},{title:n("searchEngine.filters.category.books"),value:"books"}].sort((l,c)=>l.title.localeCompare(c.title)).splice(0,0,{title:n("searchEngine.filters.category.all"),value:"all"}),v=B(()=>{const l=[{title:n("searchEngine.filters.plugins.all"),value:"all"},{title:n("searchEngine.filters.plugins.enabled"),value:"enabled"}];return r.searchPlugins.filter(c=>c.enabled).forEach(c=>{l.push({title:c.name,value:c.name})}),l}),u=B(()=>d.value[b.value]??{}),{results:U}=_e(()=>u.value.results,()=>u.value.filters?.title,l=>l.fileName);function f(){r.createNewTab(),b.value=d.value.length-1,T.value?.focus()}function y(){d.value.length!==1&&(r.deleteTab(u.value.uniqueId),b.value=Math.min(b.value,d.value.length-1))}function o(l){s.version>="5.0.0"?r.downloadTorrent(l.fileUrl,l.engineName):g.pushTorrentToQueue(l.fileUrl)}function x(l){window.open(l.descrLink,"_blank","noreferrer")}async function A(){await r.runNewSearch(u.value),u.value.timer=setInterval(()=>se(u.value),1e3),T.value?.saveValueToHistory()}async function L(l){await r.stopSearch(l),l.timer&&clearInterval(l.timer)}function ie(){d.value.forEach(L)}async function se(l){await r.refreshResults(l)==="Stopped"&&await L(l)}const K=()=>{V.push({name:"dashboard"})};function oe(){$.createDialog(Fe)}function j(l){if($.hasActiveDialog||_.value)return!1;l.key==="Escape"&&K()}return me(async()=>{document.addEventListener("keydown",j),d.value.length===0?r.createNewTab():d.value.forEach(l=>{l.id&&l.id!==0&&(l.timer=setInterval(()=>r.refreshResults(l),1e3))}),await r.fetchSearchPlugins()}),pe(()=>{document.removeEventListener("keydown",j),d.value.forEach(l=>{l.timer&&clearInterval(l.timer)})}),(l,c)=>(w(),F("div",He,[e(q,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(N,null,{default:a(()=>[M("h1",Oe,m(p(n)("searchEngine.title")),1)]),_:1}),e(N,null,{default:a(()=>[M("div",ze,[e(h,{icon:"mdi-stop",variant:"plain",color:"error",onClick:ie}),e(h,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:oe}),e(h,{icon:"mdi-close",variant:"plain",onClick:K})])]),_:1})]),_:1}),e(q,{class:"ma-0 pa-0"},{default:a(()=>[e(Ne,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e(Ie,{modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=i=>b.value=i),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(w(!0),F(he,null,ve(p(d),i=>(w(),I(De,{key:i.uniqueId},{default:a(()=>[M("h4",null,m(!i.lastQuery||i.lastQuery.length===0?l.$t("searchEngine.tabHeaderEmpty"):i.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(R),e(h,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:f}),e(h,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:p(d).length===1,onClick:y},null,8,["disabled"])]),_:1})]),_:1}),e($e,null,{default:a(()=>[e(Z,null,{default:a(()=>[e(q,{class:"mt-1"},{default:a(()=>[e(N,{cols:"12",md:"6"},{default:a(()=>[e(Me,{modelValue:u.value.query,"onUpdate:modelValue":c[1]||(c[1]=i=>u.value.query=i),"history-key":p(Ue).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:T,autofocus:"",density:"compact","hide-details":"",clearable:"",label:l.$t("searchEngine.query"),onKeydown:ye(H(A,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(X,{modelValue:u.value.filters.category,"onUpdate:modelValue":c[2]||(c[2]=i=>u.value.filters.category=i),height:"1",variant:"outlined",density:"compact","hide-details":"",items:p(t),label:l.$t("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(X,{modelValue:u.value.filters.plugin,"onUpdate:modelValue":c[3]||(c[3]=i=>u.value.filters.plugin=i),flat:"",density:"compact","hide-details":"",variant:"outlined",items:v.value,label:l.$t("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[u.value.id===0?(w(),I(h,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:A},{default:a(()=>[P(m(l.$t("searchEngine.runSearch")),1)]),_:1})):(w(),I(h,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:c[4]||(c[4]=i=>L(u.value))},{default:a(()=>[P(m(l.$t("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(qe,{class:"my-3"}),e(Z,{class:"text-select"},{default:a(()=>[e(te,{mobile:null,headers:D.value,items:p(U),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":u.value.itemsPerPage},{top:a(()=>[e(q,null,{default:a(()=>[e(N,{cols:"12"},{default:a(()=>[e(le,{modelValue:u.value.filters.title,"onUpdate:modelValue":c[5]||(c[5]=i=>u.value.filters.title=i),density:"compact","hide-details":"",label:l.$t("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:i})=>[P(m(p(Be)(i.fileSize,p(C).useBinarySize)),1)]),"item.pubDate":a(({value:i})=>[P(m(p(Re)(i,p(C).dateFormat)),1)]),"item.actions":a(({item:i})=>[e(h,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:H(re=>x(i),["stop"])},null,8,["onClick"]),e(h,{icon:"mdi-download",variant:"flat",density:"compact",onClick:re=>o(i)},null,8,["onClick"])]),_:2},1032,["headers","items","items-per-page"])]),_:1})]),_:1})]))}});export{Ge as default};
