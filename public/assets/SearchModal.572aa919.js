import u from"./PluginManager.f14f1429.js";import{m as h}from"./vue.7fbf5199.js";import{M as d,F as m,ae as p,r as _,af as f,ag as g,Q as r,s as y,t as S,z as v,C as b,B as i,a as o,x as l,y as c,E as x,G as k}from"./index.1e4a4031.js";import{_ as C}from"./VDialog.0c13033c.js";import{_ as w}from"./VForm.cd6f231d.js";import{_ as F}from"./VDataTable.d7b8cae1.js";import"./VSwitch.3470219f.js";import"./index.0d51e08a.js";const $={name:"SearchModal",components:{PluginManager:u},mixins:[d,m,p],data(){return{search:{id:null,status:null,interval:null,results:[]},loading:!1,grid:{headers:[{text:this.$t("modals.search.columnTitle.name"),value:"fileName"},{text:this.$t("modals.search.columnTitle.size"),value:"fileSize"},{text:this.$t("modals.search.columnTitle.seeds"),value:"nbSeeders"},{text:this.$t("modals.search.columnTitle.peers"),value:"nbLeechers"},{text:this.$t("modals.search.columnTitle.search_engine"),value:"siteUrl"},{text:this.$t("modals.search.columnTitle.action"),value:"actions",sortable:!1}]},searchForm:{valid:!1,pattern:""},filter:"",mdiClose:_,mdiMagnify:f,mdiDownload:g,sortBy:"nbSeeders",sortDesc:!0}},computed:{...h(["getSearchPlugins"]),dialogWidth(){return this.phoneLayout?"100%":"70%"},enabledSearchPlugins(){return this.getSearchPlugins().filter(a=>a.enabled)}},created(){this.$store.commit("FETCH_SEARCH_PLUGINS")},methods:{async startSearch(){if(this.searchForm.pattern.length&&!this.search.interval){this.loading=!0,this.search.status="Running",this.search.results=[],this.$refs.filterRef.reset();const a=await r.startSearch(this.searchForm.pattern,this.enabledSearchPlugins.map(t=>t.name));this.search.id=a.id,await this.getStatus(),this.search.interval=setInterval(async()=>{await this.getStatus()==="Stopped"&&(clearInterval(this.search.interval),this.search.interval=null),await this.getResults()},500)}},async getStatus(){if(this.search.id){const a=await r.getSearchStatus(this.search.id);return this.search.status=a[0].status}},async getResults(){const a=await r.getSearchResults(this.search.id);this.search.results=a.results},downloadTorrent(a){this.createModal("addModal",{initialMagnet:a.fileUrl})},stopSearch(){r.stopSearch(this.search.id),this.loading=!1},close(){this.dialog=!1},customFilter(a,t,s){const e=t.trim().toLowerCase().split(" ");return a!=null&&t!=null&&typeof a=="string"&&e.every(n=>a.toString().toLowerCase().indexOf(n)!==-1)}}};var M=function(){var t=this,s=t._self._c;return s(C,{style:{height:t.phoneLayout?"100vh":""},attrs:{scrollable:"",width:t.dialogWidth,fullscreen:t.phoneLayout},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[s(S,{style:{height:t.phoneLayout?"100vh":""}},[s(v,{staticClass:"pa-0"},[s(w,{ref:"form",model:{value:t.searchForm.valid,callback:function(e){t.$set(t.searchForm,"valid",e)},expression:"searchForm.valid"}},[s(b,{staticClass:"my-1 py-1 px-2 mx-auto",attrs:{row:""}},[s(i,{staticClass:"pa-0",attrs:{cols:"8"}},[s(o,{staticStyle:{width:"95%"},attrs:{"prepend-inner-icon":t.mdiMagnify,label:"Search",rules:[e=>!!e||"Search term is required"],clearable:"",autofocus:""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.$refs.searchButton.click.apply(null,arguments))}},model:{value:t.searchForm.pattern,callback:function(e){t.$set(t.searchForm,"pattern",e)},expression:"searchForm.pattern"}})],1),s(i,{staticClass:"pa-0 mt-2",attrs:{cols:"3"}},[s(l,{ref:"searchButton",staticClass:"mt-2 mx-0",attrs:{disabled:!t.searchForm.valid,color:t.loading?"warning":"primary"},on:{click:function(e){t.loading?t.stopSearch():t.startSearch()}}},[t._v(" "+t._s(t.loading?t.$t("modals.search.btnStopSearch"):t.$t("modals.search.btnStartSearch"))+" ")])],1)],1)],1),s(F,{style:{maxHeight:"60vh"},attrs:{id:"searchTable",headers:t.grid.headers,items:t.search.results,"items-per-page":10,loading:t.loading,search:t.filter,"custom-filter":t.customFilter,"sort-by":t.sortBy,"sort-desc":t.sortDesc},on:{"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e}},scopedSlots:t._u([{key:"top",fn:function(){return[s(o,{ref:"filterRef",staticClass:"mx-4",attrs:{label:t.$t("filter")},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})]},proxy:!0},{key:"item.fileName",fn:function({item:e}){return[s("a",{attrs:{href:e.descrLink,target:"_blank"},domProps:{textContent:t._s(e.fileName)}})]}},{key:"item.fileSize",fn:function({item:e}){return[t._v(" "+t._s(t._f("formatSize")(e.fileSize))+" ")]}},{key:"item.actions",fn:function({item:e}){return[s(c,{on:{click:function(n){return t.downloadTorrent(e)}}},[t._v(" "+t._s(t.mdiDownload)+" ")])]}}],null,!0)})],1),s(x,[s(u)],1),t.phoneLayout?s(k,[s(l,{attrs:{color:"red",dark:"",absolute:"",bottom:"",right:""},on:{click:t.close}},[s(c,[t._v(t._s(t.mdiClose))])],1)],1):t._e()],1)],1)},T=[],L=y($,M,T,!1,null,null,null,null);const A=L.exports;export{A as default};
