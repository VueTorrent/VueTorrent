import{a1 as re,d as b,h as O,c as Q,B as w,D as I,G as a,S as _,N as p,P as x,L as z,I as ee,m as e,M as D,n as ue,u as y,U as F,O as ce,H as de,a0 as fe,J as ge,q as me,F as pe,Q as ve,V as he}from"./vue-CHuSXKfF.js";import{W as ye,X as C,V as H,i as m,F as Ve,E as K,z as Se,r as B,P as J,B as G,C as ke,a as ae,D as Y,Y as le,l as be,v as we,w as Ee,b as Pe,c as Ce,f as q,g as _e,h as T,y as $e,Z as Te,$ as Ie,j as W,I as Ne,J as De,k as X,m as Me,a0 as Ue}from"./index-DBt_yVtM.js";import{a as qe}from"./vuetify-CKqUSuVG.js";const te=re("searchEngine",()=>{const V=b([]),S=b([]);function n(){V.value.push({uniqueId:ye(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function g(t){V.value=V.value.filter(k=>k.uniqueId!==t)}async function i(t){const k=await C.startSearch(t.query,t.filters.category,[t.filters.plugin]);t.id=k.id,t.results=[],t.lastQuery=t.query}async function f(t){const k=await C.getSearchResults(t.id,t.results.length);return t.results.push(...k.results),k.status}async function E(t){t.id&&t.id!==0&&await C.stopSearch(t.id),t.id=0}async function P(){S.value=await C.getSearchPlugins()}async function $(t){await C.installSearchPlugin([t])}async function h(t){await C.uninstallSearchPlugin([t])}async function c(t){await C.enableSearchPlugin([t.name],!t.enabled)}async function N(){await C.updateSearchPlugins()}return{searchData:V,searchPlugins:S,createNewTab:n,deleteTab:g,runNewSearch:i,refreshResults:f,stopSearch:E,fetchSearchPlugins:P,installSearchPlugin:$,uninstallSearchPlugin:h,toggleSearchPlugin:c,updatePlugins:N,$reset:()=>{V.value=[],S.value=[],n()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),Be={key:1,"data-testid":"mixedbtn-text"},Z=O({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(V){const S=V,{mobile:n}=qe(),g=Q(()=>S.mobileOverride?S.mobileValue:n.value);return(i,f)=>(w(),I(m,{icon:g.value},{default:a(()=>[g.value||i.position==="left"?(w(),I(H,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[_(p(i.icon),1)]),_:1})):x("",!0),g.value?x("",!0):(w(),z("span",Be,p(i.text),1)),!g.value&&i.position==="right"?(w(),I(H,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[_(p(i.icon),1)]),_:1})):x("",!0)]),_:1},8,["icon"]))}}),Re=["href","title"],Le=O({__name:"PluginManagerDialog",props:{guid:{}},setup(V){const S=V,{isOpened:n}=Ve(S.guid),{t:g}=ee(),i=te(),f=[{title:g("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:g("dialogs.pluginManager.headers.name"),key:"fullName"},{title:g("dialogs.pluginManager.headers.version"),key:"version"},{title:g("dialogs.pluginManager.headers.url"),key:"url"},{title:g("dialogs.pluginManager.headers.actions"),key:"actions"}],E=b(!1),P=b(!1),$=b(!1),h=b(!1),c=b("");async function N(d){await i.toggleSearchPlugin(d),await i.fetchSearchPlugins()}async function t(){P.value=!0,await i.updatePlugins().then(()=>new Promise(d=>setTimeout(d,2e3))),await i.fetchSearchPlugins(),P.value=!1}async function k(){M(),E.value=!0,await i.installSearchPlugin(c.value),c.value="",setTimeout(()=>{i.fetchSearchPlugins().then(()=>{E.value=!1})},1e3)}async function r(d){E.value=!0,await i.uninstallSearchPlugin(d.name),await i.fetchSearchPlugins(),E.value=!1}const R=()=>{n.value=!1};function M(){$.value=!1}return(d,v)=>(w(),I(J,{modelValue:y(n),"onUpdate:modelValue":v[4]||(v[4]=s=>ce(n)?n.value=s:null)},{default:a(()=>[e(K,null,{default:a(()=>[e(Se,{class:"d-flex"},{default:a(()=>[D("div",null,p(d.$t("dialogs.pluginManager.title")),1),e(B),e(Z,{icon:"mdi-update",text:d.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:P.value,onClick:t},null,8,["text","loading"]),e(J,{modelValue:$.value,"onUpdate:modelValue":v[3]||(v[3]=s=>$.value=s)},{activator:a(({props:s})=>[e(Z,ue({icon:"mdi-toy-brick-plus",text:d.$t("dialogs.pluginManager.install.activator")},s,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(K,{title:d.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(G,null,{default:a(()=>[e(y(ke),{modelValue:h.value,"onUpdate:modelValue":v[1]||(v[1]=s=>h.value=s),onSubmit:v[2]||(v[2]=F(()=>{},["prevent"]))},{default:a(()=>[e(ae,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=s=>c.value=s),autofocus:"",label:d.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(Y,null,{default:a(()=>[e(B),e(m,{color:"error",onClick:M},{default:a(()=>[_(p(d.$t("common.cancel")),1)]),_:1}),e(m,{color:"accent",onClick:k},{default:a(()=>[_(p(d.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(G,null,{default:a(()=>[e(le,{mobile:null,headers:f,"items-per-page":"-1",items:y(i).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:E.value},{"item.enabled":a(({item:s})=>[e(be,{"model-value":s.enabled,onClick:U=>N(s)},null,8,["model-value","onClick"])]),"item.url":a(({item:s})=>[D("a",{href:s.url,title:s.name},p(s.url),9,Re)]),"item.actions":a(({item:s})=>[e(H,{color:"red",icon:"mdi-delete",onClick:U=>r(s)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(Y,null,{default:a(()=>[e(B),e(m,{color:"accent",onClick:R},{default:a(()=>[_(p(d.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),xe={class:"pa-3"},Qe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},ze={class:"d-flex justify-end"},je=O({__name:"SearchEngine",setup(V){const S=de(),{t:n}=ee(),g=we(),i=Ee(),f=te(),E=Pe(),P=b(),$=b(!1),h=b(0),{searchData:c}=fe(f),N=[{title:n("searchEngine.headers.fileName"),key:"fileName"},{title:n("searchEngine.headers.fileSize"),key:"fileSize"},{title:n("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:n("searchEngine.headers.nbLeechers"),key:"nbLeechers"},{title:n("searchEngine.headers.siteUrl"),key:"siteUrl"},{title:"",key:"actions",sortable:!1}],t=[{title:n("searchEngine.filters.category.movies"),value:"movies"},{title:n("searchEngine.filters.category.tv"),value:"tv"},{title:n("searchEngine.filters.category.music"),value:"music"},{title:n("searchEngine.filters.category.games"),value:"games"},{title:n("searchEngine.filters.category.anime"),value:"anime"},{title:n("searchEngine.filters.category.software"),value:"software"},{title:n("searchEngine.filters.category.pictures"),value:"pictures"},{title:n("searchEngine.filters.category.books"),value:"books"}].sort((l,u)=>l.title.localeCompare(u.title)).splice(0,0,{title:n("searchEngine.filters.category.all"),value:"all"}),k=Q(()=>{const l=[{title:n("searchEngine.filters.plugins.all"),value:"all"},{title:n("searchEngine.filters.plugins.enabled"),value:"enabled"}];return f.searchPlugins.filter(u=>u.enabled).forEach(u=>{l.push({title:u.name,value:u.name})}),l}),r=Q(()=>c.value[h.value]??{}),{results:R}=Ce(()=>r.value.results,()=>r.value.filters?.title,l=>l.fileName);function M(){f.createNewTab(),h.value=c.value.length-1,P.value?.focus()}function d(){c.value.length!==1&&(f.deleteTab(r.value.uniqueId),h.value=Math.min(h.value,c.value.length-1))}function v(l){g.pushTorrentToQueue(l.fileUrl)}function s(l){window.open(l.descrLink,"_blank","noreferrer")}async function U(){await f.runNewSearch(r.value),r.value.timer=setInterval(()=>ie(r.value),1e3),P.value?.saveValueToHistory()}async function L(l){await f.stopSearch(l),l.timer&&clearInterval(l.timer)}function ne(){c.value.forEach(L)}async function ie(l){await f.refreshResults(l)==="Stopped"&&await L(l)}const j=()=>{S.push({name:"dashboard"})};function se(){i.createDialog(Le)}function A(l){if(i.hasActiveDialog||$.value)return!1;l.key==="Escape"&&j()}return ge(async()=>{document.addEventListener("keydown",A),c.value.length===0?f.createNewTab():c.value.forEach(l=>{l.id&&l.id!==0&&(l.timer=setInterval(()=>f.refreshResults(l),1e3))}),await f.fetchSearchPlugins()}),me(()=>{document.removeEventListener("keydown",A),c.value.forEach(l=>{l.timer&&clearInterval(l.timer)})}),(l,u)=>(w(),z("div",xe,[e(q,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(T,null,{default:a(()=>[D("h1",Qe,p(y(n)("searchEngine.title")),1)]),_:1}),e(T,null,{default:a(()=>[D("div",ze,[e(m,{icon:"mdi-stop",variant:"plain",color:"error",onClick:ne}),e(m,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:se}),e(m,{icon:"mdi-close",variant:"plain",onClick:j})])]),_:1})]),_:1}),e(q,{class:"ma-0 pa-0"},{default:a(()=>[e($e,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e(Te,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=o=>h.value=o),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(w(!0),z(pe,null,ve(y(c),o=>(w(),I(Ie,{key:o.uniqueId},{default:a(()=>[D("h4",null,p(!o.lastQuery||o.lastQuery.length===0?l.$t("searchEngine.tabHeaderEmpty"):o.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(B),e(m,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:M}),e(m,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:y(c).length===1,onClick:d},null,8,["disabled"])]),_:1})]),_:1}),e(_e,null,{default:a(()=>[e(W,null,{default:a(()=>[e(q,{class:"mt-1"},{default:a(()=>[e(T,{cols:"12",md:"6"},{default:a(()=>[e(Ne,{modelValue:r.value.query,"onUpdate:modelValue":u[1]||(u[1]=o=>r.value.query=o),"history-key":y(De).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:P,autofocus:"",density:"compact","hide-details":"",clearable:"",label:l.$t("searchEngine.query"),onKeydown:he(F(U,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(T,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(X,{modelValue:r.value.filters.category,"onUpdate:modelValue":u[2]||(u[2]=o=>r.value.filters.category=o),height:"1",variant:"outlined",density:"compact","hide-details":"",items:y(t),label:l.$t("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(T,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(X,{modelValue:r.value.filters.plugin,"onUpdate:modelValue":u[3]||(u[3]=o=>r.value.filters.plugin=o),flat:"",density:"compact","hide-details":"",variant:"outlined",items:k.value,label:l.$t("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(T,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[r.value.id===0?(w(),I(m,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:U},{default:a(()=>[_(p(l.$t("searchEngine.runSearch")),1)]),_:1})):(w(),I(m,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:u[4]||(u[4]=o=>L(r.value))},{default:a(()=>[_(p(l.$t("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(Me,{class:"my-3"}),e(W,{class:"text-select"},{default:a(()=>[e(le,{mobile:null,headers:N,items:y(R),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":r.value.itemsPerPage},{top:a(()=>[e(q,null,{default:a(()=>[e(T,{cols:"12"},{default:a(()=>[e(ae,{modelValue:r.value.filters.title,"onUpdate:modelValue":u[5]||(u[5]=o=>r.value.filters.title=o),density:"compact","hide-details":"",label:l.$t("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:o})=>[_(p(y(Ue)(o.fileSize,y(E).useBinarySize)),1)]),"item.actions":a(({item:o})=>[e(m,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:F(oe=>s(o),["stop"])},null,8,["onClick"]),e(m,{icon:"mdi-download",variant:"flat",density:"compact",onClick:oe=>v(o)},null,8,["onClick"])]),_:2},1032,["items","items-per-page"])]),_:1})]),_:1})]))}});export{je as default};
